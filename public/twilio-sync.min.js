/*
@license
The following license applies to all parts of this software except as
documented below.

    Copyright (c) 2016, Twilio, inc.
    All rights reserved.

    Redistribution and use in source and binary forms, with or without
    modification, are permitted provided that the following conditions are
    met:

      1. Redistributions of source code must retain the above copyright
         notice, this list of conditions and the following disclaimer.

      2. Redistributions in binary form must reproduce the above copyright
         notice, this list of conditions and the following disclaimer in
         the documentation and/or other materials provided with the
         distribution.

      3. Neither the name of Twilio nor the names of its contributors may
         be used to endorse or promote products derived from this software
         without specific prior written permission.

    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

This software includes loglevel under the following license.

    Copyright (c) 2013 Tim Perry

    Permission is hereby granted, free of charge, to any person
    obtaining a copy of this software and associated documentation
    files (the "Software"), to deal in the Software without
    restriction, including without limitation the rights to use,
    copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the
    Software is furnished to do so, subject to the following
    conditions:

    The above copyright notice and this permission notice shall be
    included in all copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
    OTHER DEALINGS IN THE SOFTWARE.

This software includes Backoff library under the following license

    Copyright (C) 2012 Mathieu Turcotte

    Permission is hereby granted, free of charge, to any person obtaining a copy of
    this software and associated documentation files (the "Software"), to deal in
    the Software without restriction, including without limitation the rights to
    use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies
    of the Software, and to permit persons to whom the Software is furnished to do
    so, subject to the following conditions:

    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.

    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
    SOFTWARE.

This software includes Event-to-Promise library under the following license

    Copyright (c) 2014, Julien Fontanet <julien.fontanet@isonoe.net>.

    Permission to use, copy, modify, and/or distribute this software for any purpose
    with or without fee is hereby granted, provided that the above copyright notice
    and this permission notice appear in all copies.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY AND
    FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM LOSS
    OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR OTHER
    TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR PERFORMANCE OF
    THIS SOFTWARE.

*/
this.Twilio=this.Twilio||{},this.Twilio.Sync=function(e){"use strict";var t="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function r(e){if(e.__esModule)return e;var t=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach((function(r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})})),t}var n=function(e){return e&&e.Math==Math&&e},i=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof t&&t)||function(){return this}()||Function("return this")(),s={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},o=function(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e},a=o,c=function(e,t,r){if(a(e),void 0===t)return e;switch(r){case 0:return function(){return e.call(t)};case 1:return function(r){return e.call(t,r)};case 2:return function(r,n){return e.call(t,r,n)};case 3:return function(r,n,i){return e.call(t,r,n,i)}}return function(){return e.apply(t,arguments)}},u=function(e){try{return!!e()}catch(e){return!0}},l={}.toString,d=function(e){return l.call(e).slice(8,-1)},p=d,f="".split,h=u((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==p(e)?f.call(e,""):Object(e)}:Object,v=function(e){if(null==e)throw TypeError("Can't call method on "+e);return e},m=v,g=function(e){return Object(m(e))},y=Math.ceil,b=Math.floor,w=function(e){return isNaN(e=+e)?0:(e>0?b:y)(e)},x=w,_=Math.min,k=function(e){return e>0?_(x(e),9007199254740991):0},S=function(e){return"object"==typeof e?null!==e:"function"==typeof e},E=d,I=Array.isArray||function(e){return"Array"==E(e)},T={exports:{}},O=!u((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),C={},A=S,R=i.document,L=A(R)&&A(R.createElement),j=function(e){return L?R.createElement(e):{}},M=j,P=!O&&!u((function(){return 7!=Object.defineProperty(M("div"),"a",{get:function(){return 7}}).a})),N=S,F=function(e){if(!N(e))throw TypeError(String(e)+" is not an object");return e},D=S,U=function(e,t){if(!D(e))return e;var r,n;if(t&&"function"==typeof(r=e.toString)&&!D(n=r.call(e)))return n;if("function"==typeof(r=e.valueOf)&&!D(n=r.call(e)))return n;if(!t&&"function"==typeof(r=e.toString)&&!D(n=r.call(e)))return n;throw TypeError("Can't convert object to primitive value")},q=O,B=P,W=F,z=U,K=Object.defineProperty;C.f=q?K:function(e,t,r){if(W(e),t=z(t,!0),W(r),B)try{return K(e,t,r)}catch(e){}if("get"in r||"set"in r)throw TypeError("Accessors not supported");return"value"in r&&(e[t]=r.value),e};var G=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},$=C,V=G,Q=O?function(e,t,r){return $.f(e,t,V(1,r))}:function(e,t,r){return e[t]=r,e},H=i,J=Q,X=function(e,t){try{J(H,e,t)}catch(r){H[e]=t}return t},Y=X,Z="__core-js_shared__",ee=i[Z]||Y(Z,{}),te=ee;(T.exports=function(e,t){return te[e]||(te[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.15.2",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"});var re,ne,ie=g,se={}.hasOwnProperty,oe=Object.hasOwn||function(e,t){return se.call(ie(e),t)},ae=0,ce=Math.random(),ue=function(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++ae+ce).toString(36)},le=i,de=le,pe=i,fe=function(e){return"function"==typeof e?e:void 0},he=function(e,t){return arguments.length<2?fe(de[e])||fe(pe[e]):de[e]&&de[e][t]||pe[e]&&pe[e][t]},ve=he("navigator","userAgent")||"",me=ve,ge=i.process,ye=ge&&ge.versions,be=ye&&ye.v8;be?ne=(re=be.split("."))[0]<4?1:re[0]+re[1]:me&&(!(re=me.match(/Edge\/(\d+)/))||re[1]>=74)&&(re=me.match(/Chrome\/(\d+)/))&&(ne=re[1]);var we=ne&&+ne,xe=we,_e=u,ke=!!Object.getOwnPropertySymbols&&!_e((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&xe&&xe<41})),Se=ke&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ee=i,Ie=T.exports,Te=oe,Oe=ue,Ce=ke,Ae=Se,Re=Ie("wks"),Le=Ee.Symbol,je=Ae?Le:Le&&Le.withoutSetter||Oe,Me=function(e){return Te(Re,e)&&(Ce||"string"==typeof Re[e])||(Ce&&Te(Le,e)?Re[e]=Le[e]:Re[e]=je("Symbol."+e)),Re[e]},Pe=S,Ne=I,Fe=Me("species"),De=function(e,t){var r;return Ne(e)&&("function"!=typeof(r=e.constructor)||r!==Array&&!Ne(r.prototype)?Pe(r)&&null===(r=r[Fe])&&(r=void 0):r=void 0),new(void 0===r?Array:r)(0===t?0:t)},Ue=c,qe=h,Be=g,We=k,ze=De,Ke=[].push,Ge=function(e){var t=1==e,r=2==e,n=3==e,i=4==e,s=6==e,o=7==e,a=5==e||s;return function(c,u,l,d){for(var p,f,h=Be(c),v=qe(h),m=Ue(u,l,3),g=We(v.length),y=0,b=d||ze,w=t?b(c,g):r||o?b(c,0):void 0;g>y;y++)if((a||y in v)&&(f=m(p=v[y],y,h),e))if(t)w[y]=f;else if(f)switch(e){case 3:return!0;case 5:return p;case 6:return y;case 2:Ke.call(w,p)}else switch(e){case 4:return!1;case 7:Ke.call(w,p)}return s?-1:n||i?i:w}},$e={forEach:Ge(0),map:Ge(1),filter:Ge(2),some:Ge(3),every:Ge(4),find:Ge(5),findIndex:Ge(6),filterOut:Ge(7)},Ve=u,Qe=function(e,t){var r=[][e];return!!r&&Ve((function(){r.call(null,t||function(){throw 1},1)}))},He=$e.forEach,Je=i,Xe=s,Ye=Qe("forEach")?[].forEach:function(e){return He(this,e,arguments.length>1?arguments[1]:void 0)},Ze=Q;for(var et in Xe){var tt=Je[et],rt=tt&&tt.prototype;if(rt&&rt.forEach!==Ye)try{Ze(rt,"forEach",Ye)}catch(e){rt.forEach=Ye}}function nt(e,t,r,n,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}function it(e){return function(){var t=this,r=arguments;return new Promise((function(n,i){var s=e.apply(t,r);function o(e){nt(s,n,i,o,a,"next",e)}function a(e){nt(s,n,i,o,a,"throw",e)}o(void 0)}))}}function st(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var ot={},at={},ct={}.propertyIsEnumerable,ut=Object.getOwnPropertyDescriptor,lt=ut&&!ct.call({1:2},1);at.f=lt?function(e){var t=ut(this,e);return!!t&&t.enumerable}:ct;var dt=h,pt=v,ft=function(e){return dt(pt(e))},ht=O,vt=at,mt=G,gt=ft,yt=U,bt=oe,wt=P,xt=Object.getOwnPropertyDescriptor;ot.f=ht?xt:function(e,t){if(e=gt(e),t=yt(t,!0),wt)try{return xt(e,t)}catch(e){}if(bt(e,t))return mt(!vt.f.call(e,t),e[t])};var _t={exports:{}},kt=ee,St=Function.toString;"function"!=typeof kt.inspectSource&&(kt.inspectSource=function(e){return St.call(e)});var Et,It,Tt,Ot=kt.inspectSource,Ct=Ot,At=i.WeakMap,Rt="function"==typeof At&&/native code/.test(Ct(At)),Lt=T.exports,jt=ue,Mt=Lt("keys"),Pt=function(e){return Mt[e]||(Mt[e]=jt(e))},Nt={},Ft=Rt,Dt=S,Ut=Q,qt=oe,Bt=ee,Wt=Pt,zt=Nt,Kt="Object already initialized",Gt=i.WeakMap;if(Ft||Bt.state){var $t=Bt.state||(Bt.state=new Gt),Vt=$t.get,Qt=$t.has,Ht=$t.set;Et=function(e,t){if(Qt.call($t,e))throw new TypeError(Kt);return t.facade=e,Ht.call($t,e,t),t},It=function(e){return Vt.call($t,e)||{}},Tt=function(e){return Qt.call($t,e)}}else{var Jt=Wt("state");zt[Jt]=!0,Et=function(e,t){if(qt(e,Jt))throw new TypeError(Kt);return t.facade=e,Ut(e,Jt,t),t},It=function(e){return qt(e,Jt)?e[Jt]:{}},Tt=function(e){return qt(e,Jt)}}var Xt={set:Et,get:It,has:Tt,enforce:function(e){return Tt(e)?It(e):Et(e,{})},getterFor:function(e){return function(t){var r;if(!Dt(t)||(r=It(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return r}}},Yt=i,Zt=Q,er=oe,tr=X,rr=Ot,nr=Xt.get,ir=Xt.enforce,sr=String(String).split("String");(_t.exports=function(e,t,r,n){var i,s=!!n&&!!n.unsafe,o=!!n&&!!n.enumerable,a=!!n&&!!n.noTargetGet;"function"==typeof r&&("string"!=typeof t||er(r,"name")||Zt(r,"name",t),(i=ir(r)).source||(i.source=sr.join("string"==typeof t?t:""))),e!==Yt?(s?!a&&e[t]&&(o=!0):delete e[t],o?e[t]=r:Zt(e,t,r)):o?e[t]=r:tr(t,r)})(Function.prototype,"toString",(function(){return"function"==typeof this&&nr(this).source||rr(this)}));var or={},ar=w,cr=Math.max,ur=Math.min,lr=function(e,t){var r=ar(e);return r<0?cr(r+t,0):ur(r,t)},dr=ft,pr=k,fr=lr,hr=function(e){return function(t,r,n){var i,s=dr(t),o=pr(s.length),a=fr(n,o);if(e&&r!=r){for(;o>a;)if((i=s[a++])!=i)return!0}else for(;o>a;a++)if((e||a in s)&&s[a]===r)return e||a||0;return!e&&-1}},vr={includes:hr(!0),indexOf:hr(!1)},mr=oe,gr=ft,yr=vr.indexOf,br=Nt,wr=function(e,t){var r,n=gr(e),i=0,s=[];for(r in n)!mr(br,r)&&mr(n,r)&&s.push(r);for(;t.length>i;)mr(n,r=t[i++])&&(~yr(s,r)||s.push(r));return s},xr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],_r=wr,kr=xr.concat("length","prototype");or.f=Object.getOwnPropertyNames||function(e){return _r(e,kr)};var Sr={};Sr.f=Object.getOwnPropertySymbols;var Er=or,Ir=Sr,Tr=F,Or=he("Reflect","ownKeys")||function(e){var t=Er.f(Tr(e)),r=Ir.f;return r?t.concat(r(e)):t},Cr=oe,Ar=Or,Rr=ot,Lr=C,jr=function(e,t){for(var r=Ar(t),n=Lr.f,i=Rr.f,s=0;s<r.length;s++){var o=r[s];Cr(e,o)||n(e,o,i(t,o))}},Mr=u,Pr=/#|\.prototype\./,Nr=function(e,t){var r=Dr[Fr(e)];return r==qr||r!=Ur&&("function"==typeof t?Mr(t):!!t)},Fr=Nr.normalize=function(e){return String(e).replace(Pr,".").toLowerCase()},Dr=Nr.data={},Ur=Nr.NATIVE="N",qr=Nr.POLYFILL="P",Br=Nr,Wr=i,zr=ot.f,Kr=Q,Gr=_t.exports,$r=X,Vr=jr,Qr=Br,Hr=function(e,t){var r,n,i,s,o,a=e.target,c=e.global,u=e.stat;if(r=c?Wr:u?Wr[a]||$r(a,{}):(Wr[a]||{}).prototype)for(n in t){if(s=t[n],i=e.noTargetGet?(o=zr(r,n))&&o.value:r[n],!Qr(c?n:a+(u?".":"#")+n,e.forced)&&void 0!==i){if(typeof s==typeof i)continue;Vr(s,i)}(e.sham||i&&i.sham)&&Kr(s,"sham",!0),Gr(r,n,s,e)}},Jr=i.Promise,Xr=_t.exports,Yr=function(e,t,r){for(var n in t)Xr(e,n,t[n],r);return e},Zr=S,en=F,tn=function(e){if(!Zr(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype");return e},rn=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,r={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(r,[]),t=r instanceof Array}catch(e){}return function(r,n){return en(r),tn(n),t?e.call(r,n):r.__proto__=n,r}}():void 0),nn=C.f,sn=oe,on=Me("toStringTag"),an=function(e,t,r){e&&!sn(e=r?e:e.prototype,on)&&nn(e,on,{configurable:!0,value:t})},cn=he,un=C,ln=O,dn=Me("species"),pn=function(e){var t=cn(e),r=un.f;ln&&t&&!t[dn]&&r(t,dn,{configurable:!0,get:function(){return this}})},fn=function(e,t,r){if(!(e instanceof t))throw TypeError("Incorrect "+(r?r+" ":"")+"invocation");return e},hn={},vn=hn,mn=Me("iterator"),gn=Array.prototype,yn=function(e){return void 0!==e&&(vn.Array===e||gn[mn]===e)},bn={};bn[Me("toStringTag")]="z";var wn="[object z]"===String(bn),xn=wn,_n=d,kn=Me("toStringTag"),Sn="Arguments"==_n(function(){return arguments}()),En=xn?_n:function(e){var t,r,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(r=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),kn))?r:Sn?_n(t):"Object"==(n=_n(t))&&"function"==typeof t.callee?"Arguments":n},In=En,Tn=hn,On=Me("iterator"),Cn=function(e){if(null!=e)return e[On]||e["@@iterator"]||Tn[In(e)]},An=F,Rn=function(e){var t=e.return;if(void 0!==t)return An(t.call(e)).value},Ln=F,jn=yn,Mn=k,Pn=c,Nn=Cn,Fn=Rn,Dn=function(e,t){this.stopped=e,this.result=t},Un=function(e,t,r){var n,i,s,o,a,c,u,l=r&&r.that,d=!(!r||!r.AS_ENTRIES),p=!(!r||!r.IS_ITERATOR),f=!(!r||!r.INTERRUPTED),h=Pn(t,l,1+d+f),v=function(e){return n&&Fn(n),new Dn(!0,e)},m=function(e){return d?(Ln(e),f?h(e[0],e[1],v):h(e[0],e[1])):f?h(e,v):h(e)};if(p)n=e;else{if("function"!=typeof(i=Nn(e)))throw TypeError("Target is not iterable");if(jn(i)){for(s=0,o=Mn(e.length);o>s;s++)if((a=m(e[s]))&&a instanceof Dn)return a;return new Dn(!1)}n=i.call(e)}for(c=n.next;!(u=c.call(n)).done;){try{a=m(u.value)}catch(e){throw Fn(n),e}if("object"==typeof a&&a&&a instanceof Dn)return a}return new Dn(!1)},qn=Me("iterator"),Bn=!1;try{var Wn=0,zn={next:function(){return{done:!!Wn++}},return:function(){Bn=!0}};zn[qn]=function(){return this},Array.from(zn,(function(){throw 2}))}catch(e){}var Kn,Gn,$n,Vn=function(e,t){if(!t&&!Bn)return!1;var r=!1;try{var n={};n[qn]=function(){return{next:function(){return{done:r=!0}}}},e(n)}catch(e){}return r},Qn=F,Hn=o,Jn=Me("species"),Xn=function(e,t){var r,n=Qn(e).constructor;return void 0===n||null==(r=Qn(n)[Jn])?t:Hn(r)},Yn=he("document","documentElement"),Zn=/(?:iphone|ipod|ipad).*applewebkit/i.test(ve),ei="process"==d(i.process),ti=i,ri=u,ni=c,ii=Yn,si=j,oi=Zn,ai=ei,ci=ti.location,ui=ti.setImmediate,li=ti.clearImmediate,di=ti.process,pi=ti.MessageChannel,fi=ti.Dispatch,hi=0,vi={},mi="onreadystatechange",gi=function(e){if(vi.hasOwnProperty(e)){var t=vi[e];delete vi[e],t()}},yi=function(e){return function(){gi(e)}},bi=function(e){gi(e.data)},wi=function(e){ti.postMessage(e+"",ci.protocol+"//"+ci.host)};ui&&li||(ui=function(e){for(var t=[],r=1;arguments.length>r;)t.push(arguments[r++]);return vi[++hi]=function(){("function"==typeof e?e:Function(e)).apply(void 0,t)},Kn(hi),hi},li=function(e){delete vi[e]},ai?Kn=function(e){di.nextTick(yi(e))}:fi&&fi.now?Kn=function(e){fi.now(yi(e))}:pi&&!oi?($n=(Gn=new pi).port2,Gn.port1.onmessage=bi,Kn=ni($n.postMessage,$n,1)):ti.addEventListener&&"function"==typeof postMessage&&!ti.importScripts&&ci&&"file:"!==ci.protocol&&!ri(wi)?(Kn=wi,ti.addEventListener("message",bi,!1)):Kn=mi in si("script")?function(e){ii.appendChild(si("script")).onreadystatechange=function(){ii.removeChild(this),gi(e)}}:function(e){setTimeout(yi(e),0)});var xi,_i,ki,Si,Ei,Ii,Ti,Oi,Ci={set:ui,clear:li},Ai=/web0s(?!.*chrome)/i.test(ve),Ri=i,Li=ot.f,ji=Ci.set,Mi=Zn,Pi=Ai,Ni=ei,Fi=Ri.MutationObserver||Ri.WebKitMutationObserver,Di=Ri.document,Ui=Ri.process,qi=Ri.Promise,Bi=Li(Ri,"queueMicrotask"),Wi=Bi&&Bi.value;Wi||(xi=function(){var e,t;for(Ni&&(e=Ui.domain)&&e.exit();_i;){t=_i.fn,_i=_i.next;try{t()}catch(e){throw _i?Si():ki=void 0,e}}ki=void 0,e&&e.enter()},Mi||Ni||Pi||!Fi||!Di?qi&&qi.resolve?((Ti=qi.resolve(void 0)).constructor=qi,Oi=Ti.then,Si=function(){Oi.call(Ti,xi)}):Si=Ni?function(){Ui.nextTick(xi)}:function(){ji.call(Ri,xi)}:(Ei=!0,Ii=Di.createTextNode(""),new Fi(xi).observe(Ii,{characterData:!0}),Si=function(){Ii.data=Ei=!Ei}));var zi=Wi||function(e){var t={fn:e,next:void 0};ki&&(ki.next=t),_i||(_i=t,Si()),ki=t},Ki={},Gi=o,$i=function(e){var t,r;this.promise=new e((function(e,n){if(void 0!==t||void 0!==r)throw TypeError("Bad Promise constructor");t=e,r=n})),this.resolve=Gi(t),this.reject=Gi(r)};Ki.f=function(e){return new $i(e)};var Vi,Qi,Hi,Ji,Xi=F,Yi=S,Zi=Ki,es=i,ts="object"==typeof window,rs=Hr,ns=i,is=he,ss=Jr,os=_t.exports,as=Yr,cs=rn,us=an,ls=pn,ds=S,ps=o,fs=fn,hs=Ot,vs=Un,ms=Vn,gs=Xn,ys=Ci.set,bs=zi,ws=function(e,t){if(Xi(e),Yi(t)&&t.constructor===e)return t;var r=Zi.f(e);return(0,r.resolve)(t),r.promise},xs=function(e,t){var r=es.console;r&&r.error&&(1===arguments.length?r.error(e):r.error(e,t))},_s=Ki,ks=function(e){try{return{error:!1,value:e()}}catch(e){return{error:!0,value:e}}},Ss=Xt,Es=Br,Is=ts,Ts=ei,Os=we,Cs=Me("species"),As="Promise",Rs=Ss.get,Ls=Ss.set,js=Ss.getterFor(As),Ms=ss&&ss.prototype,Ps=ss,Ns=Ms,Fs=ns.TypeError,Ds=ns.document,Us=ns.process,qs=_s.f,Bs=qs,Ws=!!(Ds&&Ds.createEvent&&ns.dispatchEvent),zs="function"==typeof PromiseRejectionEvent,Ks="unhandledrejection",Gs=!1,$s=Es(As,(function(){var e=hs(Ps),t=e!==String(Ps);if(!t&&66===Os)return!0;if(Os>=51&&/native code/.test(e))return!1;var r=new Ps((function(e){e(1)})),n=function(e){e((function(){}),(function(){}))};return(r.constructor={})[Cs]=n,!(Gs=r.then((function(){}))instanceof n)||!t&&Is&&!zs})),Vs=$s||!ms((function(e){Ps.all(e).catch((function(){}))})),Qs=function(e){var t;return!(!ds(e)||"function"!=typeof(t=e.then))&&t},Hs=function(e,t){if(!e.notified){e.notified=!0;var r=e.reactions;bs((function(){for(var n=e.value,i=1==e.state,s=0;r.length>s;){var o,a,c,u=r[s++],l=i?u.ok:u.fail,d=u.resolve,p=u.reject,f=u.domain;try{l?(i||(2===e.rejection&&Zs(e),e.rejection=1),!0===l?o=n:(f&&f.enter(),o=l(n),f&&(f.exit(),c=!0)),o===u.promise?p(Fs("Promise-chain cycle")):(a=Qs(o))?a.call(o,d,p):d(o)):p(n)}catch(e){f&&!c&&f.exit(),p(e)}}e.reactions=[],e.notified=!1,t&&!e.rejection&&Xs(e)}))}},Js=function(e,t,r){var n,i;Ws?((n=Ds.createEvent("Event")).promise=t,n.reason=r,n.initEvent(e,!1,!0),ns.dispatchEvent(n)):n={promise:t,reason:r},!zs&&(i=ns["on"+e])?i(n):e===Ks&&xs("Unhandled promise rejection",r)},Xs=function(e){ys.call(ns,(function(){var t,r=e.facade,n=e.value;if(Ys(e)&&(t=ks((function(){Ts?Us.emit("unhandledRejection",n,r):Js(Ks,r,n)})),e.rejection=Ts||Ys(e)?2:1,t.error))throw t.value}))},Ys=function(e){return 1!==e.rejection&&!e.parent},Zs=function(e){ys.call(ns,(function(){var t=e.facade;Ts?Us.emit("rejectionHandled",t):Js("rejectionhandled",t,e.value)}))},eo=function(e,t,r){return function(n){e(t,n,r)}},to=function(e,t,r){e.done||(e.done=!0,r&&(e=r),e.value=t,e.state=2,Hs(e,!0))},ro=function(e,t,r){if(!e.done){e.done=!0,r&&(e=r);try{if(e.facade===t)throw Fs("Promise can't be resolved itself");var n=Qs(t);n?bs((function(){var r={done:!1};try{n.call(t,eo(ro,r,e),eo(to,r,e))}catch(t){to(r,t,e)}})):(e.value=t,e.state=1,Hs(e,!1))}catch(t){to({done:!1},t,e)}}};if($s&&(Ns=(Ps=function(e){fs(this,Ps,As),ps(e),Vi.call(this);var t=Rs(this);try{e(eo(ro,t),eo(to,t))}catch(e){to(t,e)}}).prototype,(Vi=function(e){Ls(this,{type:As,done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})}).prototype=as(Ns,{then:function(e,t){var r=js(this),n=qs(gs(this,Ps));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=Ts?Us.domain:void 0,r.parent=!0,r.reactions.push(n),0!=r.state&&Hs(r,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),Qi=function(){var e=new Vi,t=Rs(e);this.promise=e,this.resolve=eo(ro,t),this.reject=eo(to,t)},_s.f=qs=function(e){return e===Ps||e===Hi?new Qi(e):Bs(e)},"function"==typeof ss&&Ms!==Object.prototype)){Ji=Ms.then,Gs||(os(Ms,"then",(function(e,t){var r=this;return new Ps((function(e,t){Ji.call(r,e,t)})).then(e,t)}),{unsafe:!0}),os(Ms,"catch",Ns.catch,{unsafe:!0}));try{delete Ms.constructor}catch(e){}cs&&cs(Ms,Ns)}rs({global:!0,wrap:!0,forced:$s},{Promise:Ps}),us(Ps,As,!1),ls(As),Hi=is(As),rs({target:As,stat:!0,forced:$s},{reject:function(e){var t=qs(this);return t.reject.call(void 0,e),t.promise}}),rs({target:As,stat:!0,forced:$s},{resolve:function(e){return ws(this,e)}}),rs({target:As,stat:!0,forced:Vs},{all:function(e){var t=this,r=qs(t),n=r.resolve,i=r.reject,s=ks((function(){var r=ps(t.resolve),s=[],o=0,a=1;vs(e,(function(e){var c=o++,u=!1;s.push(void 0),a++,r.call(t,e).then((function(e){u||(u=!0,s[c]=e,--a||n(s))}),i)})),--a||n(s)}));return s.error&&i(s.value),r.promise},race:function(e){var t=this,r=qs(t),n=r.reject,i=ks((function(){var i=ps(t.resolve);vs(e,(function(e){i.call(t,e).then(r.resolve,n)}))}));return i.error&&n(i.value),r.promise}});var no,io=Object.prototype,so=io.hasOwnProperty,oo="function"==typeof Symbol?Symbol:{},ao=oo.iterator||"@@iterator",co=oo.asyncIterator||"@@asyncIterator",uo=oo.toStringTag||"@@toStringTag";function lo(e,t,r,n){var i=t&&t.prototype instanceof yo?t:yo,s=Object.create(i.prototype),o=new Ro(n||[]);return s._invoke=function(e,t,r){var n=fo;return function(i,s){if(n===vo)throw new Error("Generator is already running");if(n===mo){if("throw"===i)throw s;return jo()}for(r.method=i,r.arg=s;;){var o=r.delegate;if(o){var a=Oo(o,r);if(a){if(a===go)continue;return a}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(n===fo)throw n=mo,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n=vo;var c=po(e,t,r);if("normal"===c.type){if(n=r.done?mo:ho,c.arg===go)continue;return{value:c.arg,done:r.done}}"throw"===c.type&&(n=mo,r.method="throw",r.arg=c.arg)}}}(e,r,o),s}function po(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}var fo="suspendedStart",ho="suspendedYield",vo="executing",mo="completed",go={};function yo(){}function bo(){}function wo(){}var xo={};xo[ao]=function(){return this};var _o=Object.getPrototypeOf,ko=_o&&_o(_o(Lo([])));ko&&ko!==io&&so.call(ko,ao)&&(xo=ko);var So=wo.prototype=yo.prototype=Object.create(xo);function Eo(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function Io(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===bo||"GeneratorFunction"===(t.displayName||t.name))}function To(e,t){function r(n,i,s,o){var a=po(e[n],e,i);if("throw"!==a.type){var c=a.arg,u=c.value;return u&&"object"==typeof u&&so.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,s,o)}),(function(e){r("throw",e,s,o)})):t.resolve(u).then((function(e){c.value=e,s(c)}),(function(e){return r("throw",e,s,o)}))}o(a.arg)}var n;this._invoke=function(e,i){function s(){return new t((function(t,n){r(e,i,t,n)}))}return n=n?n.then(s,s):s()}}function Oo(e,t){var r=e.iterator[t.method];if(r===no){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=no,Oo(e,t),"throw"===t.method))return go;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return go}var n=po(r,e.iterator,t.arg);if("throw"===n.type)return t.method="throw",t.arg=n.arg,t.delegate=null,go;var i=n.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=no),t.delegate=null,go):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,go)}function Co(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function Ao(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function Ro(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(Co,this),this.reset(!0)}function Lo(e){if(e){var t=e[ao];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,n=function t(){for(;++r<e.length;)if(so.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=no,t.done=!0,t};return n.next=n}}return{next:jo}}function jo(){return{value:no,done:!0}}bo.prototype=So.constructor=wo,wo.constructor=bo,wo[uo]=bo.displayName="GeneratorFunction",Eo(To.prototype),To.prototype[co]=function(){return this},Eo(So),So[uo]="Generator",So[ao]=function(){return this},So.toString=function(){return"[object Generator]"},Ro.prototype={constructor:Ro,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=no,this.done=!1,this.delegate=null,this.method="next",this.arg=no,this.tryEntries.forEach(Ao),!e)for(var t in this)"t"===t.charAt(0)&&so.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=no)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(r,n){return s.type="throw",s.arg=e,t.next=r,n&&(t.method="next",t.arg=no),!!n}for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n],s=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var o=so.call(i,"catchLoc"),a=so.call(i,"finallyLoc");if(o&&a){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(o){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!a)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&so.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,go):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),go},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),Ao(r),go}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;Ao(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,r){return this.delegate={iterator:Lo(e),resultName:t,nextLoc:r},"next"===this.method&&(this.arg=no),go}};var Mo={wrap:lo,isGeneratorFunction:Io,AsyncIterator:To,mark:function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,wo):(e.__proto__=wo,uo in e||(e[uo]="GeneratorFunction")),e.prototype=Object.create(So),e},awrap:function(e){return{__await:e}},async:function(e,t,r,n,i){void 0===i&&(i=Promise);var s=new To(lo(e,t,r,n),i);return Io(t)?s:s.next().then((function(e){return e.done?e.value:s.next()}))},keys:function(e){var t=[];for(var r in e)t.push(r);return t.reverse(),function r(){for(;t.length;){var n=t.pop();if(n in e)return r.value=n,r.done=!1,r}return r.done=!0,r}},values:Lo},Po=Object.freeze({__proto__:null,default:Mo});
/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */
function No(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}function Fo(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function Do(){}function Uo(){Uo.init.call(this)}function qo(e){return void 0===e._maxListeners?Uo.defaultMaxListeners:e._maxListeners}function Bo(e,t,r){if(t)e.call(r);else for(var n=e.length,i=Ho(e,n),s=0;s<n;++s)i[s].call(r)}function Wo(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,s=Ho(e,i),o=0;o<i;++o)s[o].call(r,n)}function zo(e,t,r,n,i){if(t)e.call(r,n,i);else for(var s=e.length,o=Ho(e,s),a=0;a<s;++a)o[a].call(r,n,i)}function Ko(e,t,r,n,i,s){if(t)e.call(r,n,i,s);else for(var o=e.length,a=Ho(e,o),c=0;c<o;++c)a[c].call(r,n,i,s)}function Go(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,s=Ho(e,i),o=0;o<i;++o)s[o].apply(r,n)}function $o(e,t,r,n){var i,s,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]):(s=e._events=new Do,e._eventsCount=0),o){if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),!o.warned&&(i=qo(e))&&i>0&&o.length>i){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else o=s[t]=r,++e._eventsCount;return e}function Vo(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function Qo(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function Ho(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}Do.prototype=Object.create(null),Uo.EventEmitter=Uo,Uo.usingDomains=!1,Uo.prototype.domain=void 0,Uo.prototype._events=void 0,Uo.prototype._maxListeners=void 0,Uo.defaultMaxListeners=10,Uo.init=function(){this.domain=null,Uo.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Do,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Uo.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Uo.prototype.getMaxListeners=function(){return qo(this)},Uo.prototype.emit=function(e){var t,r,n,i,s,o,a,c="error"===e;if(o=this._events)c=c&&null==o.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=o[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:Bo(r,l,this);break;case 2:Wo(r,l,this,arguments[1]);break;case 3:zo(r,l,this,arguments[1],arguments[2]);break;case 4:Ko(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),s=1;s<n;s++)i[s-1]=arguments[s];Go(r,l,this,i)}return!0},Uo.prototype.addListener=function(e,t){return $o(this,e,t,!1)},Uo.prototype.on=Uo.prototype.addListener,Uo.prototype.prependListener=function(e,t){return $o(this,e,t,!0)},Uo.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,Vo(this,e,t)),this},Uo.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,Vo(this,e,t)),this},Uo.prototype.removeListener=function(e,t){var r,n,i,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new Do:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Do,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,o||t)}return this},Uo.prototype.off=function(e,t){return this.removeListener(e,t)},Uo.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Do,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new Do:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),s=0;s<i.length;++s)"removeListener"!==(n=i[s])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new Do,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Uo.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},Uo.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):Qo.call(e,t)},Uo.prototype.listenerCount=Qo,Uo.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var Jo={},Xo=U,Yo=C,Zo=G,ea=function(e,t,r){var n=Xo(t);n in e?Yo.f(e,n,Zo(0,r)):e[n]=r},ta=u,ra=we,na=Me("species"),ia=function(e){return ra>=51||!ta((function(){var t=[];return(t.constructor={})[na]=function(){return{foo:1}},1!==t[e](Boolean).foo}))},sa=Hr,oa=S,aa=I,ca=lr,ua=k,la=ft,da=ea,pa=Me,fa=ia("slice"),ha=pa("species"),va=[].slice,ma=Math.max;sa({target:"Array",proto:!0,forced:!fa},{slice:function(e,t){var r,n,i,s=la(this),o=ua(s.length),a=ca(e,o),c=ca(void 0===t?o:t,o);if(aa(s)&&("function"!=typeof(r=s.constructor)||r!==Array&&!aa(r.prototype)?oa(r)&&null===(r=r[ha])&&(r=void 0):r=void 0,r===Array||void 0===r))return va.call(s,a,c);for(n=new(void 0===r?Array:r)(ma(c-a,0)),i=0;a<c;a++,i++)a in s&&da(n,i,s[a]);return n.length=i,n}});var ga=En,ya=wn?{}.toString:function(){return"[object "+ga(this)+"]"},ba=wn,wa=_t.exports,xa=ya;ba||wa(Object.prototype,"toString",xa,{unsafe:!0});var _a=F,ka=Rn,Sa=c,Ea=g,Ia=function(e,t,r,n){try{return n?t(_a(r)[0],r[1]):t(r)}catch(t){throw ka(e),t}},Ta=yn,Oa=k,Ca=ea,Aa=Cn,Ra=function(e){var t,r,n,i,s,o,a=Ea(e),c="function"==typeof this?this:Array,u=arguments.length,l=u>1?arguments[1]:void 0,d=void 0!==l,p=Aa(a),f=0;if(d&&(l=Sa(l,u>2?arguments[2]:void 0,2)),null==p||c==Array&&Ta(p))for(r=new c(t=Oa(a.length));t>f;f++)o=d?l(a[f],f):a[f],Ca(r,f,o);else for(s=(i=p.call(a)).next,r=new c;!(n=s.call(i)).done;f++)o=d?Ia(i,l,[n.value,f],!0):n.value,Ca(r,f,o);return r.length=f,r};Hr({target:"Array",stat:!0,forced:!Vn((function(e){Array.from(e)}))},{from:Ra});var La,ja,Ma,Pa=w,Na=v,Fa=function(e){return function(t,r){var n,i,s=String(Na(t)),o=Pa(r),a=s.length;return o<0||o>=a?e?"":void 0:(n=s.charCodeAt(o))<55296||n>56319||o+1===a||(i=s.charCodeAt(o+1))<56320||i>57343?e?s.charAt(o):n:e?s.slice(o,o+2):i-56320+(n-55296<<10)+65536}},Da={codeAt:Fa(!1),charAt:Fa(!0)},Ua=!u((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),qa=oe,Ba=g,Wa=Ua,za=Pt("IE_PROTO"),Ka=Object.prototype,Ga=Wa?Object.getPrototypeOf:function(e){return e=Ba(e),qa(e,za)?e[za]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Ka:null},$a=u,Va=Ga,Qa=Q,Ha=oe,Ja=Me("iterator"),Xa=!1;[].keys&&("next"in(Ma=[].keys())?(ja=Va(Va(Ma)))!==Object.prototype&&(La=ja):Xa=!0),(null==La||$a((function(){var e={};return La[Ja].call(e)!==e})))&&(La={}),Ha(La,Ja)||Qa(La,Ja,(function(){return this}));var Ya,Za={IteratorPrototype:La,BUGGY_SAFARI_ITERATORS:Xa},ec=wr,tc=xr,rc=Object.keys||function(e){return ec(e,tc)},nc=C,ic=F,sc=rc,oc=O?Object.defineProperties:function(e,t){ic(e);for(var r,n=sc(t),i=n.length,s=0;i>s;)nc.f(e,r=n[s++],t[r]);return e},ac=F,cc=oc,uc=xr,lc=Nt,dc=Yn,pc=j,fc=Pt("IE_PROTO"),hc=function(){},vc=function(e){return"<script>"+e+"</"+"script>"},mc=function(){try{Ya=document.domain&&new ActiveXObject("htmlfile")}catch(e){}var e,t;mc=Ya?function(e){e.write(vc("")),e.close();var t=e.parentWindow.Object;return e=null,t}(Ya):((t=pc("iframe")).style.display="none",dc.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(vc("document.F=Object")),e.close(),e.F);for(var r=uc.length;r--;)delete mc.prototype[uc[r]];return mc()};lc[fc]=!0;var gc=Object.create||function(e,t){var r;return null!==e?(hc.prototype=ac(e),r=new hc,hc.prototype=null,r[fc]=e):r=mc(),void 0===t?r:cc(r,t)},yc=Za.IteratorPrototype,bc=gc,wc=G,xc=an,_c=hn,kc=function(){return this},Sc=Hr,Ec=function(e,t,r){var n=t+" Iterator";return e.prototype=bc(yc,{next:wc(1,r)}),xc(e,n,!1),_c[n]=kc,e},Ic=Ga,Tc=rn,Oc=an,Cc=Q,Ac=_t.exports,Rc=hn,Lc=Za.IteratorPrototype,jc=Za.BUGGY_SAFARI_ITERATORS,Mc=Me("iterator"),Pc="keys",Nc="values",Fc="entries",Dc=function(){return this},Uc=function(e,t,r,n,i,s,o){Ec(r,t,n);var a,c,u,l=function(e){if(e===i&&v)return v;if(!jc&&e in f)return f[e];switch(e){case Pc:case Nc:case Fc:return function(){return new r(this,e)}}return function(){return new r(this)}},d=t+" Iterator",p=!1,f=e.prototype,h=f[Mc]||f["@@iterator"]||i&&f[i],v=!jc&&h||l(i),m="Array"==t&&f.entries||h;if(m&&(a=Ic(m.call(new e)),Lc!==Object.prototype&&a.next&&(Ic(a)!==Lc&&(Tc?Tc(a,Lc):"function"!=typeof a[Mc]&&Cc(a,Mc,Dc)),Oc(a,d,!0))),i==Nc&&h&&h.name!==Nc&&(p=!0,v=function(){return h.call(this)}),f[Mc]!==v&&Cc(f,Mc,v),Rc[t]=v,i)if(c={values:l(Nc),keys:s?v:l(Pc),entries:l(Fc)},o)for(u in c)(jc||p||!(u in f))&&Ac(f,u,c[u]);else Sc({target:t,proto:!0,forced:jc||p},c);return c},qc=Da.charAt,Bc=Xt,Wc=Uc,zc="String Iterator",Kc=Bc.set,Gc=Bc.getterFor(zc);Wc(String,"String",(function(e){Kc(this,{type:zc,string:String(e),index:0})}),(function(){var e,t=Gc(this),r=t.string,n=t.index;return n>=r.length?{value:void 0,done:!0}:(e=qc(r,n),t.index+=e.length,{value:e,done:!1})}));var $c={},Vc=ft,Qc=or.f,Hc={}.toString,Jc="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];$c.f=function(e){return Jc&&"[object Window]"==Hc.call(e)?function(e){try{return Qc(e)}catch(e){return Jc.slice()}}(e):Qc(Vc(e))};var Xc={},Yc=Me;Xc.f=Yc;var Zc=le,eu=oe,tu=Xc,ru=C.f,nu=function(e){var t=Zc.Symbol||(Zc.Symbol={});eu(t,e)||ru(t,e,{value:tu.f(e)})},iu=Hr,su=i,ou=he,au=O,cu=ke,uu=Se,lu=u,du=oe,pu=I,fu=S,hu=F,vu=g,mu=ft,gu=U,yu=G,bu=gc,wu=rc,xu=or,_u=$c,ku=Sr,Su=ot,Eu=C,Iu=at,Tu=Q,Ou=_t.exports,Cu=T.exports,Au=Nt,Ru=ue,Lu=Me,ju=Xc,Mu=nu,Pu=an,Nu=Xt,Fu=$e.forEach,Du=Pt("hidden"),Uu="Symbol",qu=Lu("toPrimitive"),Bu=Nu.set,Wu=Nu.getterFor(Uu),zu=Object.prototype,Ku=su.Symbol,Gu=ou("JSON","stringify"),$u=Su.f,Vu=Eu.f,Qu=_u.f,Hu=Iu.f,Ju=Cu("symbols"),Xu=Cu("op-symbols"),Yu=Cu("string-to-symbol-registry"),Zu=Cu("symbol-to-string-registry"),el=Cu("wks"),tl=su.QObject,rl=!tl||!tl.prototype||!tl.prototype.findChild,nl=au&&lu((function(){return 7!=bu(Vu({},"a",{get:function(){return Vu(this,"a",{value:7}).a}})).a}))?function(e,t,r){var n=$u(zu,t);n&&delete zu[t],Vu(e,t,r),n&&e!==zu&&Vu(zu,t,n)}:Vu,il=function(e,t){var r=Ju[e]=bu(Ku.prototype);return Bu(r,{type:Uu,tag:e,description:t}),au||(r.description=t),r},sl=uu?function(e){return"symbol"==typeof e}:function(e){return Object(e)instanceof Ku},ol=function(e,t,r){e===zu&&ol(Xu,t,r),hu(e);var n=gu(t,!0);return hu(r),du(Ju,n)?(r.enumerable?(du(e,Du)&&e[Du][n]&&(e[Du][n]=!1),r=bu(r,{enumerable:yu(0,!1)})):(du(e,Du)||Vu(e,Du,yu(1,{})),e[Du][n]=!0),nl(e,n,r)):Vu(e,n,r)},al=function(e,t){hu(e);var r=mu(t),n=wu(r).concat(dl(r));return Fu(n,(function(t){au&&!cl.call(r,t)||ol(e,t,r[t])})),e},cl=function(e){var t=gu(e,!0),r=Hu.call(this,t);return!(this===zu&&du(Ju,t)&&!du(Xu,t))&&(!(r||!du(this,t)||!du(Ju,t)||du(this,Du)&&this[Du][t])||r)},ul=function(e,t){var r=mu(e),n=gu(t,!0);if(r!==zu||!du(Ju,n)||du(Xu,n)){var i=$u(r,n);return!i||!du(Ju,n)||du(r,Du)&&r[Du][n]||(i.enumerable=!0),i}},ll=function(e){var t=Qu(mu(e)),r=[];return Fu(t,(function(e){du(Ju,e)||du(Au,e)||r.push(e)})),r},dl=function(e){var t=e===zu,r=Qu(t?Xu:mu(e)),n=[];return Fu(r,(function(e){!du(Ju,e)||t&&!du(zu,e)||n.push(Ju[e])})),n};(cu||(Ou((Ku=function(){if(this instanceof Ku)throw TypeError("Symbol is not a constructor");var e=arguments.length&&void 0!==arguments[0]?String(arguments[0]):void 0,t=Ru(e),r=function(e){this===zu&&r.call(Xu,e),du(this,Du)&&du(this[Du],t)&&(this[Du][t]=!1),nl(this,t,yu(1,e))};return au&&rl&&nl(zu,t,{configurable:!0,set:r}),il(t,e)}).prototype,"toString",(function(){return Wu(this).tag})),Ou(Ku,"withoutSetter",(function(e){return il(Ru(e),e)})),Iu.f=cl,Eu.f=ol,Su.f=ul,xu.f=_u.f=ll,ku.f=dl,ju.f=function(e){return il(Lu(e),e)},au&&(Vu(Ku.prototype,"description",{configurable:!0,get:function(){return Wu(this).description}}),Ou(zu,"propertyIsEnumerable",cl,{unsafe:!0}))),iu({global:!0,wrap:!0,forced:!cu,sham:!cu},{Symbol:Ku}),Fu(wu(el),(function(e){Mu(e)})),iu({target:Uu,stat:!0,forced:!cu},{for:function(e){var t=String(e);if(du(Yu,t))return Yu[t];var r=Ku(t);return Yu[t]=r,Zu[r]=t,r},keyFor:function(e){if(!sl(e))throw TypeError(e+" is not a symbol");if(du(Zu,e))return Zu[e]},useSetter:function(){rl=!0},useSimple:function(){rl=!1}}),iu({target:"Object",stat:!0,forced:!cu,sham:!au},{create:function(e,t){return void 0===t?bu(e):al(bu(e),t)},defineProperty:ol,defineProperties:al,getOwnPropertyDescriptor:ul}),iu({target:"Object",stat:!0,forced:!cu},{getOwnPropertyNames:ll,getOwnPropertySymbols:dl}),iu({target:"Object",stat:!0,forced:lu((function(){ku.f(1)}))},{getOwnPropertySymbols:function(e){return ku.f(vu(e))}}),Gu)&&iu({target:"JSON",stat:!0,forced:!cu||lu((function(){var e=Ku();return"[null]"!=Gu([e])||"{}"!=Gu({a:e})||"{}"!=Gu(Object(e))}))},{stringify:function(e,t,r){for(var n,i=[e],s=1;arguments.length>s;)i.push(arguments[s++]);if(n=t,(fu(t)||void 0!==e)&&!sl(e))return pu(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!sl(t))return t}),i[1]=t,Gu.apply(null,i)}});Ku.prototype[qu]||Tu(Ku.prototype,qu,Ku.prototype.valueOf),Pu(Ku,Uu),Au[Du]=!0;var pl=Hr,fl=O,hl=i,vl=oe,ml=S,gl=C.f,yl=jr,bl=hl.Symbol;if(fl&&"function"==typeof bl&&(!("description"in bl.prototype)||void 0!==bl().description)){var wl={},xl=function(){var e=arguments.length<1||void 0===arguments[0]?void 0:String(arguments[0]),t=this instanceof xl?new bl(e):void 0===e?bl():bl(e);return""===e&&(wl[t]=!0),t};yl(xl,bl);var _l=xl.prototype=bl.prototype;_l.constructor=xl;var kl=_l.toString,Sl="Symbol(test)"==String(bl("test")),El=/^Symbol\((.*)\)[^)]+$/;gl(_l,"description",{configurable:!0,get:function(){var e=ml(this)?this.valueOf():this,t=kl.call(e);if(vl(wl,e))return"";var r=Sl?t.slice(7,-1):t.replace(El,"$1");return""===r?void 0:r}}),pl({global:!0,forced:!0},{Symbol:xl})}nu("iterator");var Il=gc,Tl=C,Ol=Me("unscopables"),Cl=Array.prototype;null==Cl[Ol]&&Tl.f(Cl,Ol,{configurable:!0,value:Il(null)});var Al=function(e){Cl[Ol][e]=!0},Rl=ft,Ll=Al,jl=hn,Ml=Xt,Pl=Uc,Nl="Array Iterator",Fl=Ml.set,Dl=Ml.getterFor(Nl),Ul=Pl(Array,"Array",(function(e,t){Fl(this,{type:Nl,target:Rl(e),index:0,kind:t})}),(function(){var e=Dl(this),t=e.target,r=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==r?{value:n,done:!1}:"values"==r?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");jl.Arguments=jl.Array,Ll("keys"),Ll("values"),Ll("entries");var ql=i,Bl=s,Wl=Ul,zl=Q,Kl=Me,Gl=Kl("iterator"),$l=Kl("toStringTag"),Vl=Wl.values;for(var Ql in Bl){var Hl=ql[Ql],Jl=Hl&&Hl.prototype;if(Jl){if(Jl[Gl]!==Vl)try{zl(Jl,Gl,Vl)}catch(e){Jl[Gl]=Vl}if(Jl[$l]||zl(Jl,$l,Ql),Bl[Ql])for(var Xl in Wl)if(Jl[Xl]!==Wl[Xl])try{zl(Jl,Xl,Wl[Xl])}catch(e){Jl[Xl]=Wl[Xl]}}}var Yl={exports:{}};!function(e){function t(r){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=t=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=t=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),t(r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(Yl);var Zl=O,ed=C.f,td=Function.prototype,rd=td.toString,nd=/^\s*function ([^ (]*)/,id="name";Zl&&!(id in td)&&ed(td,id,{configurable:!0,get:function(){try{return rd.call(this).match(nd)[1]}catch(e){return""}}});var sd=S,od=Math.floor;Hr({target:"Number",stat:!0},{isInteger:function(e){return!sd(e)&&isFinite(e)&&od(e)===e}});var ad=S,cd=rn,ud=function(e,t,r){var n,i;return cd&&"function"==typeof(n=t.constructor)&&n!==r&&ad(i=n.prototype)&&i!==r.prototype&&cd(e,i),e},ld=v,dd="[\t\n\v\f\r                　\u2028\u2029\ufeff]",pd=RegExp("^"+dd+dd+"*"),fd=RegExp(dd+dd+"*$"),hd=function(e){return function(t){var r=String(ld(t));return 1&e&&(r=r.replace(pd,"")),2&e&&(r=r.replace(fd,"")),r}},vd={start:hd(1),end:hd(2),trim:hd(3)},md=O,gd=i,yd=Br,bd=_t.exports,wd=oe,xd=d,_d=ud,kd=U,Sd=u,Ed=gc,Id=or.f,Td=ot.f,Od=C.f,Cd=vd.trim,Ad="Number",Rd=gd.Number,Ld=Rd.prototype,jd=xd(Ed(Ld))==Ad,Md=function(e){var t,r,n,i,s,o,a,c,u=kd(e,!1);if("string"==typeof u&&u.length>2)if(43===(t=(u=Cd(u)).charCodeAt(0))||45===t){if(88===(r=u.charCodeAt(2))||120===r)return NaN}else if(48===t){switch(u.charCodeAt(1)){case 66:case 98:n=2,i=49;break;case 79:case 111:n=8,i=55;break;default:return+u}for(o=(s=u.slice(2)).length,a=0;a<o;a++)if((c=s.charCodeAt(a))<48||c>i)return NaN;return parseInt(s,n)}return+u};if(yd(Ad,!Rd(" 0o1")||!Rd("0b1")||Rd("+0x1"))){for(var Pd,Nd=function(e){var t=arguments.length<1?0:e,r=this;return r instanceof Nd&&(jd?Sd((function(){Ld.valueOf.call(r)})):xd(r)!=Ad)?_d(new Rd(Md(t)),r,Nd):Md(t)},Fd=md?Id(Rd):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger,fromString,range".split(","),Dd=0;Fd.length>Dd;Dd++)wd(Rd,Pd=Fd[Dd])&&!wd(Nd,Pd)&&Od(Nd,Pd,Td(Rd,Pd));Nd.prototype=Ld,Ld.constructor=Nd,bd(gd,Ad,Nd)}var Ud,qd={exports:{}},Bd={exports:{}};(Ud=Bd).exports=function(e){if(Array.isArray(e))return e},Ud.exports.default=Ud.exports,Ud.exports.__esModule=!0;var Wd={exports:{}};!function(e){e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,s=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(s.push(n.value),!t||s.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return s}},e.exports.default=e.exports,e.exports.__esModule=!0}(Wd);var zd={exports:{}},Kd={exports:{}};!function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n},e.exports.default=e.exports,e.exports.__esModule=!0}(Kd),function(e){var t=Kd.exports;e.exports=function(e,r){if(e){if("string"==typeof e)return t(e,r);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?t(e,r):void 0}},e.exports.default=e.exports,e.exports.__esModule=!0}(zd);var Gd={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(Gd),function(e){var t=Bd.exports,r=Wd.exports,n=zd.exports,i=Gd.exports;e.exports=function(e,s){return t(e)||r(e,s)||n(e,s)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(qd);var $d=O,Vd=rc,Qd=ft,Hd=at.f,Jd=function(e){return function(t){for(var r,n=Qd(t),i=Vd(n),s=i.length,o=0,a=[];s>o;)r=i[o++],$d&&!Hd.call(n,r)||a.push(e?[r,n[r]]:n[r]);return a}},Xd={entries:Jd(!0),values:Jd(!1)}.entries;Hr({target:"Object",stat:!0},{entries:function(e){return Xd(e)}});var Yd=Hr,Zd=u,ep=I,tp=S,rp=g,np=k,ip=ea,sp=De,op=ia,ap=we,cp=Me("isConcatSpreadable"),up=9007199254740991,lp="Maximum allowed index exceeded",dp=ap>=51||!Zd((function(){var e=[];return e[cp]=!1,e.concat()[0]!==e})),pp=op("concat"),fp=function(e){if(!tp(e))return!1;var t=e[cp];return void 0!==t?!!t:ep(e)};Yd({target:"Array",proto:!0,forced:!dp||!pp},{concat:function(e){var t,r,n,i,s,o=rp(this),a=sp(o,0),c=0;for(t=-1,n=arguments.length;t<n;t++)if(fp(s=-1===t?o:arguments[t])){if(c+(i=np(s.length))>up)throw TypeError(lp);for(r=0;r<i;r++,c++)r in s&&ip(a,c,s[r])}else{if(c>=up)throw TypeError(lp);ip(a,c++,s)}return a.length=c,a}});var hp=o,vp=S,mp=[].slice,gp={},yp=function(e,t,r){if(!(t in gp)){for(var n=[],i=0;i<t;i++)n[i]="a["+i+"]";gp[t]=Function("C,a","return new C("+n.join(",")+")")}return gp[t](e,r)},bp=Function.bind||function(e){var t=hp(this),r=mp.call(arguments,1),n=function(){var i=r.concat(mp.call(arguments));return this instanceof n?yp(t,i.length,i):t.apply(e,i)};return vp(t.prototype)&&(n.prototype=t.prototype),n},wp=Hr,xp=o,_p=F,kp=S,Sp=gc,Ep=bp,Ip=u,Tp=he("Reflect","construct"),Op=Ip((function(){function e(){}return!(Tp((function(){}),[],e)instanceof e)})),Cp=!Ip((function(){Tp((function(){}))})),Ap=Op||Cp;wp({target:"Reflect",stat:!0,forced:Ap,sham:Ap},{construct:function(e,t){xp(e),_p(t);var r=arguments.length<3?e:xp(arguments[2]);if(Cp&&!Op)return Tp(e,t,r);if(e==r){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var n=[null];return n.push.apply(n,t),new(Ep.apply(e,n))}var i=r.prototype,s=Sp(kp(i)?i:Object.prototype),o=Function.apply.call(e,s,t);return kp(o)?o:s}});var Rp={exports:{}},Lp={exports:{}};!function(e){var t=Kd.exports;e.exports=function(e){if(Array.isArray(e))return t(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(Lp);var jp={exports:{}};!function(e){e.exports=function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)},e.exports.default=e.exports,e.exports.__esModule=!0}(jp);var Mp={exports:{}};!function(e){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.default=e.exports,e.exports.__esModule=!0}(Mp),function(e){var t=Lp.exports,r=jp.exports,n=zd.exports,i=Mp.exports;e.exports=function(e){return t(e)||r(e)||n(e)||i()},e.exports.default=e.exports,e.exports.__esModule=!0}(Rp);var Pp={exports:{}};!function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0}(Pp);var Np={exports:{}},Fp={exports:{}};!function(e){function t(r,n){return e.exports=t=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,t(r,n)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(Fp),function(e){var t=Fp.exports;e.exports=function(e,r){if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&t(e,r)},e.exports.default=e.exports,e.exports.__esModule=!0}(Np);var Dp={exports:{}},Up={exports:{}};!function(e){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0}(Up),function(e){var t=Yl.exports.default,r=Up.exports;e.exports=function(e,n){return!n||"object"!==t(n)&&"function"!=typeof n?r(e):n},e.exports.default=e.exports,e.exports.__esModule=!0}(Dp);var qp={exports:{}};!function(e){function t(r){return e.exports=t=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,t(r)}e.exports=t,e.exports.default=e.exports,e.exports.__esModule=!0}(qp);var Bp=vr.includes,Wp=Al;Hr({target:"Array",proto:!0},{includes:function(e){return Bp(this,e,arguments.length>1?arguments[1]:void 0)}}),Wp("includes");var zp=Hr,Kp=ft,Gp=[].join,$p=h!=Object,Vp=Qe("join",",");zp({target:"Array",proto:!0,forced:$p||!Vp},{join:function(e){return Gp.call(Kp(this),void 0===e?",":e)}}),
/*
	@license
	Copyright (c) 2021 Twilio Inc.

	Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:

	The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

	THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.


	*/
Object.defineProperty(Jo,"__esModule",{value:!0});var Qp=qd.exports,Hp=Rp.exports,Jp=Pp.exports,Xp=Np.exports,Yp=Dp.exports,Zp=qp.exports;function ef(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var tf=ef(Yl.exports),rf=ef(Qp),nf=ef(Hp),sf=ef(Jp),of=ef(Xp),af=ef(Yp),cf=ef(Zp),uf=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return{checks:t}};function lf(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return df(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return df(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function df(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var pf=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return uf((function(e){var r,n=!1,i=[],s=lf(t);try{for(s.s();!(r=s.n()).done;){var o=r.value;"string"!=typeof o?(n=n||e instanceof o,i.push("an instance of ".concat(o.name))):(n=n||tf.default(e)===o,i.push("of type ".concat(o)))}}catch(e){s.e(e)}finally{s.f()}return[n,i]}))};function ff(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return hf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return hf(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function hf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var vf=uf((function(e){return["string"==typeof e&&e.length>0,"a non-empty string"]})),mf=uf((function(e){return["number"==typeof e&&Number.isInteger(e)&&e>=0,"a non-negative integer"]})),gf=uf((function(e){return["object"===tf.default(e)&&null!==e&&!Array.isArray(e),"a pure object (non-null and non-array)"]}));function yf(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=cf.default(e);if(t){var i=cf.default(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return af.default(this,r)}}function bf(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return wf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return wf(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function wf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var xf=function(e,t){if(t.length>e.length)throw new Error("Expected at most ".concat(e.length," argument(s), but got ").concat(t.length));for(;t.length<e.length;)t.push(void 0);var r,n=bf(t.entries());try{for(n.s();!(r=n.n()).done;){var i=rf.default(r.value,2),s=i[0],o=i[1],a=Ef(e[s],o),c=rf.default(a,4),u=c[0],l=c[1],d=c[2],p=c[3];if(!u)throw new Error("Argument ".concat(s+1," is expected to be ").concat(d).concat(p," but got ").concat(l))}}catch(e){n.e(e)}finally{n.f()}},_f=function(e){var t,r,n;(["undefined","boolean","number","bigint","string"].includes(tf.default(e))&&(r="string"==typeof e?'"'.concat(e,'"'):"".concat(e)),"object"===tf.default(e)&&"Object"!==(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name))&&(r=null===e?"null":"instance of ".concat(null==e||null===(n=e.constructor)||void 0===n?void 0:n.name));return r||(r=tf.default(e)),r},kf=function(e){var t,r=[],n=bf(e);try{for(n.s();!(t=n.n()).done;){var i=t.value;r.push(Sf(i))}}catch(e){n.e(e)}finally{n.f()}return r},Sf=function(e){var t,r=[],n=bf(Array.isArray(e)?e:[e]);try{for(n.s();!(t=n.n()).done;){var i=t.value;"string"!=typeof i&&"function"!=typeof i?r.push(i):r.push(pf(i))}}catch(e){n.e(e)}finally{n.f()}return r},Ef=function(e,t){var r,n,i=[],s=!1,o=bf(e);try{for(o.s();!(n=o.n()).done;){var a,c=bf(n.value.checks);try{for(c.s();!(a=c.n()).done;){var u=(0,a.value)(t),l=rf.default(u,3),d=l[0],p=l[1],f=l[2];s=s||d,!r&&f&&(r=f),p&&(i=[].concat(nf.default(i),"string"==typeof p?[p]:nf.default(p)))}}catch(e){c.e(e)}finally{c.f()}}}catch(e){o.e(e)}finally{o.f()}if(s)return[!0];var h=r||_f(t),v=i.length-1;return[!1,h,v>0?"".concat(i.slice(0,v).join(", ")," or ").concat(i[v]):i.join(", "),v>1?";":","]};function If(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Tf(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tf(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function Tf(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Jo.array=function(e,t){return uf((function(r){if(!Array.isArray(r))return[!1,"an array of ".concat(e)];var n,i=If(r.entries());try{for(i.s();!(n=i.n()).done;){var s=rf.default(n.value,2),o=s[0],a=s[1],c=Ef(Sf(t),a),u=rf.default(c,3),l=u[0],d=u[1],p=u[2];if(!l)return[!1,"a valid array of ".concat(e," (index ").concat(o," should be ").concat(p,")"),"malformed array of ".concat(e," (index ").concat(o," is ").concat(d,")")]}}catch(e){i.e(e)}finally{i.f()}return[!0]}))};var Of=Jo.custom=uf,Cf=Jo.literal=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return uf((function(e){var r,n=!1,i=[],s=ff(t);try{for(s.s();!(r=s.n()).done;){var o=r.value;n=n||e===o,i.push("string"==typeof o?'"'.concat(o,'"'):"".concat(o))}}catch(e){s.e(e)}finally{s.f()}return[n,i]}))},Af=Jo.nonEmptyString=vf,Rf=Jo.nonNegativeInteger=mf,Lf=Jo.objectSchema=function(e,t){return uf((function(r){if("object"!==tf.default(r)||null===r||Array.isArray(r))return[!1,"valid ".concat(e," (should be a pure object)")];for(var n=0,i=Object.entries(t);n<i.length;n++){var s=rf.default(i[n],2),o=s[0],a=s[1],c=Ef(Sf(a),r[o]),u=rf.default(c,3),l=u[0],d=u[1],p=u[2];if(!l)return[!1,"valid ".concat(e,' (key "').concat(o,'" should be ').concat(p,")"),"malformed ".concat(e,' (key "').concat(o,'" is ').concat(d,")")]}return[!0]}))},jf=Jo.pureObject=gf;Jo.runtimeTypeValidation=xf,Jo.stringifyReceivedType=_f,Jo.type=pf,Jo.validateConstructorTypes=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=kf(t);return function(e){return function(e){of.default(r,e);var t=yf(r);function r(){sf.default(this,r);for(var e=arguments.length,i=new Array(e),s=0;s<e;s++)i[s]=arguments[s];return xf(n,i),t.call.apply(t,[this].concat(i))}return r}(e)}};var Mf=Jo.validateTypes=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=kf(t);return function(e,t,r){if("function"!=typeof r.value)throw new Error("The validateTypes decorator can only be applied to methods");var i=r.value;r.value=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return xf(n,t),i.apply(this,t)}}},Pf=Jo.validateTypesAsync=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=kf(t);return function(e,t,r){if("function"!=typeof r.value)throw new Error("The validateTypesAsync decorator can only be applied to methods");var i=r.value;r.value=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];try{xf(n,t)}catch(e){return Promise.reject(e)}return i.apply(this,t)}}},Nf={},Ff={exports:{}};!function(e){function t(e,t,r,n,i,s,o){try{var a=e[s](o),c=a.value}catch(e){return void r(e)}a.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(i,s){var o=e.apply(r,n);function a(e){t(o,i,s,a,c,"next",e)}function c(e){t(o,i,s,a,c,"throw",e)}a(void 0)}))}},e.exports.default=e.exports,e.exports.__esModule=!0}(Ff);var Df={exports:{}};!function(e){e.exports=function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.default=e.exports,e.exports.__esModule=!0}(Df);var Uf=r(Po),qf=F,Bf=function(){var e=qf(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t},Wf=_t.exports,zf=F,Kf=u,Gf=Bf,$f="toString",Vf=RegExp.prototype,Qf=Vf.toString,Hf=Kf((function(){return"/a/b"!=Qf.call({source:"a",flags:"b"})})),Jf=Qf.name!=$f;(Hf||Jf)&&Wf(RegExp.prototype,$f,(function(){var e=zf(this),t=String(e.source),r=e.flags;return"/"+t+"/"+String(void 0===r&&e instanceof RegExp&&!("flags"in Vf)?Gf.call(e):r)}),{unsafe:!0});var Xf={exports:{}};!function(e){var r,n;r=t,n=function(){var e=function(){},t="undefined",r=typeof window!==t&&typeof window.navigator!==t&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function i(e,t){var r=e[t];if("function"==typeof r.bind)return r.bind(e);try{return Function.prototype.bind.call(r,e)}catch(t){return function(){return Function.prototype.apply.apply(r,[e,arguments])}}}function s(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function o(n){return"debug"===n&&(n="log"),typeof console!==t&&("trace"===n&&r?s:void 0!==console[n]?i(console,n):void 0!==console.log?i(console,"log"):e)}function a(t,r){for(var i=0;i<n.length;i++){var s=n[i];this[s]=i<t?e:this.methodFactory(s,t,r)}this.log=this.debug}function c(e,r,n){return function(){typeof console!==t&&(a.call(this,r,n),this[e].apply(this,arguments))}}function u(e,t,r){return o(e)||c.apply(this,arguments)}function l(e,r,i){var s,o=this,c="loglevel";function l(){var e;if(typeof window!==t&&c){try{e=window.localStorage[c]}catch(e){}if(typeof e===t)try{var r=window.document.cookie,n=r.indexOf(encodeURIComponent(c)+"=");-1!==n&&(e=/^([^;]+)/.exec(r.slice(n))[1])}catch(e){}return void 0===o.levels[e]&&(e=void 0),e}}"string"==typeof e?c+=":"+e:"symbol"==typeof e&&(c=void 0),o.name=e,o.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},o.methodFactory=i||u,o.getLevel=function(){return s},o.setLevel=function(r,i){if("string"==typeof r&&void 0!==o.levels[r.toUpperCase()]&&(r=o.levels[r.toUpperCase()]),!("number"==typeof r&&r>=0&&r<=o.levels.SILENT))throw"log.setLevel() called with invalid level: "+r;if(s=r,!1!==i&&function(e){var r=(n[e]||"silent").toUpperCase();if(typeof window!==t&&c){try{return void(window.localStorage[c]=r)}catch(e){}try{window.document.cookie=encodeURIComponent(c)+"="+r+";"}catch(e){}}}(r),a.call(o,r,e),typeof console===t&&r<o.levels.SILENT)return"No console available for logging"},o.setDefaultLevel=function(e){l()||o.setLevel(e,!1)},o.enableAll=function(e){o.setLevel(o.levels.TRACE,e)},o.disableAll=function(e){o.setLevel(o.levels.SILENT,e)};var d=l();null==d&&(d=null==r?"WARN":r),o.setLevel(d,!1)}var d=new l,p={};d.getLogger=function(e){if("symbol"!=typeof e&&"string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=p[e];return t||(t=p[e]=new l(e,d.getLevel(),d.methodFactory)),t};var f=typeof window!==t?window.log:void 0;return d.noConflict=function(){return typeof window!==t&&window.log===d&&(window.log=f),d},d.getLoggers=function(){return p},d.default=d,d},e.exports?e.exports=n():r.log=n()}(Xf);var Yf={exports:{}},Zf=!u((function(){return Object.isExtensible(Object.preventExtensions({}))})),eh=Nt,th=S,rh=oe,nh=C.f,ih=Zf,sh=ue("meta"),oh=0,ah=Object.isExtensible||function(){return!0},ch=function(e){nh(e,sh,{value:{objectID:"O"+oh++,weakData:{}}})},uh=Yf.exports={REQUIRED:!1,fastKey:function(e,t){if(!th(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!rh(e,sh)){if(!ah(e))return"F";if(!t)return"E";ch(e)}return e[sh].objectID},getWeakData:function(e,t){if(!rh(e,sh)){if(!ah(e))return!0;if(!t)return!1;ch(e)}return e[sh].weakData},onFreeze:function(e){return ih&&uh.REQUIRED&&ah(e)&&!rh(e,sh)&&ch(e),e}};eh[sh]=!0;var lh=Hr,dh=i,ph=Br,fh=_t.exports,hh=Yf.exports,vh=Un,mh=fn,gh=S,yh=u,bh=Vn,wh=an,xh=ud,_h=function(e,t,r){var n=-1!==e.indexOf("Map"),i=-1!==e.indexOf("Weak"),s=n?"set":"add",o=dh[e],a=o&&o.prototype,c=o,u={},l=function(e){var t=a[e];fh(a,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(i&&!gh(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return i&&!gh(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(i&&!gh(e))&&t.call(this,0===e?0:e)}:function(e,r){return t.call(this,0===e?0:e,r),this})};if(ph(e,"function"!=typeof o||!(i||a.forEach&&!yh((function(){(new o).entries().next()})))))c=r.getConstructor(t,e,n,s),hh.REQUIRED=!0;else if(ph(e,!0)){var d=new c,p=d[s](i?{}:-0,1)!=d,f=yh((function(){d.has(1)})),h=bh((function(e){new o(e)})),v=!i&&yh((function(){for(var e=new o,t=5;t--;)e[s](t,t);return!e.has(-0)}));h||((c=t((function(t,r){mh(t,c,e);var i=xh(new o,t,c);return null!=r&&vh(r,i[s],{that:i,AS_ENTRIES:n}),i}))).prototype=a,a.constructor=c),(f||v)&&(l("delete"),l("has"),n&&l("get")),(v||p)&&l(s),i&&a.clear&&delete a.clear}return u[e]=c,lh({global:!0,forced:c!=o},u),wh(c,e),i||r.setStrong(c,e,n),c},kh=C.f,Sh=gc,Eh=Yr,Ih=c,Th=fn,Oh=Un,Ch=Uc,Ah=pn,Rh=O,Lh=Yf.exports.fastKey,jh=Xt.set,Mh=Xt.getterFor,Ph={getConstructor:function(e,t,r,n){var i=e((function(e,s){Th(e,i,t),jh(e,{type:t,index:Sh(null),first:void 0,last:void 0,size:0}),Rh||(e.size=0),null!=s&&Oh(s,e[n],{that:e,AS_ENTRIES:r})})),s=Mh(t),o=function(e,t,r){var n,i,o=s(e),c=a(e,t);return c?c.value=r:(o.last=c={index:i=Lh(t,!0),key:t,value:r,previous:n=o.last,next:void 0,removed:!1},o.first||(o.first=c),n&&(n.next=c),Rh?o.size++:e.size++,"F"!==i&&(o.index[i]=c)),e},a=function(e,t){var r,n=s(e),i=Lh(t);if("F"!==i)return n.index[i];for(r=n.first;r;r=r.next)if(r.key==t)return r};return Eh(i.prototype,{clear:function(){for(var e=s(this),t=e.index,r=e.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete t[r.index],r=r.next;e.first=e.last=void 0,Rh?e.size=0:this.size=0},delete:function(e){var t=this,r=s(t),n=a(t,e);if(n){var i=n.next,o=n.previous;delete r.index[n.index],n.removed=!0,o&&(o.next=i),i&&(i.previous=o),r.first==n&&(r.first=i),r.last==n&&(r.last=o),Rh?r.size--:t.size--}return!!n},forEach:function(e){for(var t,r=s(this),n=Ih(e,arguments.length>1?arguments[1]:void 0,3);t=t?t.next:r.first;)for(n(t.value,t.key,this);t&&t.removed;)t=t.previous},has:function(e){return!!a(this,e)}}),Eh(i.prototype,r?{get:function(e){var t=a(this,e);return t&&t.value},set:function(e,t){return o(this,0===e?0:e,t)}}:{add:function(e){return o(this,e=0===e?0:e,e)}}),Rh&&kh(i.prototype,"size",{get:function(){return s(this).size}}),i},setStrong:function(e,t,r){var n=t+" Iterator",i=Mh(t),s=Mh(n);Ch(e,t,(function(e,t){jh(this,{type:n,target:e,state:i(e),kind:t,last:void 0})}),(function(){for(var e=s(this),t=e.kind,r=e.last;r&&r.removed;)r=r.previous;return e.target&&(e.last=r=r?r.next:e.state.first)?"keys"==t?{value:r.key,done:!1}:"values"==t?{value:r.value,done:!1}:{value:[r.key,r.value],done:!1}:(e.target=void 0,{value:void 0,done:!0})}),r?"entries":"values",!r,!0),Ah(t)}};_h("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Ph);var Nh={exports:{}};!function(e,t){var r;r=function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:n})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=5)}([function(e,t,r){e.exports=function(e,t){var r,n,i;for(r=1;r<arguments.length;r++)for(i in n=arguments[r])n.hasOwnProperty(i)&&(e[i]=n[i]);return e}},function(e,t,r){var n=r(0);e.exports={build:function(e,t){var r,i,s,o=t.plugins;for(r=0,i=o.length;r<i;r++)(s=o[r]).methods&&n(e,s.methods),s.properties&&Object.defineProperties(e,s.properties)},hook:function(e,t,r){var n,i,s,o,a=e.config.plugins,c=[e.context];for(r&&(c=c.concat(r)),n=0,i=a.length;n<i;n++)o=a[n],(s=a[n][t])&&s.apply(o,c)}}},function(e,t,r){function n(e){if(0===e.length)return e;var t,r,n=e.split(/[_-]/);if(1===n.length&&n[0][0].toLowerCase()===n[0][0])return e;for(r=n[0].toLowerCase(),t=1;t<n.length;t++)r=r+n[t].charAt(0).toUpperCase()+n[t].substring(1).toLowerCase();return r}n.prepended=function(e,t){return e+(t=n(t))[0].toUpperCase()+t.substring(1)},e.exports=n},function(e,t,r){var n=r(0),i=r(2);function s(e,t){e=e||{},this.options=e,this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}n(s.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,r=e.from,n=e.to;return this.addState(r),"function"!=typeof n&&this.addState(n),this.addTransition(t),this.map[r][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(n({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(n({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var r,n,i;for(r=0,n=(e=e||[]).length;r<n;r++)"function"==typeof(i=e[r])&&(e[r]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,r,n,i,s,o=this.defaults.wildcard;for(r=0;r<e.length;r++)for(n=e[r],i=Array.isArray(n.from)?n.from:[n.from||o],s=n.to||o,t=0;t<i.length;t++)this.mapTransition({name:n.name,from:i[t],to:s})},transitionFor:function(e,t){var r=this.defaults.wildcard;return this.map[e][t]||this.map[r][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=s},function(e,t,r){var n=r(0),i=r(6),s=r(1),o=[null,[]];function a(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}n(a.prototype,{init:function(e){if(n(this.context,this.config.data.apply(this.context,e)),s.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var r=this.config.defaults.wildcard,n=this.config.transitionFor(this.state,e),i=n&&n.to;return"function"==typeof i?i.apply(this.context,t):i===r?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,r,n){var i=this.config.lifecycle,s=this.config.options.observeUnchangedState||t!==r;return r?this.isPending()?this.context.onPendingTransition(e,t,r):(this.config.addState(r),this.beginTransit(),n.unshift({transition:e,from:t,to:r,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),s?this.observersForEvent(i.onLeave.state):o,s?this.observersForEvent(i.onLeave[t]):o,this.observersForEvent(i.on.transition),s?["doTransit",[this]]:o,s?this.observersForEvent(i.onEnter.state):o,s?this.observersForEvent(i.onEnter[r]):o,s?this.observersForEvent(i.on[r]):o,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],n)):this.context.onInvalidTransition(e,t,r)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,r=0,n=this.observers.length,i=[];r<n;r++)(t=this.observers[r])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,r,n){if(0===e.length)return this.endTransit(void 0===n||n);var i=e[0][0],o=e[0][1],a=e[0][2];if(t[0].event=i,i&&a&&i!==r&&s.hook(this,"lifecycle",t),0===o.length)return e.shift(),this.observeEvents(e,t,i,n);var c=o.shift(),u=c[i].apply(c,t);return u&&"function"==typeof u.then?u.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===u?this.endTransit(!1):this.observeEvents(e,t,i,u)},onInvalidTransition:function(e,t,r){throw new i("transition is invalid in current state",e,t,r,this.state)},onPendingTransition:function(e,t,r){throw new i("transition is invalid while previous transition is still in progress",e,t,r,this.state)}}),e.exports=a},function(e,t,r){var n=r(0),i=r(2),s=r(1),o=r(3),a=r(4),c={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,r){return this._fsm.onInvalidTransition(e,t,r)},onPendingTransition:function(e,t,r){return this._fsm.onPendingTransition(e,t,r)}},u={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return d(this||{},e)}function d(e,t){return p(e,new o(t,l)),e._fsm(),e}function p(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");s.build(e,t),Object.defineProperties(e,u),n(e,c),n(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new a(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var r=new o(t,l);return p(e.prototype,r),e.prototype._fsm.config=r,e},l.apply=d,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,r){e.exports=function(e,t,r,n,i){this.message=e,this.transition=t,this.from=r,this.to=n,this.current=i}}])},e.exports=r()}(Nh);var Fh={exports:{}},Dh="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(Dh){var Uh=new Uint8Array(16);Fh.exports=function(){return Dh(Uh),Uh}}else{var qh=new Array(16);Fh.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),qh[t]=e>>>((3&t)<<3)&255;return qh}}for(var Bh=[],Wh=0;Wh<256;++Wh)Bh[Wh]=(Wh+256).toString(16).substr(1);var zh,Kh,Gh=function(e,t){var r=t||0,n=Bh;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")},$h=Fh.exports,Vh=Gh,Qh=0,Hh=0;var Jh=function(e,t,r){var n=t&&r||0,i=t||[],s=(e=e||{}).node||zh,o=void 0!==e.clockseq?e.clockseq:Kh;if(null==s||null==o){var a=$h();null==s&&(s=zh=[1|a[0],a[1],a[2],a[3],a[4],a[5]]),null==o&&(o=Kh=16383&(a[6]<<8|a[7]))}var c=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:Hh+1,l=c-Qh+(u-Hh)/1e4;if(l<0&&void 0===e.clockseq&&(o=o+1&16383),(l<0||c>Qh)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");Qh=c,Hh=u,Kh=o;var d=(1e4*(268435455&(c+=122192928e5))+u)%4294967296;i[n++]=d>>>24&255,i[n++]=d>>>16&255,i[n++]=d>>>8&255,i[n++]=255&d;var p=c/4294967296*1e4&268435455;i[n++]=p>>>8&255,i[n++]=255&p,i[n++]=p>>>24&15|16,i[n++]=p>>>16&255,i[n++]=o>>>8|128,i[n++]=255&o;for(var f=0;f<6;++f)i[n+f]=s[f];return t||Vh(i)},Xh=Fh.exports,Yh=Gh;var Zh=Jh,ev=function(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var i=(e=e||{}).random||(e.rng||Xh)();if(i[6]=15&i[6]|64,i[8]=63&i[8]|128,t)for(var s=0;s<16;++s)t[n+s]=i[s];return t||Yh(i)},tv=ev;tv.v1=Zh,tv.v4=ev;var rv=tv,nv={},iv=u,sv=function(e,t){return RegExp(e,t)};nv.UNSUPPORTED_Y=iv((function(){var e=sv("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),nv.BROKEN_CARET=iv((function(){var e=sv("^r","gy");return e.lastIndex=2,null!=e.exec("str")}));var ov,av,cv=u((function(){var e=RegExp(".","string".charAt(0));return!(e.dotAll&&e.exec("\n")&&"s"===e.flags)})),uv=u((function(){var e=RegExp("(?<a>b)","string".charAt(5));return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})),lv=Bf,dv=nv,pv=T.exports,fv=gc,hv=Xt.get,vv=cv,mv=uv,gv=RegExp.prototype.exec,yv=pv("native-string-replace",String.prototype.replace),bv=gv,wv=(ov=/a/,av=/b*/g,gv.call(ov,"a"),gv.call(av,"a"),0!==ov.lastIndex||0!==av.lastIndex),xv=dv.UNSUPPORTED_Y||dv.BROKEN_CARET,_v=void 0!==/()??/.exec("")[1];(wv||_v||xv||vv||mv)&&(bv=function(e){var t,r,n,i,s,o,a,c=this,u=hv(c),l=u.raw;if(l)return l.lastIndex=c.lastIndex,t=bv.call(l,e),c.lastIndex=l.lastIndex,t;var d=u.groups,p=xv&&c.sticky,f=lv.call(c),h=c.source,v=0,m=e;if(p&&(-1===(f=f.replace("y","")).indexOf("g")&&(f+="g"),m=String(e).slice(c.lastIndex),c.lastIndex>0&&(!c.multiline||c.multiline&&"\n"!==e[c.lastIndex-1])&&(h="(?: "+h+")",m=" "+m,v++),r=new RegExp("^(?:"+h+")",f)),_v&&(r=new RegExp("^"+h+"$(?!\\s)",f)),wv&&(n=c.lastIndex),i=gv.call(p?r:c,m),p?i?(i.input=i.input.slice(v),i[0]=i[0].slice(v),i.index=c.lastIndex,c.lastIndex+=i[0].length):c.lastIndex=0:wv&&i&&(c.lastIndex=c.global?i.index+i[0].length:n),_v&&i&&i.length>1&&yv.call(i[0],r,(function(){for(s=1;s<arguments.length-2;s++)void 0===arguments[s]&&(i[s]=void 0)})),i&&d)for(i.groups=o=fv(null),s=0;s<d.length;s++)o[(a=d[s])[0]]=i[a[1]];return i});var kv=bv;Hr({target:"RegExp",proto:!0,forced:/./.exec!==kv},{exec:kv});var Sv=_t.exports,Ev=kv,Iv=u,Tv=Me,Ov=Q,Cv=Tv("species"),Av=RegExp.prototype,Rv=function(e,t,r,n){var i=Tv(e),s=!Iv((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),o=s&&!Iv((function(){var t=!1,r=/a/;return"split"===e&&((r={}).constructor={},r.constructor[Cv]=function(){return r},r.flags="",r[i]=/./[i]),r.exec=function(){return t=!0,null},r[i](""),!t}));if(!s||!o||r){var a=/./[i],c=t(i,""[e],(function(e,t,r,n,i){var o=t.exec;return o===Ev||o===Av.exec?s&&!i?{done:!0,value:a.call(t,r,n)}:{done:!0,value:e.call(r,t,n)}:{done:!1}}));Sv(String.prototype,e,c[0]),Sv(Av,i,c[1])}n&&Ov(Av[i],"sham",!0)},Lv=Da.charAt,jv=function(e,t,r){return t+(r?Lv(e,t).length:1)},Mv=g,Pv=Math.floor,Nv="".replace,Fv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Dv=/\$([$&'`]|\d{1,2})/g,Uv=d,qv=kv,Bv=function(e,t){var r=e.exec;if("function"==typeof r){var n=r.call(e,t);if("object"!=typeof n)throw TypeError("RegExp exec method returned something other than an Object or null");return n}if("RegExp"!==Uv(e))throw TypeError("RegExp#exec called on incompatible receiver");return qv.call(e,t)},Wv=Rv,zv=u,Kv=F,Gv=k,$v=w,Vv=v,Qv=jv,Hv=function(e,t,r,n,i,s){var o=r+e.length,a=n.length,c=Dv;return void 0!==i&&(i=Mv(i),c=Fv),Nv.call(s,c,(function(s,c){var u;switch(c.charAt(0)){case"$":return"$";case"&":return e;case"`":return t.slice(0,r);case"'":return t.slice(o);case"<":u=i[c.slice(1,-1)];break;default:var l=+c;if(0===l)return s;if(l>a){var d=Pv(l/10);return 0===d?s:d<=a?void 0===n[d-1]?c.charAt(1):n[d-1]+c.charAt(1):s}u=n[l-1]}return void 0===u?"":u}))},Jv=Bv,Xv=Me("replace"),Yv=Math.max,Zv=Math.min,em="$0"==="a".replace(/./,"$0"),tm=!!/./[Xv]&&""===/./[Xv]("a","$0");Wv("replace",(function(e,t,r){var n=tm?"$":"$0";return[function(e,r){var n=Vv(this),i=null==e?void 0:e[Xv];return void 0!==i?i.call(e,n,r):t.call(String(n),e,r)},function(e,i){if("string"==typeof i&&-1===i.indexOf(n)&&-1===i.indexOf("$<")){var s=r(t,this,e,i);if(s.done)return s.value}var o=Kv(this),a=String(e),c="function"==typeof i;c||(i=String(i));var u=o.global;if(u){var l=o.unicode;o.lastIndex=0}for(var d=[];;){var p=Jv(o,a);if(null===p)break;if(d.push(p),!u)break;""===String(p[0])&&(o.lastIndex=Qv(a,Gv(o.lastIndex),l))}for(var f,h="",v=0,m=0;m<d.length;m++){p=d[m];for(var g=String(p[0]),y=Yv(Zv($v(p.index),a.length),0),b=[],w=1;w<p.length;w++)b.push(void 0===(f=p[w])?f:String(f));var x=p.groups;if(c){var _=[g].concat(b,y,a);void 0!==x&&_.push(x);var k=String(i.apply(void 0,_))}else k=Hv(g,a,y,b,x,i);y>=v&&(h+=a.slice(v,y)+k,v=y+g.length)}return h+a.slice(v)}]}),!!zv((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")}))||!em||tm);var rm="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,nm=w,im=k,sm=function(e){if(void 0===e)return 0;var t=nm(e),r=im(t);if(t!==r)throw RangeError("Wrong length or index");return r},om=Math.abs,am=Math.pow,cm=Math.floor,um=Math.log,lm=Math.LN2,dm=g,pm=lr,fm=k,hm=i,vm=O,mm=rm,gm=Q,ym=Yr,bm=u,wm=fn,xm=w,_m=k,km=sm,Sm={pack:function(e,t,r){var n,i,s,o=new Array(r),a=8*r-t-1,c=(1<<a)-1,u=c>>1,l=23===t?am(2,-24)-am(2,-77):0,d=e<0||0===e&&1/e<0?1:0,p=0;for((e=om(e))!=e||e===1/0?(i=e!=e?1:0,n=c):(n=cm(um(e)/lm),e*(s=am(2,-n))<1&&(n--,s*=2),(e+=n+u>=1?l/s:l*am(2,1-u))*s>=2&&(n++,s/=2),n+u>=c?(i=0,n=c):n+u>=1?(i=(e*s-1)*am(2,t),n+=u):(i=e*am(2,u-1)*am(2,t),n=0));t>=8;o[p++]=255&i,i/=256,t-=8);for(n=n<<t|i,a+=t;a>0;o[p++]=255&n,n/=256,a-=8);return o[--p]|=128*d,o},unpack:function(e,t){var r,n=e.length,i=8*n-t-1,s=(1<<i)-1,o=s>>1,a=i-7,c=n-1,u=e[c--],l=127&u;for(u>>=7;a>0;l=256*l+e[c],c--,a-=8);for(r=l&(1<<-a)-1,l>>=-a,a+=t;a>0;r=256*r+e[c],c--,a-=8);if(0===l)l=1-o;else{if(l===s)return r?NaN:u?-1/0:1/0;r+=am(2,t),l-=o}return(u?-1:1)*r*am(2,l-t)}},Em=Ga,Im=rn,Tm=or.f,Om=C.f,Cm=function(e){for(var t=dm(this),r=fm(t.length),n=arguments.length,i=pm(n>1?arguments[1]:void 0,r),s=n>2?arguments[2]:void 0,o=void 0===s?r:pm(s,r);o>i;)t[i++]=e;return t},Am=an,Rm=Xt.get,Lm=Xt.set,jm="ArrayBuffer",Mm="DataView",Pm="Wrong index",Nm=hm.ArrayBuffer,Fm=Nm,Dm=hm.DataView,Um=Dm&&Dm.prototype,qm=Object.prototype,Bm=hm.RangeError,Wm=Sm.pack,zm=Sm.unpack,Km=function(e){return[255&e]},Gm=function(e){return[255&e,e>>8&255]},$m=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Vm=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},Qm=function(e){return Wm(e,23,4)},Hm=function(e){return Wm(e,52,8)},Jm=function(e,t){Om(e.prototype,t,{get:function(){return Rm(this)[t]}})},Xm=function(e,t,r,n){var i=km(r),s=Rm(e);if(i+t>s.byteLength)throw Bm(Pm);var o=Rm(s.buffer).bytes,a=i+s.byteOffset,c=o.slice(a,a+t);return n?c:c.reverse()},Ym=function(e,t,r,n,i,s){var o=km(r),a=Rm(e);if(o+t>a.byteLength)throw Bm(Pm);for(var c=Rm(a.buffer).bytes,u=o+a.byteOffset,l=n(+i),d=0;d<t;d++)c[u+d]=l[s?d:t-d-1]};if(mm){if(!bm((function(){Nm(1)}))||!bm((function(){new Nm(-1)}))||bm((function(){return new Nm,new Nm(1.5),new Nm(NaN),Nm.name!=jm}))){for(var Zm,eg=(Fm=function(e){return wm(this,Fm),new Nm(km(e))}).prototype=Nm.prototype,tg=Tm(Nm),rg=0;tg.length>rg;)(Zm=tg[rg++])in Fm||gm(Fm,Zm,Nm[Zm]);eg.constructor=Fm}Im&&Em(Um)!==qm&&Im(Um,qm);var ng=new Dm(new Fm(2)),ig=Um.setInt8;ng.setInt8(0,2147483648),ng.setInt8(1,2147483649),!ng.getInt8(0)&&ng.getInt8(1)||ym(Um,{setInt8:function(e,t){ig.call(this,e,t<<24>>24)},setUint8:function(e,t){ig.call(this,e,t<<24>>24)}},{unsafe:!0})}else Fm=function(e){wm(this,Fm,jm);var t=km(e);Lm(this,{bytes:Cm.call(new Array(t),0),byteLength:t}),vm||(this.byteLength=t)},Dm=function(e,t,r){wm(this,Dm,Mm),wm(e,Fm,Mm);var n=Rm(e).byteLength,i=xm(t);if(i<0||i>n)throw Bm("Wrong offset");if(i+(r=void 0===r?n-i:_m(r))>n)throw Bm("Wrong length");Lm(this,{buffer:e,byteLength:r,byteOffset:i}),vm||(this.buffer=e,this.byteLength=r,this.byteOffset=i)},vm&&(Jm(Fm,"byteLength"),Jm(Dm,"buffer"),Jm(Dm,"byteLength"),Jm(Dm,"byteOffset")),ym(Dm.prototype,{getInt8:function(e){return Xm(this,1,e)[0]<<24>>24},getUint8:function(e){return Xm(this,1,e)[0]},getInt16:function(e){var t=Xm(this,2,e,arguments.length>1?arguments[1]:void 0);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=Xm(this,2,e,arguments.length>1?arguments[1]:void 0);return t[1]<<8|t[0]},getInt32:function(e){return Vm(Xm(this,4,e,arguments.length>1?arguments[1]:void 0))},getUint32:function(e){return Vm(Xm(this,4,e,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(e){return zm(Xm(this,4,e,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(e){return zm(Xm(this,8,e,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(e,t){Ym(this,1,e,Km,t)},setUint8:function(e,t){Ym(this,1,e,Km,t)},setInt16:function(e,t){Ym(this,2,e,Gm,t,arguments.length>2?arguments[2]:void 0)},setUint16:function(e,t){Ym(this,2,e,Gm,t,arguments.length>2?arguments[2]:void 0)},setInt32:function(e,t){Ym(this,4,e,$m,t,arguments.length>2?arguments[2]:void 0)},setUint32:function(e,t){Ym(this,4,e,$m,t,arguments.length>2?arguments[2]:void 0)},setFloat32:function(e,t){Ym(this,4,e,Qm,t,arguments.length>2?arguments[2]:void 0)},setFloat64:function(e,t){Ym(this,8,e,Hm,t,arguments.length>2?arguments[2]:void 0)}});Am(Fm,jm),Am(Dm,Mm);var sg={ArrayBuffer:Fm,DataView:Dm},og=Hr,ag=u,cg=F,ug=lr,lg=k,dg=Xn,pg=sg.ArrayBuffer,fg=sg.DataView,hg=pg.prototype.slice;og({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:ag((function(){return!new pg(2).slice(1,void 0).byteLength}))},{slice:function(e,t){if(void 0!==hg&&void 0===t)return hg.call(cg(this),e);for(var r=cg(this).byteLength,n=ug(e,r),i=ug(void 0===t?r:t,r),s=new(dg(this,pg))(lg(i-n)),o=new fg(this),a=new fg(s),c=0;n<i;)a.setUint8(c++,o.getUint8(n++));return s}});var vg,mg={exports:{}},gg=rm,yg=O,bg=i,wg=S,xg=oe,_g=En,kg=Q,Sg=_t.exports,Eg=C.f,Ig=Ga,Tg=rn,Og=Me,Cg=ue,Ag=bg.Int8Array,Rg=Ag&&Ag.prototype,Lg=bg.Uint8ClampedArray,jg=Lg&&Lg.prototype,Mg=Ag&&Ig(Ag),Pg=Rg&&Ig(Rg),Ng=Object.prototype,Fg=Ng.isPrototypeOf,Dg=Og("toStringTag"),Ug=Cg("TYPED_ARRAY_TAG"),qg=gg&&!!Tg&&"Opera"!==_g(bg.opera),Bg=!1,Wg={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},zg={BigInt64Array:8,BigUint64Array:8},Kg=function(e){if(!wg(e))return!1;var t=_g(e);return xg(Wg,t)||xg(zg,t)};for(vg in Wg)bg[vg]||(qg=!1);if((!qg||"function"!=typeof Mg||Mg===Function.prototype)&&(Mg=function(){throw TypeError("Incorrect invocation")},qg))for(vg in Wg)bg[vg]&&Tg(bg[vg],Mg);if((!qg||!Pg||Pg===Ng)&&(Pg=Mg.prototype,qg))for(vg in Wg)bg[vg]&&Tg(bg[vg].prototype,Pg);if(qg&&Ig(jg)!==Pg&&Tg(jg,Pg),yg&&!xg(Pg,Dg))for(vg in Bg=!0,Eg(Pg,Dg,{get:function(){return wg(this)?this[Ug]:void 0}}),Wg)bg[vg]&&kg(bg[vg],Ug,vg);var Gg={NATIVE_ARRAY_BUFFER_VIEWS:qg,TYPED_ARRAY_TAG:Bg&&Ug,aTypedArray:function(e){if(Kg(e))return e;throw TypeError("Target is not a typed array")},aTypedArrayConstructor:function(e){if(Tg){if(Fg.call(Mg,e))return e}else for(var t in Wg)if(xg(Wg,vg)){var r=bg[t];if(r&&(e===r||Fg.call(r,e)))return e}throw TypeError("Target is not a typed array constructor")},exportTypedArrayMethod:function(e,t,r){if(yg){if(r)for(var n in Wg){var i=bg[n];if(i&&xg(i.prototype,e))try{delete i.prototype[e]}catch(e){}}Pg[e]&&!r||Sg(Pg,e,r?t:qg&&Rg[e]||t)}},exportTypedArrayStaticMethod:function(e,t,r){var n,i;if(yg){if(Tg){if(r)for(n in Wg)if((i=bg[n])&&xg(i,e))try{delete i[e]}catch(e){}if(Mg[e]&&!r)return;try{return Sg(Mg,e,r?t:qg&&Mg[e]||t)}catch(e){}}for(n in Wg)!(i=bg[n])||i[e]&&!r||Sg(i,e,t)}},isView:function(e){if(!wg(e))return!1;var t=_g(e);return"DataView"===t||xg(Wg,t)||xg(zg,t)},isTypedArray:Kg,TypedArray:Mg,TypedArrayPrototype:Pg},$g=i,Vg=u,Qg=Vn,Hg=Gg.NATIVE_ARRAY_BUFFER_VIEWS,Jg=$g.ArrayBuffer,Xg=$g.Int8Array,Yg=!Hg||!Vg((function(){Xg(1)}))||!Vg((function(){new Xg(-1)}))||!Qg((function(e){new Xg,new Xg(null),new Xg(1.5),new Xg(e)}),!0)||Vg((function(){return 1!==new Xg(new Jg(2),1,void 0).length})),Zg=w,ey=function(e){var t=Zg(e);if(t<0)throw RangeError("The argument can't be less than 0");return t},ty=g,ry=k,ny=Cn,iy=yn,sy=c,oy=Gg.aTypedArrayConstructor,ay=Hr,cy=i,uy=O,ly=Yg,dy=Gg,py=sg,fy=fn,hy=G,vy=Q,my=k,gy=sm,yy=function(e,t){var r=ey(e);if(r%t)throw RangeError("Wrong offset");return r},by=U,wy=oe,xy=En,_y=S,ky=gc,Sy=rn,Ey=or.f,Iy=function(e){var t,r,n,i,s,o,a=ty(e),c=arguments.length,u=c>1?arguments[1]:void 0,l=void 0!==u,d=ny(a);if(null!=d&&!iy(d))for(o=(s=d.call(a)).next,a=[];!(i=o.call(s)).done;)a.push(i.value);for(l&&c>2&&(u=sy(u,arguments[2],2)),r=ry(a.length),n=new(oy(this))(r),t=0;r>t;t++)n[t]=l?u(a[t],t):a[t];return n},Ty=$e.forEach,Oy=pn,Cy=C,Ay=ot,Ry=ud,Ly=Xt.get,jy=Xt.set,My=Cy.f,Py=Ay.f,Ny=Math.round,Fy=cy.RangeError,Dy=py.ArrayBuffer,Uy=py.DataView,qy=dy.NATIVE_ARRAY_BUFFER_VIEWS,By=dy.TYPED_ARRAY_TAG,Wy=dy.TypedArray,zy=dy.TypedArrayPrototype,Ky=dy.aTypedArrayConstructor,Gy=dy.isTypedArray,$y="BYTES_PER_ELEMENT",Vy="Wrong length",Qy=function(e,t){for(var r=0,n=t.length,i=new(Ky(e))(n);n>r;)i[r]=t[r++];return i},Hy=function(e,t){My(e,t,{get:function(){return Ly(this)[t]}})},Jy=function(e){var t;return e instanceof Dy||"ArrayBuffer"==(t=xy(e))||"SharedArrayBuffer"==t},Xy=function(e,t){return Gy(e)&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Yy=function(e,t){return Xy(e,t=by(t,!0))?hy(2,e[t]):Py(e,t)},Zy=function(e,t,r){return!(Xy(e,t=by(t,!0))&&_y(r)&&wy(r,"value"))||wy(r,"get")||wy(r,"set")||r.configurable||wy(r,"writable")&&!r.writable||wy(r,"enumerable")&&!r.enumerable?My(e,t,r):(e[t]=r.value,e)};uy?(qy||(Ay.f=Yy,Cy.f=Zy,Hy(zy,"buffer"),Hy(zy,"byteOffset"),Hy(zy,"byteLength"),Hy(zy,"length")),ay({target:"Object",stat:!0,forced:!qy},{getOwnPropertyDescriptor:Yy,defineProperty:Zy}),mg.exports=function(e,t,r){var n=e.match(/\d+$/)[0]/8,i=e+(r?"Clamped":"")+"Array",s="get"+e,o="set"+e,a=cy[i],c=a,u=c&&c.prototype,l={},d=function(e,t){My(e,t,{get:function(){return function(e,t){var r=Ly(e);return r.view[s](t*n+r.byteOffset,!0)}(this,t)},set:function(e){return function(e,t,i){var s=Ly(e);r&&(i=(i=Ny(i))<0?0:i>255?255:255&i),s.view[o](t*n+s.byteOffset,i,!0)}(this,t,e)},enumerable:!0})};qy?ly&&(c=t((function(e,t,r,s){return fy(e,c,i),Ry(_y(t)?Jy(t)?void 0!==s?new a(t,yy(r,n),s):void 0!==r?new a(t,yy(r,n)):new a(t):Gy(t)?Qy(c,t):Iy.call(c,t):new a(gy(t)),e,c)})),Sy&&Sy(c,Wy),Ty(Ey(a),(function(e){e in c||vy(c,e,a[e])})),c.prototype=u):(c=t((function(e,t,r,s){fy(e,c,i);var o,a,u,l=0,p=0;if(_y(t)){if(!Jy(t))return Gy(t)?Qy(c,t):Iy.call(c,t);o=t,p=yy(r,n);var f=t.byteLength;if(void 0===s){if(f%n)throw Fy(Vy);if((a=f-p)<0)throw Fy(Vy)}else if((a=my(s)*n)+p>f)throw Fy(Vy);u=a/n}else u=gy(t),o=new Dy(a=u*n);for(jy(e,{buffer:o,byteOffset:p,byteLength:a,length:u,view:new Uy(o)});l<u;)d(e,l++)})),Sy&&Sy(c,Wy),u=c.prototype=ky(zy)),u.constructor!==c&&vy(u,"constructor",c),By&&vy(u,By,i),l[i]=c,ay({global:!0,forced:c!=a,sham:!qy},l),$y in c||vy(c,$y,n),$y in u||vy(u,$y,n),Oy(i)}):mg.exports=function(){},(0,mg.exports)("Uint8",(function(e){return function(t,r,n){return e(this,t,r,n)}}));var eb=Math.floor,tb=function(e,t){var r=e.length,n=eb(r/2);return r<8?rb(e,t):nb(tb(e.slice(0,n),t),tb(e.slice(n),t),t)},rb=function(e,t){for(var r,n,i=e.length,s=1;s<i;){for(n=s,r=e[s];n&&t(e[n-1],r)>0;)e[n]=e[--n];n!==s++&&(e[n]=r)}return e},nb=function(e,t,r){for(var n=e.length,i=t.length,s=0,o=0,a=[];s<n||o<i;)s<n&&o<i?a.push(r(e[s],t[o])<=0?e[s++]:t[o++]):a.push(s<n?e[s++]:t[o++]);return a},ib=tb,sb=ve.match(/firefox\/(\d+)/i),ob=!!sb&&+sb[1],ab=/MSIE|Trident/.test(ve),cb=ve.match(/AppleWebKit\/(\d+)\./),ub=!!cb&&+cb[1],lb=u,db=o,pb=k,fb=ib,hb=ob,vb=ab,mb=we,gb=ub,yb=Gg.aTypedArray,bb=Gg.exportTypedArrayMethod,wb=i.Uint16Array,xb=wb&&wb.prototype.sort,_b=!!xb&&!lb((function(){var e=new wb(2);e.sort(null),e.sort({})})),kb=!!xb&&!lb((function(){if(mb)return mb<74;if(hb)return hb<67;if(vb)return!0;if(gb)return gb<602;var e,t,r=new wb(516),n=Array(516);for(e=0;e<516;e++)t=e%4,r[e]=515-e,n[e]=e-2*t+3;for(r.sort((function(e,t){return(e/4|0)-(t/4|0)})),e=0;e<516;e++)if(r[e]!==n[e])return!0}));bb("sort",(function(e){var t=this;if(void 0!==e&&db(e),kb)return xb.call(t,e);yb(t);var r,n=pb(t.length),i=Array(n);for(r=0;r<n;r++)i[r]=t[r];for(i=fb(t,function(e){return function(t,r){return void 0!==e?+e(t,r)||0:r!=r?-1:t!=t?1:0===t&&0===r?1/t>0&&1/r<0?1:-1:t>r}}(e)),r=0;r<n;r++)t[r]=i[r];return t}),!kb||_b);var Sb=Gg,Eb=u,Ib=i.Int8Array,Tb=Sb.aTypedArray,Ob=Sb.exportTypedArrayMethod,Cb=[].toLocaleString,Ab=[].slice,Rb=!!Ib&&Eb((function(){Cb.call(new Ib(1))}));Ob("toLocaleString",(function(){return Cb.apply(Rb?Ab.call(Tb(this)):Tb(this),arguments)}),Eb((function(){return[1,2].toLocaleString()!=new Ib([1,2]).toLocaleString()}))||!Eb((function(){Ib.prototype.toLocaleString.call([1,2])})));var Lb=S,jb=d,Mb=Me("match"),Pb=Rv,Nb=function(e){var t;return Lb(e)&&(void 0!==(t=e[Mb])?!!t:"RegExp"==jb(e))},Fb=F,Db=v,Ub=Xn,qb=jv,Bb=k,Wb=Bv,zb=kv,Kb=u,Gb=nv.UNSUPPORTED_Y,$b=[].push,Vb=Math.min,Qb=4294967295;Pb("split",(function(e,t,r){var n;return n="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length?function(e,r){var n=String(Db(this)),i=void 0===r?Qb:r>>>0;if(0===i)return[];if(void 0===e)return[n];if(!Nb(e))return t.call(n,e,i);for(var s,o,a,c=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),l=0,d=new RegExp(e.source,u+"g");(s=zb.call(d,n))&&!((o=d.lastIndex)>l&&(c.push(n.slice(l,s.index)),s.length>1&&s.index<n.length&&$b.apply(c,s.slice(1)),a=s[0].length,l=o,c.length>=i));)d.lastIndex===s.index&&d.lastIndex++;return l===n.length?!a&&d.test("")||c.push(""):c.push(n.slice(l)),c.length>i?c.slice(0,i):c}:"0".split(void 0,0).length?function(e,r){return void 0===e&&0===r?[]:t.call(this,e,r)}:t,[function(t,r){var i=Db(this),s=null==t?void 0:t[e];return void 0!==s?s.call(t,i,r):n.call(String(i),t,r)},function(e,i){var s=r(n,this,e,i,n!==t);if(s.done)return s.value;var o=Fb(this),a=String(e),c=Ub(o,RegExp),u=o.unicode,l=(o.ignoreCase?"i":"")+(o.multiline?"m":"")+(o.unicode?"u":"")+(Gb?"g":"y"),d=new c(Gb?"^(?:"+o.source+")":o,l),p=void 0===i?Qb:i>>>0;if(0===p)return[];if(0===a.length)return null===Wb(d,a)?[a]:[];for(var f=0,h=0,v=[];h<a.length;){d.lastIndex=Gb?0:h;var m,g=Wb(d,Gb?a.slice(h):a);if(null===g||(m=Vb(Bb(d.lastIndex+(Gb?h:0)),a.length))===f)h=qb(a,h,u);else{if(v.push(a.slice(f,h)),v.length===p)return v;for(var y=1;y<=g.length-1;y++)if(v.push(g[y]),v.length===p)return v;h=f=m}}return v.push(a.slice(f)),v}]}),!!Kb((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var r="ab".split(e);return 2!==r.length||"a"!==r[0]||"b"!==r[1]})),Gb);var Hb={};
/*
	@license
	Copyright (c) 2016, Twilio, Inc.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted, provided that the above
	copyright notice and this permission notice appear in all copies.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
	WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
	MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY
	SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
	WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION
	OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF OR IN
	CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.

	*/function Jb(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}Object.defineProperty(Hb,"__esModule",{value:!0});var Xb=Jb(Df.exports);function Yb(){}function Zb(){Zb.init.call(this)}function ew(e){return void 0===e._maxListeners?Zb.defaultMaxListeners:e._maxListeners}function tw(e,t,r){if(t)e.call(r);else for(var n=e.length,i=uw(e,n),s=0;s<n;++s)i[s].call(r)}function rw(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,s=uw(e,i),o=0;o<i;++o)s[o].call(r,n)}function nw(e,t,r,n,i){if(t)e.call(r,n,i);else for(var s=e.length,o=uw(e,s),a=0;a<s;++a)o[a].call(r,n,i)}function iw(e,t,r,n,i,s){if(t)e.call(r,n,i,s);else for(var o=e.length,a=uw(e,o),c=0;c<o;++c)a[c].call(r,n,i,s)}function sw(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,s=uw(e,i),o=0;o<i;++o)s[o].apply(r,n)}function ow(e,t,r,n){var i,s,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]):(s=e._events=new Yb,e._eventsCount=0),o){if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),!o.warned&&(i=ew(e))&&i>0&&o.length>i){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else o=s[t]=r,++e._eventsCount;return e}function aw(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function cw(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function uw(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}Yb.prototype=Object.create(null),Zb.EventEmitter=Zb,Zb.usingDomains=!1,Zb.prototype.domain=void 0,Zb.prototype._events=void 0,Zb.prototype._maxListeners=void 0,Zb.defaultMaxListeners=10,Zb.init=function(){this.domain=null,Zb.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new Yb,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Zb.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},Zb.prototype.getMaxListeners=function(){return ew(this)},Zb.prototype.emit=function(e){var t,r,n,i,s,o,a,c="error"===e;if(o=this._events)c=c&&null==o.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=o[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:tw(r,l,this);break;case 2:rw(r,l,this,arguments[1]);break;case 3:nw(r,l,this,arguments[1],arguments[2]);break;case 4:iw(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),s=1;s<n;s++)i[s-1]=arguments[s];sw(r,l,this,i)}return!0},Zb.prototype.addListener=function(e,t){return ow(this,e,t,!1)},Zb.prototype.on=Zb.prototype.addListener,Zb.prototype.prependListener=function(e,t){return ow(this,e,t,!0)},Zb.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,aw(this,e,t)),this},Zb.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,aw(this,e,t)),this},Zb.prototype.removeListener=function(e,t){var r,n,i,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new Yb:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new Yb,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,o||t)}return this},Zb.prototype.off=function(e,t){return this.removeListener(e,t)},Zb.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new Yb,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new Yb:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),s=0;s<i.length;++s)"removeListener"!==(n=i[s])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new Yb,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},Zb.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},Zb.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):cw.call(e,t)},Zb.prototype.listenerCount=cw,Zb.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};class lw extends Zb{constructor(e){super(),Xb.default(this,"timeout",null),Xb.default(this,"startTimestamp",-1),this.minDelay=e.min,this.maxDelay=e.max,this.initialDelay=e.initial||0,this.maxAttemptsCount=e.maxAttemptsCount||0,this.maxAttemptsTime=e.maxAttemptsTime||0,this.randomness=e.randomness||0,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}attempt(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.attemptNum++,this.emit("attempt",this)}nextDelay(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;var t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}randomize(e){var t=e*this.randomness,r=Math.round(Math.random()*t*2-t);return Math.max(0,e+r)}scheduleAttempt(e){if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt count limit reached"));var t=this.nextDelay(e);if(t=this.randomize(t),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+t)return this.cleanup(),void this.emit("failed",new Error("Maximum attempt time limit reached"));this.timeout=setTimeout((()=>this.attempt()),t)}cleanup(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null),this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}start(){if(this.inProgress)throw new Error("Retrier is already in progress");this.inProgress=!0,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)}cancel(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"))}succeeded(e){this.emit("succeeded",e)}failed(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}}function dw(e){return null!=e}class pw extends Zb{constructor(e){super(),Xb.default(this,"backoffDelay",0),Xb.default(this,"nextBackoffDelay",0),Xb.default(this,"backoffNumber",0),Xb.default(this,"timeoutID",null),Xb.default(this,"maxNumberOfRetry",-1);var t=e=e||{},r=t.initialDelay,n=t.maxDelay,i=t.randomisationFactor,s=t.factor;if(dw(r)&&r<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(dw(n)&&n<=1)throw new Error("The maximal timeout must be greater than 1.");if(dw(i)&&(i<0||i>1))throw new Error("The randomisation factor must be between 0 and 1.");if(dw(s)&&s<=1)throw new Error("Exponential factor should be greater than 1.");if(this.initialDelay=r||100,this.maxDelay=n||1e4,this.maxDelay<=this.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");this.randomisationFactor=i||0,this.factor=s||2,this.reset()}static exponential(e){return new pw(e)}backoff(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}reset(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,this.timeoutID&&clearTimeout(this.timeoutID),this.timeoutID=null}failAfter(e){if(e<=0)throw new Error("Expected a maximum number of retry greater than 0 but got ".concat(e));this.maxNumberOfRetry=e}next(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;var e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}onBackoff(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}Hb.AsyncRetrier=class extends Zb{constructor(e){super(),Xb.default(this,"resolve",(()=>{})),Xb.default(this,"reject",(()=>{})),this.retrier=new lw(e)}run(e){return this.retrier.on("attempt",(()=>{e().then((e=>this.retrier.succeeded(e))).catch((e=>this.retrier.failed(e)))})),this.retrier.on("succeeded",(e=>this.resolve(e))),this.retrier.on("cancelled",(()=>this.reject(new Error("Cancelled")))),this.retrier.on("failed",(e=>this.reject(e))),new Promise(((e,t)=>{this.resolve=e,this.reject=t,this.retrier.start()}))}cancel(){this.retrier.cancel()}};var fw=Hb.Backoff=pw,hw=Hb.Retrier=lw;_h("Map",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),Ph);var vw={exports:{}};
/*!
	 * Platform.js v1.3.6
	 * Copyright 2014-2020 Benjamin Tan
	 * Copyright 2011-2013 John-David Dalton
	 * Available under MIT license
	 */!function(e,r){(function(){var n={function:!0,object:!0}[typeof window]&&window||this,i=r,s=e&&!e.nodeType&&e,o=i&&s&&"object"==typeof t&&t;!o||o.global!==o&&o.window!==o&&o.self!==o||(n=o);var a=Math.pow(2,53)-1,c=/\bOpera/,u=Object.prototype,l=u.hasOwnProperty,d=u.toString;function p(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function f(e){return e=y(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:p(e)}function h(e,t){for(var r in e)l.call(e,r)&&t(e[r],r,e)}function v(e){return null==e?p(e):d.call(e).slice(8,-1)}function m(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function g(e,t){var r=null;return function(e,t){var r=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=a)for(;++r<n;)t(e[r],r,e);else h(e,t)}(e,(function(n,i){r=t(r,n,i,e)})),r}function y(e){return String(e).replace(/^ +| +$/g,"")}var b=function e(t){var r=n,i=t&&"object"==typeof t&&"String"!=v(t);i&&(r=t,t=null);var s=r.navigator||{},o=s.userAgent||"";t||(t=o);var a,u,l=i?!!s.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(d.toString()),p="Object",b=i?p:"ScriptBridgingProxyObject",w=i?p:"Environment",x=i&&r.java?"JavaPackage":v(r.java),_=i?p:"RuntimeObject",k=/\bJava/.test(x)&&r.java,S=k&&v(r.environment)==w,E=k?"a":"α",I=k?"b":"β",T=r.document||{},O=r.operamini||r.opera,C=c.test(C=i&&O?O["[[Class]]"]:v(O))?C:O=null,A=t,R=[],L=null,j=t==o,M=j&&O&&"function"==typeof O.version&&O.version(),P=g([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,r){return e||RegExp("\\b"+(r.pattern||m(r))+"\\b","i").exec(t)&&(r.label||r)})),N=function(e){return g(e,(function(e,r){return e||RegExp("\\b"+(r.pattern||m(r))+"\\b","i").exec(t)&&(r.label||r)}))}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"(?:Edge|Edg|EdgA|EdgiOS)"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Vivaldi","Waterfox","WebPositive",{label:"Yandex Browser",pattern:"YaBrowser"},{label:"UC Browser",pattern:"UCBrowser"},"Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chromium","Chrome",{label:"Chrome",pattern:"(?:HeadlessChrome)"},{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),F=q([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),D=function(e){return g(e,(function(e,r,n){return e||(r[F]||r[/^[a-z]+(?: +[a-z]+\b)*/i.exec(F)]||RegExp("\\b"+m(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n}))}({Apple:{iPad:1,iPhone:1,iPod:1},Alcatel:{},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},Huawei:{},Lenovo:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Oppo:{},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1},Xiaomi:{Mi:1,Redmi:1}}),U=function(e){return g(e,(function(e,r){var n=r.pattern||m(r);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,r){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&r&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&r&&(e=e.replace(RegExp(t,"i"),r)),f(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,r.label||r)),e}))}(["Windows Phone","KaiOS","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian",{label:"DragonFly BSD",pattern:"DragonFly"},"Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function q(e){return g(e,(function(e,r){var n=r.pattern||m(r);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(r.label&&!RegExp(n,"i").test(r.label)?r.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),r=r.label||r,e=f(e[0].replace(RegExp(n,"i"),r).replace(RegExp("; *(?:"+r+"[_-])?","i")," ").replace(RegExp("("+r+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}function B(e){return g(e,(function(e,r){return e||(RegExp(r+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))}if(P&&(P=[P]),/\bAndroid\b/.test(U)&&!F&&(a=/\bAndroid[^;]*;(.*?)(?:Build|\) AppleWebKit)\b/i.exec(t))&&(F=y(a[1]).replace(/^[a-z]{2}-[a-z]{2};\s*/i,"")||null),D&&!F?F=q([D]):D&&F&&(F=F.replace(RegExp("^("+m(D)+")[-_.\\s]","i"),D+" ").replace(RegExp("^("+m(D)+")[-_.]?(\\w)","i"),D+" $2")),(a=/\bGoogle TV\b/.exec(F))&&(F=a[0]),/\bSimulator\b/i.test(t)&&(F=(F?F+" ":"")+"Simulator"),"Opera Mini"==N&&/\bOPiOS\b/.test(t)&&R.push("running in Turbo/Uncompressed mode"),"IE"==N&&/\blike iPhone OS\b/.test(t)?(D=(a=e(t.replace(/like iPhone OS/,""))).manufacturer,F=a.product):/^iP/.test(F)?(N||(N="Safari"),U="iOS"+((a=/ OS ([\d_]+)/i.exec(t))?" "+a[1].replace(/_/g,"."):"")):"Konqueror"==N&&/^Linux\b/i.test(U)?U="Kubuntu":D&&"Google"!=D&&(/Chrome/.test(N)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(F))||/\bAndroid\b/.test(U)&&/^Chrome/.test(N)&&/\bVersion\//i.test(t)?(N="Android Browser",U=/\bAndroid\b/.test(U)?U:"Android"):"Silk"==N?(/\bMobi/i.test(t)||(U="Android",R.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&R.unshift("accelerated")):"UC Browser"==N&&/\bUCWEB\b/.test(t)?R.push("speed mode"):"PaleMoon"==N&&(a=/\bFirefox\/([\d.]+)\b/.exec(t))?R.push("identifying as Firefox "+a[1]):"Firefox"==N&&(a=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(U||(U="Firefox OS"),F||(F=a[1])):!N||(a=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(N))?(N&&!F&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(a+"/")+8))&&(N=null),(a=F||D||U)&&(F||D||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(U))&&(N=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(U)?U:a)+" Browser")):"Electron"==N&&(a=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&R.push("Chromium "+a),M||(M=B(["(?:Cloud9|CriOS|CrMo|Edge|Edg|EdgA|EdgiOS|FxiOS|HeadlessChrome|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$)|UCBrowser|YaBrowser)","Version",m(N),"(?:Firefox|Minefield|NetFront)"])),(a=("iCab"==P&&parseFloat(M)>3?"WebKit":/\bOpera\b/.test(N)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(P)&&"WebKit"||!P&&/\bMSIE\b/i.test(t)&&("Mac OS"==U?"Tasman":"Trident")||"WebKit"==P&&/\bPlayStation\b(?! Vita\b)/i.test(N)&&"NetFront")&&(P=[a]),"IE"==N&&(a=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(N+=" Mobile",U="Windows Phone "+(/\+$/.test(a)?a:a+".x"),R.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(N="IE Mobile",U="Windows Phone 8.x",R.unshift("desktop mode"),M||(M=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=N&&"Trident"==P&&(a=/\brv:([\d.]+)/.exec(t))&&(N&&R.push("identifying as "+N+(M?" "+M:"")),N="IE",M=a[1]),j){if(function(e,t){var r=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(r)||"object"==r&&!e[t])}(r,"global"))if(k&&(A=(a=k.lang.System).getProperty("os.arch"),U=U||a.getProperty("os.name")+" "+a.getProperty("os.version")),S){try{M=r.require("ringo/engine").version.join("."),N="RingoJS"}catch(e){(a=r.system)&&a.global.system==r.system&&(N="Narwhal",U||(U=a[0].os||null))}N||(N="Rhino")}else"object"==typeof r.process&&!r.process.browser&&(a=r.process)&&("object"==typeof a.versions&&("string"==typeof a.versions.electron?(R.push("Node "+a.versions.node),N="Electron",M=a.versions.electron):"string"==typeof a.versions.nw&&(R.push("Chromium "+M,"Node "+a.versions.node),N="NW.js",M=a.versions.nw)),N||(N="Node.js",A=a.arch,U=a.platform,M=(M=/[\d.]+/.exec(a.version))?M[0]:null));else v(a=r.runtime)==b?(N="Adobe AIR",U=a.flash.system.Capabilities.os):v(a=r.phantom)==_?(N="PhantomJS",M=(a=a.version||null)&&a.major+"."+a.minor+"."+a.patch):"number"==typeof T.documentMode&&(a=/\bTrident\/(\d+)/i.exec(t))?(M=[M,T.documentMode],(a=+a[1]+4)!=M[1]&&(R.push("IE "+M[1]+" mode"),P&&(P[1]=""),M[1]=a),M="IE"==N?String(M[1].toFixed(1)):M[0]):"number"==typeof T.documentMode&&/^(?:Chrome|Firefox)\b/.test(N)&&(R.push("masking as "+N+" "+M),N="IE",M="11.0",P=["Trident"],U="Windows");U=U&&f(U)}if(M&&(a=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(M)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(j&&s.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(L=/b/i.test(a)?"beta":"alpha",M=M.replace(RegExp(a+"\\+?$"),"")+("beta"==L?I:E)+(/\d+\+?/.exec(a)||"")),"Fennec"==N||"Firefox"==N&&/\b(?:Android|Firefox OS|KaiOS)\b/.test(U))N="Firefox Mobile";else if("Maxthon"==N&&M)M=M.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(F))"Xbox 360"==F&&(U=null),"Xbox 360"==F&&/\bIEMobile\b/.test(t)&&R.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(N)&&(!N||F||/Browser|Mobi/.test(N))||"Windows CE"!=U&&!/Mobi/i.test(t))if("IE"==N&&j)try{null===r.external&&R.unshift("platform preview")}catch(e){R.unshift("embedded")}else(/\bBlackBerry\b/.test(F)||/\bBB10\b/.test(t))&&(a=(RegExp(F.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||M)?(U=((a=[a,/BB10/.test(t)])[1]?(F=null,D="BlackBerry"):"Device Software")+" "+a[0],M=null):this!=h&&"Wii"!=F&&(j&&O||/Opera/.test(N)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==N&&/\bOS X (?:\d+\.){2,}/.test(U)||"IE"==N&&(U&&!/^Win/.test(U)&&M>5.5||/\bWindows XP\b/.test(U)&&M>8||8==M&&!/\bTrident\b/.test(t)))&&!c.test(a=e.call(h,t.replace(c,"")+";"))&&a.name&&(a="ing as "+a.name+((a=a.version)?" "+a:""),c.test(N)?(/\bIE\b/.test(a)&&"Mac OS"==U&&(U=null),a="identify"+a):(a="mask"+a,N=C?f(C.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(a)&&(U=null),j||(M=null)),P=["Presto"],R.push(a));else N+=" Mobile";(a=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(a=[parseFloat(a.replace(/\.(\d)$/,".0$1")),a],"Safari"==N&&"+"==a[1].slice(-1)?(N="WebKit Nightly",L="alpha",M=a[1].slice(0,-1)):M!=a[1]&&M!=(a[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(M=null),a[1]=(/\b(?:Headless)?Chrome\/([\d.]+)/i.exec(t)||0)[1],537.36==a[0]&&537.36==a[2]&&parseFloat(a[1])>=28&&"WebKit"==P&&(P=["Blink"]),j&&(l||a[1])?(P&&(P[1]="like Chrome"),a=a[1]||((a=a[0])<530?1:a<532?2:a<532.05?3:a<533?4:a<534.03?5:a<534.07?6:a<534.1?7:a<534.13?8:a<534.16?9:a<534.24?10:a<534.3?11:a<535.01?12:a<535.02?"13+":a<535.07?15:a<535.11?16:a<535.19?17:a<536.05?18:a<536.1?19:a<537.01?20:a<537.11?"21+":a<537.13?23:a<537.18?24:a<537.24?25:a<537.36?26:"Blink"!=P?"27":"28")):(P&&(P[1]="like Safari"),a=(a=a[0])<400?1:a<500?2:a<526?3:a<533?4:a<534?"4+":a<535?5:a<537?6:a<538?7:a<601?8:a<602?9:a<604?10:a<606?11:a<608?12:"12"),P&&(P[1]+=" "+(a+="number"==typeof a?".x":/[.+]/.test(a)?"":"+")),"Safari"==N&&(!M||parseInt(M)>45)?M=a:"Chrome"==N&&/\bHeadlessChrome/i.test(t)&&R.unshift("headless")),"Opera"==N&&(a=/\bzbov|zvav$/.exec(U))?(N+=" ",R.unshift("desktop mode"),"zvav"==a?(N+="Mini",M=null):N+="Mobile",U=U.replace(RegExp(" *"+a+"$"),"")):"Safari"==N&&/\bChrome\b/.exec(P&&P[1])?(R.unshift("desktop mode"),N="Chrome Mobile",M=null,/\bOS X\b/.test(U)?(D="Apple",U="iOS 4.3+"):U=null):/\bSRWare Iron\b/.test(N)&&!M&&(M=B("Chrome")),M&&0==M.indexOf(a=/[\d.]+$/.exec(U))&&t.indexOf("/"+a+"-")>-1&&(U=y(U.replace(a,""))),U&&-1!=U.indexOf(N)&&!RegExp(N+" OS").test(U)&&(U=U.replace(RegExp(" *"+m(N)+" *"),"")),P&&!/\b(?:Avant|Nook)\b/.test(N)&&(/Browser|Lunascape|Maxthon/.test(N)||"Safari"!=N&&/^iOS/.test(U)&&/\bSafari\b/.test(P[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|SRWare Iron|Vivaldi|Web)/.test(N)&&P[1])&&(a=P[P.length-1])&&R.push(a),R.length&&(R=["("+R.join("; ")+")"]),D&&F&&F.indexOf(D)<0&&R.push("on "+D),F&&R.push((/^on /.test(R[R.length-1])?"":"on ")+F),U&&(a=/ ([\d.+]+)$/.exec(U),u=a&&"/"==U.charAt(U.length-a[0].length-1),U={architecture:32,family:a&&!u?U.replace(a[0],""):U,version:a?a[1]:null,toString:function(){var e=this.version;return this.family+(e&&!u?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(a=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(A))&&!/\bi686\b/i.test(A)?(U&&(U.architecture=64,U.family=U.family.replace(RegExp(" *"+a),"")),N&&(/\bWOW64\b/i.test(t)||j&&/\w(?:86|32)$/.test(s.cpuClass||s.platform)&&!/\bWin64; x64\b/i.test(t))&&R.unshift("32-bit")):U&&/^OS X/.test(U.family)&&"Chrome"==N&&parseFloat(M)>=39&&(U.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=P&&P[0],W.manufacturer=D,W.name=N,W.prerelease=L,W.product=F,W.ua=t,W.version=N&&M,W.os=U||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=e,W.toString=function(){return this.description||""},W.version&&R.unshift(M),W.name&&R.unshift(N),U&&N&&(U!=String(U).split(" ")[0]||U!=N.split(" ")[0]&&!F)&&R.push(F?"("+U+")":"on "+U),R.length&&(W.description=R.join(" ")),W}();i&&s?h(b,(function(e,t){i[t]=e})):n.platform=b}).call(t)}(vw,vw.exports);var mw=F,gw=k,yw=v,bw=jv,ww=Bv;Rv("match",(function(e,t,r){return[function(t){var r=yw(this),n=null==t?void 0:t[e];return void 0!==n?n.call(t,r):new RegExp(t)[e](String(r))},function(e){var n=r(t,this,e);if(n.done)return n.value;var i=mw(this),s=String(e);if(!i.global)return ww(i,s);var o=i.unicode;i.lastIndex=0;for(var a,c=[],u=0;null!==(a=ww(i,s));){var l=String(a[0]);c[u]=l,""===l&&(i.lastIndex=bw(s,gw(i.lastIndex),o)),u++}return 0===u?null:c}]}));var xw=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t},_w=F,kw=v,Sw=xw,Ew=Bv;Rv("search",(function(e,t,r){return[function(t){var r=kw(this),n=null==t?void 0:t[e];return void 0!==n?n.call(t,r):new RegExp(t)[e](String(r))},function(e){var n=r(t,this,e);if(n.done)return n.value;var i=_w(this),s=String(e),o=i.lastIndex;Sw(o,0)||(i.lastIndex=0);var a=Ew(i,s);return Sw(i.lastIndex,o)||(i.lastIndex=o),null===a?-1:a.index}]}));var Iw=o,Tw=g,Ow=h,Cw=k,Aw=function(e){return function(t,r,n,i){Iw(r);var s=Tw(t),o=Ow(s),a=Cw(s.length),c=e?a-1:0,u=e?-1:1;if(n<2)for(;;){if(c in o){i=o[c],c+=u;break}if(c+=u,e?c<0:a<=c)throw TypeError("Reduce of empty array with no initial value")}for(;e?c>=0:a>c;c+=u)c in o&&(i=r(i,o[c],c,s));return i}},Rw={left:Aw(!1),right:Aw(!0)}.left,Lw=we,jw=ei;Hr({target:"Array",proto:!0,forced:!Qe("reduce")||!jw&&Lw>79&&Lw<83},{reduce:function(e){return Rw(this,e,arguments.length,arguments.length>1?arguments[1]:void 0)}}),
/*
	@license
	The following license applies to all parts of this software except as
	documented below.

	    Copyright (c) 2016, Twilio, inc.
	    All rights reserved.

	    Redistribution and use in source and binary forms, with or without
	    modification, are permitted provided that the following conditions are
	    met:

	      1. Redistributions of source code must retain the above copyright
	         notice, this list of conditions and the following disclaimer.

	      2. Redistributions in binary form must reproduce the above copyright
	         notice, this list of conditions and the following disclaimer in
	         the documentation and/or other materials provided with the
	         distribution.

	      3. Neither the name of Twilio nor the names of its contributors may
	         be used to endorse or promote products derived from this software
	         without specific prior written permission.

	    THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
	    "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
	    LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
	    A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
	    HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
	    SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
	    LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
	    DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
	    THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
	    (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
	    OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

	This software includes javascript-state-machine under the following license.

	    Copyright (c) 2012, 2013, 2014, 2015, Jake Gordon and contributors

	    Permission is hereby granted, free of charge, to any person obtaining a copy
	    of this software and associated documentation files (the "Software"), to deal
	    in the Software without restriction, including without limitation the rights
	    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	    copies of the Software, and to permit persons to whom the Software is
	    furnished to do so, subject to the following conditions:

	    The above copyright notice and this permission notice shall be included in all
	    copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
	    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	    LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	    OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE

	This software includes loglevel under the following license.

	    Copyright (c) 2013 Tim Perry

	    Permission is hereby granted, free of charge, to any person
	    obtaining a copy of this software and associated documentation
	    files (the "Software"), to deal in the Software without
	    restriction, including without limitation the rights to use,
	    copy, modify, merge, publish, distribute, sublicense, and/or sell
	    copies of the Software, and to permit persons to whom the
	    Software is furnished to do so, subject to the following
	    conditions:

	    The above copyright notice and this permission notice shall be
	    included in all copies or substantial portions of the Software.

	    THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
	    EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
	    OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
	    NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
	    HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
	    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
	    FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
	    OTHER DEALINGS IN THE SOFTWARE.


	*/
function(e){Object.defineProperty(e,"__esModule",{value:!0});var r=Ff.exports,n=Df.exports,i=Uf,s=Jo,o=Xf.exports,a=Nh.exports,c=rv,u=Hb,l=vw.exports;function d(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function p(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var f=d(r),h=d(n),v=d(i),m=p(o),g=p(a),y=p(l);function b(){}function w(){w.init.call(this)}function x(e){return void 0===e._maxListeners?w.defaultMaxListeners:e._maxListeners}function _(e,t,r){if(t)e.call(r);else for(var n=e.length,i=A(e,n),s=0;s<n;++s)i[s].call(r)}function k(e,t,r,n){if(t)e.call(r,n);else for(var i=e.length,s=A(e,i),o=0;o<i;++o)s[o].call(r,n)}function S(e,t,r,n,i){if(t)e.call(r,n,i);else for(var s=e.length,o=A(e,s),a=0;a<s;++a)o[a].call(r,n,i)}function E(e,t,r,n,i,s){if(t)e.call(r,n,i,s);else for(var o=e.length,a=A(e,o),c=0;c<o;++c)a[c].call(r,n,i,s)}function I(e,t,r,n){if(t)e.apply(r,n);else for(var i=e.length,s=A(e,i),o=0;o<i;++o)s[o].apply(r,n)}function T(e,t,r,n){var i,s,o,a;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),o=s[t]):(s=e._events=new b,e._eventsCount=0),o){if("function"==typeof o?o=s[t]=n?[r,o]:[o,r]:n?o.unshift(r):o.push(r),!o.warned&&(i=x(e))&&i>0&&o.length>i){o.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=o.length,a=c,"function"==typeof console.warn?console.warn(a):console.log(a)}}else o=s[t]=r,++e._eventsCount;return e}function O(e,t,r){var n=!1;function i(){e.removeListener(t,i),n||(n=!0,r.apply(e,arguments))}return i.listener=r,i}function C(e){var t=this._events;if(t){var r=t[e];if("function"==typeof r)return 1;if(r)return r.length}return 0}function A(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}b.prototype=Object.create(null),w.EventEmitter=w,w.usingDomains=!1,w.prototype.domain=void 0,w.prototype._events=void 0,w.prototype._maxListeners=void 0,w.defaultMaxListeners=10,w.init=function(){this.domain=null,w.usingDomains&&undefined.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new b,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},w.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},w.prototype.getMaxListeners=function(){return x(this)},w.prototype.emit=function(e){var t,r,n,i,s,o,a,c="error"===e;if(o=this._events)c=c&&null==o.error;else if(!c)return!1;if(a=this.domain,c){if(t=arguments[1],!a){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=a,t.domainThrown=!1,a.emit("error",t),!1}if(!(r=o[e]))return!1;var l="function"==typeof r;switch(n=arguments.length){case 1:_(r,l,this);break;case 2:k(r,l,this,arguments[1]);break;case 3:S(r,l,this,arguments[1],arguments[2]);break;case 4:E(r,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(n-1),s=1;s<n;s++)i[s-1]=arguments[s];I(r,l,this,i)}return!0},w.prototype.addListener=function(e,t){return T(this,e,t,!1)},w.prototype.on=w.prototype.addListener,w.prototype.prependListener=function(e,t){return T(this,e,t,!0)},w.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,O(this,e,t)),this},w.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,O(this,e,t)),this},w.prototype.removeListener=function(e,t){var r,n,i,s,o;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(n=this._events))return this;if(!(r=n[e]))return this;if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new b:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){o=r[s].listener,i=s;break}if(i<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new b,this;delete n[e]}else!function(e,t){for(var r=t,n=r+1,i=e.length;n<i;r+=1,n+=1)e[r]=e[n];e.pop()}(r,i);n.removeListener&&this.emit("removeListener",e,o||t)}return this},w.prototype.off=function(e,t){return this.removeListener(e,t)},w.prototype.removeAllListeners=function(e){var t,r;if(!(r=this._events))return this;if(!r.removeListener)return 0===arguments.length?(this._events=new b,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new b:delete r[e]),this;if(0===arguments.length){for(var n,i=Object.keys(r),s=0;s<i.length;++s)"removeListener"!==(n=i[s])&&this.removeAllListeners(n);return this.removeAllListeners("removeListener"),this._events=new b,this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},w.prototype.listeners=function(e){var t,r=this._events;return r&&(t=r[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[]},w.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):C.call(e,t)},w.prototype.listenerCount=C,w.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var R=m.getLogger("twilsock");function L(e,t){return["".concat((new Date).toISOString()," Twilsock ").concat(e,":")].concat(Array.from(t))}var j=new class{constructor(e){h.default(this,"prefix",""),this.prefix=null!=e&&e.length>0?" "+e+":":""}setLevel(e){R.setLevel(e)}static setLevel(e){R.setLevel(e)}trace(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.trace.apply(null,L("T",t))}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.debug.apply(null,L("D",t))}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.info.apply(null,L("I",t))}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.warn.apply(null,L("W",t))}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.error.apply(null,L("E",t))}static trace(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.trace.apply(null,L("T",t))}static debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.debug.apply(null,L("D",t))}static info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.info.apply(null,L("I",t))}static warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.warn.apply(null,L("W",t))}static error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];R.error.apply(null,L("E",t))}}("");class M{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};h.default(this,"confirmedCapabilities",new Set),this.activeGrant=t,this._token=e;var n=r.region||"us1",i="wss://tsock.".concat(n,".twilio.com/v3/wsconnect"),s=r.twilsock||r.Twilsock||{};this.url=s.uri||i,this._continuationToken=r.continuationToken?r.continuationToken:null,this.logLevel=r.logLevel?r.logLevel:"error",this.retryPolicy=r.retryPolicy?r.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=r.clientMetadata?r.clientMetadata:{},this.clientMetadata.ver="__TWILSOCK_CLIENT_VERSION_PLACEHOLDER__",this.initRegistrations=r.initRegistrations?r.initRegistrations:null,this.tweaks=r.tweaks?r.tweaks:null}get token(){return this._token}get continuationToken(){return this._continuationToken}updateToken(e){this._token=e}updateContinuationToken(e){this._continuationToken=e}}class P{constructor(e){this.id=e||"TM".concat(c.v4())}}class N extends P{constructor(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;super(),h.default(this,"method","init"),this.token=e,this.continuation_token=t,this.metadata=r,this.registrations=n,this.tweaks=i,this.capabilities=["client_update","offline_storage","telemetry.v1"]}}class F extends P{constructor(e,t,r,n,i,s,o){super(e),this.continuationToken=t,this.continuationTokenStatus=r,this.offlineStorage=n,this.initRegistrations=i,this.debugInfo=s,this.confirmedCapabilities=o}}class D extends P{constructor(e){super(),h.default(this,"method","update"),this.token=e}}class U extends P{constructor(e,t,r){super(),h.default(this,"method","message"),this.active_grant=e,this.payload_type=t,this.http_request=r}}class q extends P{constructor(e){super(e),h.default(this,"method","reply"),h.default(this,"payload_type","application/json"),h.default(this,"status",{code:200,status:"OK"})}}class B extends P{constructor(){super(),h.default(this,"method","close")}}class W{constructor(e,t,r,n,i,s){this.start=e,this.end=t,this.title=r,this.details=n,this.id=i,this.type=s}}class z extends P{constructor(e){super(),h.default(this,"method","telemetry.v1"),this.events=e}}function K(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode("0x"+t))).length}function G(e){var t=Array.prototype.map.call(e,(e=>String.fromCharCode(e))).join("").replace(/(.)/g,((e,t)=>{var r=t.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}));return decodeURIComponent(t)}function $(e){return JSON.parse(G(e))}class V{constructor(){}static parse(e){var t=new Uint8Array(e),r=function(e){for(var t="",r=0;r<e.length;++r){var n=String.fromCharCode(e[r]);if(t+=n,"\r"===n){r+=2;break}}var i=t.split(" ");return{size:r,protocol:i[0],version:i[1],headerSize:Number(i[2])}}(t);if("TWILSOCK"===r.protocol&&"V3.0"===r.version){var n=null;try{n=$(t.subarray(r.size,r.size+r.headerSize))}catch(t){return void j.error("failed to parse message header",t,e)}j.debug("message received: ",n.method),j.trace("message received: ",n);var i=null;if(n.payload_size>0){var s=2+r.size+r.headerSize,o=n.payload_size;if(n.hasOwnProperty("payload_type")&&0!==n.payload_type.indexOf("application/json"))0===n.payload_type.indexOf("text/plain")&&(i=G(t.subarray(s,s+o)));else try{i=$(t.subarray(s,s+o))}catch(t){return void j.error("failed to parse message body",t,e)}}return{method:n.method,header:n,payload:i}}j.error("unsupported protocol: ".concat(r.protocol," ver ").concat(r.version))}static createPacket(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";e.payload_size=K(t);var r,n,i=JSON.stringify(e),s="TWILSOCK V3.0 "+K(i);return j.debug("send request:",s+i+t),(r=encodeURIComponent(s+"\r\n"+i+"\r\n"+t).replace(/%([0-9A-F]{2})/g,((e,t)=>String.fromCharCode("0x"+t))),n=new Uint8Array(r.length),Array.prototype.forEach.call(r,((e,t)=>{n[t]=e.charCodeAt(0)})),n).buffer}}class Q extends Error{constructor(e){super(e)}}class H extends Q{constructor(e,t){super(e),this.reply=t}}function J(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function X(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?J(Object(r),!0).forEach((function(t){h.default(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):J(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}class Y extends w{get inProgress(){return!!this.retrier}constructor(e){super(),h.default(this,"newBackoff",null),h.default(this,"usedBackoff",null),h.default(this,"retrier",null),this.options=e?X({},e):{}}start(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}stop(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}modifyBackoff(e){this.newBackoff=e}attemptFailed(){if(!this.inProgress)throw new Error("No attempt is in progress");var e,t;this.newBackoff?!this.usedBackoff||this.usedBackoff<this.newBackoff?this.createRetrier():null===(e=this.retrier)||void 0===e||e.failed(new Error):null===(t=this.retrier)||void 0===t||t.failed(new Error)}cancel(){var e;null===(e=this.retrier)||void 0===e||e.cancel()}cleanRetrier(){var e,t;null===(e=this.retrier)||void 0===e||e.removeAllListeners(),null===(t=this.retrier)||void 0===t||t.cancel(),this.retrier=null}getRetryPolicy(){var e=X({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}createRetrier(){this.cleanRetrier();var e=this.getRetryPolicy();this.retrier=new u.Retrier(e),this.retrier.once("attempt",(()=>{var e,t;null===(e=this.retrier)||void 0===e||e.on("attempt",(()=>this.emit("attempt"))),null===(t=this.retrier)||void 0===t||t.failed(new Error("Skipping first attempt"))})),this.retrier.on("failed",(e=>this.emit("failed",e))),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start()}}class Z extends w{constructor(e,t,r){super(),h.default(this,"terminalStates",["disconnected","rejected"]),h.default(this,"lastEmittedState",void 0),h.default(this,"tokenExpiredSasCode",20104),h.default(this,"terminationReason","Connection is not initialized"),this.websocket=e,this.websocket.on("connected",(()=>this.fsm.socketConnected())),this.websocket.on("disconnected",(e=>this.fsm.socketClosed())),this.websocket.on("message",(e=>this.onIncomingMessage(e))),this.websocket.on("socketError",(e=>this.emit("connectionError",{terminal:!1,message:"Socket error: ".concat(e.message),httpStatusCode:null,errorCode:null}))),this.transport=t,this.config=r,this.retrier=new Y(r.retryPolicy),this.retrier.on("attempt",(()=>this.retry())),this.retrier.on("failed",(e=>{j.warn("Retrying failed: ".concat(e.message)),this.disconnect()})),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",(()=>{j.debug("Browser reported connectivity state: online"),this.resetBackoff(),this.fsm.systemOnline()})),window.addEventListener("offline",(()=>{j.debug("Browser reported connectivity state: offline"),this.websocket.close(),this.fsm.socketClosed()})));var n=g.factory({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:()=>{this.setupSocket(),this.emit("connecting")},onEnterInitialising:()=>{this.sendInit()},onLeaveInitialising:()=>{this.cancelInit()},onEnterUpdating:()=>{this.sendUpdate()},onLeaveUpdating:()=>{this.cancelUpdate()},onEnterRetrying:()=>{this.initRetry(),this.emit("connecting")},onEnterConnected:()=>{this.resetBackoff(),this.onConnected()},onUserUpdateToken:()=>{this.resetBackoff()},onTokenRejected:()=>{this.resetBackoff(),this.closeSocket(!0),this.finalizeSocket()},onUserDisconnect:()=>{this.closeSocket(!0)},onEnterDisconnecting:()=>{this.startDisconnectTimer()},onLeaveDisconnecting:()=>{this.cancelDisconnectTimer()},onEnterWaitSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitSocketClosed:()=>{this.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:()=>{this.cancelDisconnectTimer()},onDisconnected:()=>{this.resetBackoff(),this.finalizeSocket()},onReceiveClose:(e,t)=>{this.onCloseReceived(t)},onReceiveOffload:(e,t)=>{j.debug("onreceiveoffload: ",t),this.modifyBackoff(t.body),this.onCloseReceived(t.status)},onUnsupported:()=>{this.closeSocket(!0),this.finalizeSocket()},onError:(e,t)=>{this.closeSocket(t),this.finalizeSocket()},onEnterState:e=>{"none"!==e.from&&this.changeState(e)},onInvalidTransition:(e,t,r)=>{j.warn("FSM: unexpected transition",t,r)}}});this.fsm=new n}changeState(e){j.debug("FSM: ".concat(e.transition,": ").concat(e.from," --\x3e ").concat(e.to)),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}resetBackoff(){j.trace("resetBackoff"),this.retrier.stop()}modifyBackoff(e){j.trace("modifyBackoff",e);var t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}startDisconnectTimer(){j.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout((()=>{j.debug("disconnecting is timed out"),this.closeSocket(!0)}),3e3)}cancelDisconnectTimer(){j.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}get isConnected(){return"connected"===this.state&&this.websocket.isConnected}get state(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"denied";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}initRetry(){j.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}retry(){"connecting"!=this.fsm.state?(j.trace("retry"),this.websocket.close(),this.fsm.userRetry()):j.trace("can\t retry as already connecting")}onConnected(){this.emit("connected")}finalizeSocket(){j.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}setupSocket(){j.trace("setupSocket:",this.config.token),this.emit("beforeConnect"),this.websocket.connect()}onIncomingMessage(e){var t=V.parse(e),r=t.method,n=t.header,i=t.payload;if("reply"!==r&&this.confirmReceiving(n),"notification"===r)this.emit("message",n.message_type,i);else if("reply"===n.method)this.transport.processReply({id:n.id,status:n.status,header:n,body:i});else if("client_update"===n.method)"token_about_to_expire"===n.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===n.method)if(308===n.status.code)j.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:n.status.status,body:i});else if(406===n.status.code){var s="Server closed connection because can't parse protocol: ".concat(JSON.stringify(n.status));this.emitReplyConnectionError(s,n,!0),j.error(s),this.fsm.receiveFatalClose()}else 417===n.status.code?(j.error("Server closed connection because can't parse client reply: ".concat(JSON.stringify(n.status))),this.fsm.receiveFatalClose(n.status.status)):410===n.status.code?(j.warn("Server closed connection: ".concat(JSON.stringify(n.status))),this.fsm.receiveClose(n.status.status),this.emit("tokenExpired")):401===n.status.code?(j.error("Server closed connection: ".concat(JSON.stringify(n.status))),this.fsm.receiveClose(n.status.status)):(j.warn("unexpected message: ",n.status),this.fsm.receiveOffload({status:n.status.status,body:null}))}sendInit(){var e=this;return f.default(v.default.mark((function t(){var r,n;return v.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.trace("sendInit"),t.prev=1,e.emit("beforeSendInit"),t.next=5,e.transport.sendInit();case 5:r=t.sent,e.config.updateContinuationToken(r.continuationToken),e.config.confirmedCapabilities=r.confirmedCapabilities,e.fsm.initSuccess(r),e.emit("initialized",r),e.emit("tokenUpdated"),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(1),t.t0 instanceof H?(n=!1,j.warn("Init rejected by server: ".concat(JSON.stringify(t.t0.reply.status))),e.emit("sendInitFailed"),401===t.t0.reply.status.code||403===t.t0.reply.status.code?(n=!0,e.fsm.tokenRejected(t.t0.reply.status),t.t0.reply.status.errorCode===e.tokenExpiredSasCode&&e.emit("tokenExpired")):429===t.t0.reply.status.code?(e.modifyBackoff(t.t0.reply.body),e.fsm.initError(!0)):500===t.t0.reply.status.code?e.fsm.initError(!1):e.fsm.initError(!0),e.emitReplyConnectionError(t.t0.message,t.t0.reply,n)):(e.terminationReason=t.t0.message,e.emit("connectionError",{terminal:!0,message:"Unknown error during connection initialisation: ".concat(t.t0.message,"\n").concat(JSON.stringify(t.t0,null,2)),httpStatusCode:null,errorCode:null}),e.fsm.initError(!0)),e.emit("tokenUpdated",t.t0);case 17:case"end":return t.stop()}}),t,null,[[1,13]])})))()}sendUpdate(){var e=this;return f.default(v.default.mark((function t(){var r,n,i;return v.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.trace("sendUpdate"),r=new D(e.config.token),t.prev=2,t.next=5,e.transport.sendWithReply(r);case 5:n=t.sent,e.fsm.updateSuccess(n.body),e.emit("tokenUpdated"),t.next=14;break;case 10:t.prev=10,t.t0=t.catch(2),t.t0 instanceof H?(i=!1,j.warn("Token update rejected by server: ".concat(JSON.stringify(t.t0.reply.status))),401===t.t0.reply.status.code||403===t.t0.reply.status.code?(i=!0,e.fsm.tokenRejected(t.t0.reply.status),t.t0.reply.status.errorCode===e.tokenExpiredSasCode&&e.emit("tokenExpired")):429===t.t0.reply.status.code?(e.modifyBackoff(t.t0.reply.body),e.fsm.updateError(t.t0.reply.status)):e.fsm.updateError(t.t0.reply.status),e.emitReplyConnectionError(t.t0.message,t.t0.reply,i)):(e.emit("error",!1,t.t0.message,null,null),e.fsm.updateError(t.t0)),e.emit("tokenUpdated",t.t0);case 14:case"end":return t.stop()}}),t,null,[[2,10]])})))()}emitReplyConnectionError(e,t,r){var n=t.status&&t.status.description?t.status.description:e,i=t.status.code,s=t.status&&t.status.errorCode?t.status.errorCode:null;r&&(this.terminationReason=n),this.emit("connectionError",{terminal:r,message:"Connection error: ".concat(n),httpStatusCode:i,errorCode:s})}cancelInit(){j.trace("cancelInit")}cancelUpdate(){j.trace("cancelUpdate")}confirmReceiving(e){j.trace("confirmReceiving");try{this.transport.send(new q(e.id))}catch(e){j.debug("failed to confirm packet receiving",e)}}closeSocket(e){j.trace("closeSocket (graceful: ".concat(e,")")),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout((()=>this.fsm.socketClosed()),0)}connect(){j.trace("connect"),this.fsm.userConnect()}disconnect(){return j.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise((e=>{this.disconnectedPromiseResolve=e,this.fsm.userDisconnect()}))}updateToken(e){return j.trace("updateToken:",e),new Promise(((e,t)=>{this.once("tokenUpdated",(r=>{r?t(r):e()})),this.fsm.userUpdateToken()}))}get isTerminalState(){return-1!==this.terminalStates.indexOf(this.fsm.state)}get getTerminationReason(){return this.terminationReason}onCloseReceived(e){this.websocket.close()}}class ee{static getMetadata(e){var t,r,n;"undefined"!=typeof navigator&&y.parse(navigator.userAgent);var i=e&&e.clientMetadata?e.clientMetadata:{},s={env:y.name,envv:y.version,os:null===(t=y.os)||void 0===t?void 0:t.family,osv:null===(r=y.os)||void 0===r?void 0:r.version,osa:null===(n=y.os)||void 0===n?void 0:n.architecture,sdk:"js-default"},o={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter((e=>e in i||e in s)).forEach((e=>o[e]=e in i?i[e]:s[e])),o}}class te{constructor(e,t){this.config=t,this.activeRequests=new Map,this.channel=e,this.channel.on("reply",(e=>this.processReply(e))),this.channel.on("disconnected",(()=>{this.activeRequests.forEach((e=>{clearTimeout(e.timeout),e.reject(new Q("disconnected"))})),this.activeRequests.clear()}))}get isConnected(){return this.channel.isConnected}processReply(e){var t,r=this.activeRequests.get(e.id);r&&(clearTimeout(r.timeout),this.activeRequests.delete(e.id),(t=e.status.code)>=200&&t<300?r.resolve(e):(r.reject(new H("Transport failure: "+e.status.status,e)),j.trace("message rejected")))}storeRequest(e,t,r){var n={resolve:t,reject:r,timeout:setTimeout((()=>{j.trace("request",e,"is timed out"),r(new Q("Twilsock: request timeout: "+e))}),3e4)};this.activeRequests.set(e,n)}shutdown(){this.activeRequests.forEach((e=>{clearTimeout(e.timeout),e.reject(new Q("Twilsock: request cancelled by user"))})),this.activeRequests.clear()}sendInit(){var e=this;return f.default(v.default.mark((function t(){var r,n,i;return v.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.trace("sendInit"),r=ee.getMetadata(e.config),n=new N(e.config.token,e.config.continuationToken,r,e.config.initRegistrations,e.config.tweaks),t.next=5,e.sendWithReply(n);case 5:return i=t.sent,t.abrupt("return",new F(i.id,i.header.continuation_token,i.header.continuation_token_status,i.header.offline_storage,i.header.init_registrations,i.header.debug_info,new Set(i.header.capabilities)));case 7:case"end":return t.stop()}}),t)})))()}sendClose(){var e=new B;this.send(e)}sendWithReply(e,t){return new Promise(((r,n)=>{var i=this.send(e,t);this.storeRequest(i,r,n)}))}send(e,t){e.id=e.id||"TM".concat(c.v4());var r=V.createPacket(e,function(e){switch(typeof e){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(r),e.id}catch(t){throw j.debug("failed to send ",e,t),j.trace(t.stack),t}}}var re={};class ne extends w{constructor(e){super(),this.url=e,this.url=e,this.WebSocket=t.WebSocket||t.MozWebSocket||re}get isConnected(){return this.socket&&1===this.socket.readyState}connect(){var e;j.trace("connecting to socket");try{e=new this.WebSocket(this.url)}catch(e){return j.debug("Socket error: ".concat(this.url)),void this.emit("socketError",e)}e.binaryType="arraybuffer",e.onopen=()=>{j.debug("socket opened ".concat(this.url)),this.emit("connected")},e.onclose=e=>{j.debug("socket closed",e),this.emit("disconnected",e)},e.onerror=e=>{j.debug("Socket error:",e),this.emit("socketError",e)},e.onmessage=e=>{this.emit("message",e.data)},this.socket=e}send(e){this.socket.send(e)}close(){if(j.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}class ie extends w{constructor(e){super(),this.transport=e,this.registrations=new Map,this.registrationsInProgress=new Map}putNotificationContext(e,t){var r=this;return f.default(v.default.mark((function n(){var i;return v.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i={method:"put_notification_ctx",notification_ctx_id:e},n.next=3,r.transport.sendWithReply(i,t);case 3:case 4:case"end":return n.stop()}}),n)})))()}deleteNotificationContext(e){var t=this;return f.default(v.default.mark((function r(){var n;return v.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n={method:"delete_notification_ctx",notification_ctx_id:e},r.next=3,t.transport.sendWithReply(n);case 3:case 4:case"end":return r.stop()}}),r)})))()}updateRegistration(e,t){var r=this;return f.default(v.default.mark((function n(){var i,s;return v.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return j.debug("update registration for context",e),(i=r.registrationsInProgress.get(e))||(i=new Set,r.registrationsInProgress.set(e,i)),s=c.v4(),i.add(s),n.prev=5,n.next=8,r.putNotificationContext(e,t);case 8:j.debug("registration attempt succeeded for context",t),i.delete(s),0===i.size&&(r.registrationsInProgress.delete(e),r.emit("registered",e)),n.next=19;break;case 13:n.prev=13,n.t0=n.catch(5),j.warn("registration attempt failed for context",t),j.debug(n.t0),i.delete(s),0===i.size&&(r.registrationsInProgress.delete(e),r.emit("registrationFailed",e,n.t0));case 19:case"end":return n.stop()}}),n,null,[[5,13]])})))()}updateRegistrations(){var e=this;return f.default(v.default.mark((function t(){var r;return v.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return j.trace("refreshing ".concat(e.registrations.size," registrations")),r=[],e.registrations.forEach(((t,n)=>{r.push(e.updateRegistration(n,t))})),t.next=5,Promise.all(r);case 5:case"end":return t.stop()}}),t)})))()}setNotificationsContext(e,t){var r=this;return f.default(v.default.mark((function n(){return v.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e&&t){n.next=2;break}throw new Q("Invalid arguments provided");case 2:return r.registrations.set(e,t),n.next=5,r.updateRegistration(e,t);case 5:return n.abrupt("return",n.sent);case 6:case"end":return n.stop()}}),n)})))()}removeNotificationsContext(e){var t=this;return f.default(v.default.mark((function r(){return v.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.registrations.has(e)){r.next=2;break}return r.abrupt("return");case 2:return r.next=4,t.deleteNotificationContext(e);case 4:t.transport.isConnected&&t.registrations.delete(e);case 5:case"end":return r.stop()}}),r)})))()}}class se extends Q{constructor(e,t,r){super(t),this.status=e,this.description=t,this.body=r}}class oe extends Q{constructor(e){super(e)}}var ae,ce;function ue(e,t){var r=function(e){var t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){var r={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(r.search.length>0){var n=r.search.substring(1);r.params=n.split("&").map((e=>e.split("="))).reduce(((e,t)=>(e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e)),{})}return r}throw new Q("Incorrect URI: "+e)}(t),n={method:e,host:r.host,path:r.pathname};return r.params&&(n.params=r.params),n}class le{constructor(e,t,r){this.config=r,this.transport=e,this.pendingMessages=[],this.twilsock=t}saveMessage(e){return new Promise(((t,r)=>{var n={message:e,resolve:t,reject:r,alreadyRejected:!1,timeout:setTimeout((()=>{j.debug("request is timed out"),r(new Q("request '".concat(e.to.method,"' to '").concat(e.to.host,"' timed out"))),n.alreadyRejected=!0}),2e4)};this.pendingMessages.push(n)}))}sendPendingMessages(){for(var e=this,t=function(){var t=e.pendingMessages[0];if(!t.alreadyRejected)try{var r=t.message;e.actualSend(r).then((e=>t.resolve(e))).catch((e=>t.reject(e))),clearTimeout(t.timeout)}catch(e){return j.debug("Failed to send pending message",e),"break"}e.pendingMessages.splice(0,1)};this.pendingMessages.length>0;){if("break"===t())break}}rejectPendingMessages(){this.pendingMessages.forEach((e=>{e.reject(new oe("Unable to connect: "+this.twilsock.getTerminationReason)),e.alreadyRejected=!0,clearTimeout(e.timeout)})),this.pendingMessages.splice(0,this.pendingMessages.length)}actualSend(e){var t=this;return f.default(v.default.mark((function r(){var n,i,s,o,a,c,u,l;return v.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return i=e.to,s=e.headers,o=e.body,a=null!==(n=e.grant)&&void 0!==n?n:t.config.activeGrant,c={host:i.host,path:i.path,method:i.method,params:i.params,headers:s},u=new U(a,s["Content-Type"]||"application/json",c),j.trace("Sending upstream message",u),r.next=9,t.transport.sendWithReply(u,o);case 9:if(l=r.sent,j.trace("Received upstream message response",l),!((p=l)&&p.header&&p.header.http_status)||(d=l.header.http_status.code)>=200&&d<300){r.next=13;break}throw new se(l.header.http_status.code,l.header.http_status.status,l.body);case 13:return r.abrupt("return",{status:l.header.http_status,headers:l.header.http_headers,body:l.body});case 14:case"end":return r.stop()}var d,p}),r)})))()}send(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0;if(this.twilsock.isTerminalState)return Promise.reject(new oe("Unable to connect: "+this.twilsock.getTerminationReason));var s=function(e,t,r,n,i){return{to:ue(e,t),headers:r,body:n,grant:i}}(e,t,r,n,i);return this.twilsock.isConnected?this.actualSend(s):this.saveMessage(s)}}class de{constructor(){this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t}))}get promise(){return this._promise}update(e){this._resolve(e)}set(e){this._resolve(e)}fail(e){this._reject(e)}}class pe{constructor(e){this.id=e}static create(e){if(e instanceof Object&&"storage_id"in e)return new pe(e.storage_id);throw new Q('Field "storage_id" is missing')}}class fe{static get sessionStorage(){try{return t.sessionStorage}catch(e){return null}}static get window(){try{return t.window}catch(e){return null}}static storeToken(e,t){fe.canStore&&fe.sessionStorage.setItem(fe.getKeyName(t),e)}static getStoredToken(e){return fe.canStore?fe.sessionStorage.getItem(fe.getKeyName(e)):null}static initialize(){fe.canStore&&(fe.sessionStorage.getItem(fe.initializedFlag)&&this.clear(),fe.sessionStorage.setItem(fe.initializedFlag,"true"),fe.window.addEventListener("unload",(()=>{fe.sessionStorage.removeItem(fe.initializedFlag)})))}static clear(){if(fe.canStore){for(var e=[],t=0;t<fe.sessionStorage.length;t++){var r=fe.sessionStorage.key(t);0===r.indexOf(fe.tokenStoragePrefix)&&e.push(r)}e.forEach((e=>fe.sessionStorage.removeItem(e))),fe.sessionStorage.removeItem(fe.initializedFlag)}}static getKeyName(e){return"".concat(fe.tokenStoragePrefix).concat(e)}static get canStore(){return fe.sessionStorage&&fe.window}}h.default(fe,"initializedFlag","twilio_twilsock_token_storage"),h.default(fe,"tokenStoragePrefix","twilio_continuation_token_"),fe.initialize();class he{constructor(e,t,r,n,i,s){this.title=e,this.details=t,this.start=r,this.type=i,this.id=s,this.end=n}toTelemetryEvent(){var e=new Date,t=this.start,r=this.end?this.end:e;if(r<t){var n=r;r=t,t=n}var i=t.getTime()-e.getTime(),s=r.getTime()-e.getTime();return new W(i,s,this.title,this.details,this.id,this.type)}}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(ae||(ae={})),function(e){e[e.MinEventsPortion=0]="MinEventsPortion",e[e.AnyEvents=1]="AnyEvents",e[e.AnyEventsIncludingUnfinished=2]="AnyEventsIncludingUnfinished"}(ce||(ce={}));class ve{constructor(e,t){h.default(this,"minEventsPortionToSend",50),h.default(this,"maxEventsPortionToSend",100),h.default(this,"pendingEvents",new Map),h.default(this,"readyEvents",[]),h.default(this,"hasInitializationFinished",!1),h.default(this,"_canSendTelemetry",!1),this.config=e,this.packetInterface=t}get isTelemetryEnabled(){return this.config.confirmedCapabilities.has("telemetry.v1")}get canSendTelemetry(){return this._canSendTelemetry&&this.isTelemetryEnabled}set canSendTelemetry(e){j.debug("TelemetryTracker.canSendTelemetry: ".concat(e," TelemetryTracker.isTelemetryEnabled: ").concat(this.isTelemetryEnabled)),this._canSendTelemetry&&!e&&(this.pendingEvents.clear(),this.readyEvents=[]),this._canSendTelemetry=e,e&&this.sendTelemetry(ce.AnyEvents),e&&!this.hasInitializationFinished&&(this.hasInitializationFinished=!0)}addTelemetryEvent(e){!this.canSendTelemetry&&this.hasInitializationFinished||this.readyEvents.push(e)}addPartialEvent(e,t,r){j.debug("Adding ".concat(r===ae.Start?"starting":"ending"," timepoint for '").concat(t,"' event"));var n=this.pendingEvents.has(t);if(r===ae.Start)n&&j.debug("Overwriting starting point for '".concat(t,"' event")),this.pendingEvents.set(t,e);else{if(!n)return void j.info("Could not find started event for '".concat(t,"' event"));this.addTelemetryEvent(this.merge(this.pendingEvents.get(t),e)),this.pendingEvents.delete(t)}}getTelemetryToSend(e){return this.canSendTelemetry&&0!=this.readyEvents.length?e==ce.MinEventsPortion&&this.readyEvents.length<this.minEventsPortionToSend?[]:this.getTelemetryPortion(e==ce.AnyEventsIncludingUnfinished):[]}getTelemetryPortion(e){var t=Math.min(this.readyEvents.length,this.maxEventsPortionToSend),r=this.readyEvents.splice(0,t);return e&&r.length<this.maxEventsPortionToSend&&this.pendingEvents.forEach(((e,t)=>{if(!(r.length>=this.maxEventsPortionToSend)){var n=this.pendingEvents.get(t);this.pendingEvents.delete(t),r.push(new he("[UNFINISHED] ".concat(n.title),n.details,n.start,null,n.type,n.id))}})),r}merge(e,t){return new he(t.title?t.title:e.title,t.details?t.details:e.details,e.start,t.end,t.type?t.type:e.type,t.id?t.id:e.id)}sendTelemetryIfMinimalPortionCollected(){this.sendTelemetry(ce.MinEventsPortion)}sendTelemetry(e){var t=this.getTelemetryToSend(e);if(0!==t.length)try{this.packetInterface.send(new z(t.map((e=>e.toTelemetryEvent()))))}catch(e){j.debug("Error while sending ".concat(t.length," telemetry events due to ").concat(e,"; they will be resubmitted")),this.readyEvents=this.readyEvents.concat(t)}}}class me{}h.default(me,"TWILSOCK_CONNECT","twilsock.sdk.connect"),h.default(me,"TWILSOCK_INIT","twilsock.sdk.init"),e.TwilsockClient=class extends w{constructor(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};super(),h.default(this,"version","0.11.2"),h.default(this,"offlineStorageDeferred",new de),r.continuationToken=r.continuationToken?r.continuationToken:fe.getStoredToken(t);var n=this.config=new M(e,t,r);j.setLevel(n.logLevel);var i=new ne(n.url),s=r.transport?r.transport:new te(i,n);this.channel=r.channel?r.channel:new Z(i,s,n),this.registrations=r.registrations?r.registrations:new ie(s),this.upstream=new le(s,this.channel,n),this.telemetryTracker=new ve(n,s),this.channel.on("initialized",(()=>this.telemetryTracker.canSendTelemetry=!0)),i.on("disconnected",(()=>this.telemetryTracker.canSendTelemetry=!1)),this.registrations.on("registered",(e=>this.emit("registered",e))),this.channel.on("message",((e,t)=>setTimeout((()=>this.emit("message",e,t)),0))),this.channel.on("stateChanged",(e=>setTimeout((()=>this.emit("stateChanged",e)),0))),this.channel.on("connectionError",(e=>setTimeout((()=>this.emit("connectionError",e)),0))),this.channel.on("tokenAboutToExpire",(()=>setTimeout((()=>this.emit("tokenAboutToExpire")),0))),this.channel.on("tokenExpired",(()=>setTimeout((()=>this.emit("tokenExpired")),0))),this.channel.on("connected",(()=>this.registrations.updateRegistrations())),this.channel.on("connected",(()=>this.upstream.sendPendingMessages())),this.channel.on("connected",(()=>setTimeout((()=>this.emit("connected")),0))),this.channel.on("beforeConnect",(()=>this.telemetryTracker.addPartialEvent(new he("Establish WebSocket connection","",new Date),me.TWILSOCK_CONNECT,ae.Start))),this.channel.on("connected",(()=>this.telemetryTracker.addPartialEvent(new he("Establish WebSocket connection","",new Date,new Date),me.TWILSOCK_CONNECT,ae.End))),this.channel.on("beforeSendInit",(()=>this.telemetryTracker.addPartialEvent(new he("Send Twilsock init","",new Date),me.TWILSOCK_INIT,ae.Start))),this.channel.on("initialized",(()=>this.telemetryTracker.addPartialEvent(new he("Send Twilsock init","Succeeded",new Date,new Date),me.TWILSOCK_INIT,ae.End))),this.channel.on("sendInitFailed",(()=>this.telemetryTracker.addPartialEvent(new he("Send Twilsock init","Failed",new Date,new Date),me.TWILSOCK_INIT,ae.End))),this.channel.on("initialized",(e=>{this.handleStorageId(t,e),fe.storeToken(e.continuationToken,t),setTimeout((()=>this.emit("initialized",e)),0)})),this.channel.on("disconnected",(()=>setTimeout((()=>this.emit("disconnected")),0))),this.channel.on("disconnected",(()=>this.upstream.rejectPendingMessages())),this.channel.on("disconnected",(()=>this.offlineStorageDeferred.fail(new Q("Client disconnected")))),this.offlineStorageDeferred.promise.catch((()=>{}))}emit(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return j.debug("Emitting ".concat(e.toString(),"(").concat(r.map((e=>JSON.stringify(e))).join(", "),")")),super.emit(e,...r)}handleStorageId(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(pe.create(t.offlineStorage[e])),j.debug("Offline storage for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage[e]),"."))}catch(r){this.offlineStorageDeferred.fail(new Q("Failed to parse offline storage for ".concat(e," ").concat(JSON.stringify(t.offlineStorage[e]),". ").concat(r,".")))}else this.offlineStorageDeferred.fail(new Q("No offline storage id for '".concat(e,"' product: ").concat(JSON.stringify(t.offlineStorage))));else this.offlineStorageDeferred.fail(new Q("No offline storage id"))}storageId(){return this.offlineStorageDeferred.promise}get isConnected(){return this.channel.isConnected}get state(){return this.channel.state}updateToken(e){var t=this;return f.default(v.default.mark((function r(){return v.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(j.trace("updating token '".concat(e,"'")),t.config.token!==e){r.next=3;break}return r.abrupt("return");case 3:return t.config.updateToken(e),r.next=6,t.channel.updateToken(e);case 6:return r.abrupt("return",r.sent);case 7:case"end":return r.stop()}}),r)})))()}setNotificationsContext(e,t){var r=this;return f.default(v.default.mark((function n(){return v.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.registrations.setNotificationsContext(e,t);case 2:case"end":return n.stop()}}),n)})))()}removeNotificationsContext(e){var t=this;return f.default(v.default.mark((function r(){return v.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.registrations.removeNotificationsContext(e);case 2:case"end":return r.stop()}}),r)})))()}connect(){return this.channel.connect()}disconnect(){var e=this;return f.default(v.default.mark((function t(){return v.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.telemetryTracker.sendTelemetry(ce.AnyEventsIncludingUnfinished),t.next=3,e.channel.disconnect();case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))()}get(e,t,r){var n=this;return f.default(v.default.mark((function i(){return v.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.telemetryTracker.sendTelemetry(ce.AnyEvents),i.next=3,n.upstream.send("GET",e,t,void 0,r);case 3:return i.abrupt("return",i.sent);case 4:case"end":return i.stop()}}),i)})))()}post(e,t,r,n){var i=this;return f.default(v.default.mark((function s(){return v.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i.telemetryTracker.sendTelemetry(ce.AnyEvents),s.next=3,i.upstream.send("POST",e,t,r,n);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}}),s)})))()}put(e,t,r,n){var i=this;return f.default(v.default.mark((function s(){return v.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i.telemetryTracker.sendTelemetry(ce.AnyEvents),s.next=3,i.upstream.send("PUT",e,t,r,n);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}}),s)})))()}delete(e,t,r,n){var i=this;return f.default(v.default.mark((function s(){return v.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return i.telemetryTracker.sendTelemetry(ce.AnyEvents),s.next=3,i.upstream.send("DELETE",e,t,r,n);case 3:return s.abrupt("return",s.sent);case 4:case"end":return s.stop()}}),s)})))()}addTelemetryEvent(e){this.telemetryTracker.addTelemetryEvent(e),this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}addPartialTelemetryEvent(e,t,r){this.telemetryTracker.addPartialEvent(e,t,r),r===ae.End&&this.telemetryTracker.sendTelemetryIfMinimalPortionCollected()}},e.TwilsockClient=
/*! *****************************************************************************
	  Copyright (c) Microsoft Corporation.
	  
	  Permission to use, copy, modify, and/or distribute this software for any
	  purpose with or without fee is hereby granted.
	  
	  THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	  REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	  AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	  INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	  LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	  OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	  PERFORMANCE OF THIS SOFTWARE.
	  ***************************************************************************** */
function(e,t,r,n){var i,s=arguments.length,o=s<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,r):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,r,n);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,r,o):i(t,r))||o);return s>3&&o&&Object.defineProperty(t,r,o),o}([s.validateConstructorTypes(s.nonEmptyString,s.nonEmptyString,[s.pureObject,"undefined",s.literal(null)]),function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}("design:paramtypes",[String,String,Object])],e.TwilsockClient);e.InitRegistration=class{constructor(e){this.product=e,this.type="ers",this.notification_protocol_version=0,this.message_types=[]}populateInitRegistrations(e){var t=new Set(this.message_types);for(var r in e)t.add(e[r]);this.message_types=Array.from(t)}},e.TransportUnavailableError=oe,e.Twilsock=e.TwilsockClient,e.TwilsockError=Q}(Nf);class Mw{constructor(e){this.base=e,this.args=new Array,this.paths=new Array}pathSegment(e){return this.paths.push(encodeURIComponent(e)),this}queryParam(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}build(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}class Pw extends Error{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(),this.name=this.constructor.name,this.message="".concat(e," (status: ").concat(t,", code: ").concat(r,")"),this.status=t,this.code=r}}class Nw extends Pw{constructor(e){var t=arguments.length>3?arguments[3]:void 0;super(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,arguments.length>2&&void 0!==arguments[2]?arguments[2]:0),this.body=t}}function Fw(e){return JSON.parse(JSON.stringify(e))}function Dw(e){if(!(void 0===e||Uw(e)))throw new Pw("Invalid pageSize parameter. Expected a positive integer, was '".concat(e,"'."),400,20007)}function Uw(e){return function(e){return!isNaN(parseInt(e))&&isFinite(e)}(e)&&e>0}var qw=Xf.exports.getLogger("twilio-sync");function Bw(e,t){return["".concat((new Date).toISOString()," Sync ").concat(e,":")].concat(Array.from(t))}var Ww=function(e){qw.setLevel(e)},zw=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qw.trace.apply(null,Bw("T",t))},Kw=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qw.debug.apply(null,Bw("D",t))},Gw=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qw.warn.apply(null,Bw("W",t))},$w=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];qw.error.apply(null,Bw("E",t))};function Vw(e,t,r){return e&&void 0!==e[t]?e[t]:r}class Qw{constructor(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.region||"us1",r="https://cds.".concat(t,".twilio.com"),n=e.cdsUri||r;this.settings={subscriptionsUri:n+"/v4/Subscriptions",documentsUri:n+"/v3/Documents",listsUri:n+"/v3/Lists",mapsUri:n+"/v3/Maps",streamsUri:n+"/v3/Streams",insightsUri:n+"/v3/Insights",sessionStorageEnabled:Vw(e.Sync,"enableSessionStorage",!0),productId:e.productId}}get subscriptionsUri(){return this.settings.subscriptionsUri}get documentsUri(){return this.settings.documentsUri}get listsUri(){return this.settings.listsUri}get mapsUri(){return this.settings.mapsUri}get streamsUri(){return this.settings.streamsUri}get insightsUri(){return this.settings.insightsUri}get backoffConfig(){return this.settings.backoffConfig||{}}get sessionStorageEnabled(){return this.settings.sessionStorageEnabled}get productId(){return this.settings.productId}}function Hw(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function Jw(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,s=[],o=!0,a=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(s.push(n.value),!t||s.length!==t);o=!0);}catch(e){a=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(a)throw i}}return s}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Hw(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Hw(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Xw=O,Yw=u,Zw=rc,ex=Sr,tx=at,rx=g,nx=h,ix=Object.assign,sx=Object.defineProperty,ox=!ix||Yw((function(){if(Xw&&1!==ix({b:1},ix(sx({},"a",{enumerable:!0,get:function(){sx(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var e={},t={},r=Symbol(),n="abcdefghijklmnopqrst";return e[r]=7,n.split("").forEach((function(e){t[e]=e})),7!=ix({},e)[r]||Zw(ix({},t)).join("")!=n}))?function(e,t){for(var r=rx(e),n=arguments.length,i=1,s=ex.f,o=tx.f;n>i;)for(var a,c=nx(arguments[i++]),u=s?Zw(c).concat(s(c)):Zw(c),l=u.length,d=0;l>d;)a=u[d++],Xw&&!o.call(c,a)||(r[a]=c[a]);return r}:ix;function ax(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return cx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return cx(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function cx(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}Hr({target:"Object",stat:!0,forced:Object.assign!==ox},{assign:ox});class ux{constructor(e){this.localObject=e,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}get sid(){return this.localObject.sid}get type(){return this.localObject.type}get lastEventId(){return this.localObject.lastEventId}get indexName(){return this.localObject.indexName}get queryString(){return this.localObject.queryString}get isEstablished(){return this.established}update(e,t){this.localObject._update(e,t)}updatePending(e,t){this.pendingAction=e,this.pendingCorrelationId=t}reset(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}markAsFailed(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new Pw("Failed to subscribe on service events: ".concat(e.error.message),e.error.status,e.error.code))}complete(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}setSubscriptionState(e){this.localObject._setSubscriptionState(e)}}class lx{constructor(e){st(this,"isConnected",!1),st(this,"maxBatchSize",100),st(this,"subscriptionTtlTimer",null),st(this,"pendingPokeReason",null),this.services=e,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map;this.backoff=fw.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",(()=>{var e=this.getSubscriptionUpdateBatch(),t=e.action,r=e.subscriptions;t?this.applyNewSubscriptionUpdateBatch(t,r):(this.backoff.reset(),Kw("All subscriptions resolved."))}))}getSubscriptionUpdateBatch(){function e(e,t,r,n){var i,s=[],o=ax(e);try{for(o.s();!(i=o.n()).done;){var a=Jw(i.value,2),c=a[0],u=a[1];if(!t.get(c)&&r!==u.pendingAction&&!u.rejectedWithError&&(s.push(u),n&&s.length>=n))break}}catch(e){o.e(e)}finally{o.f()}return s}var t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};var r=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return r.length>0?{action:"cancel",subscriptions:r}:{action:null,subscriptions:null}}persist(){this.backoff.backoff()}applyNewSubscriptionUpdateBatch(e,t){var r=this;return it(Mo.mark((function n(){var i,s,o,a,c,u,l,d,p,f,h,v,m,g;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r.isConnected){n.next=4;break}return Kw("Twilsock connection (required for subscription) not ready; waiting…"),r.backoff.reset(),n.abrupt("return");case 4:t=r.processLocalActions(e,t),i=(new Date).getTime(),s=ax(t);try{for(s.s();!(o=s.n()).done;)a=o.value,r.recordActionAttemptOn(a,e,i)}catch(e){s.e(e)}finally{s.f()}return c=r.pendingPokeReason,r.pendingPokeReason=null,n.prev=10,n.next=13,r.request(e,i,c,t);case 13:u=n.sent,l=u.body.max_batch_size,!isNaN(parseInt(l))&&isFinite(l)&&l>0&&(r.maxBatchSize=l),r.subscriptionTtlTimer||(d=u.body.ttl_in_s,p=!isNaN(parseFloat(d))&&isFinite(d),p&&d>0&&(r.subscriptionTtlTimer=setTimeout((()=>r.onSubscriptionTtlElapsed()),1e3*d))),"establish"===e&&(f=u.body.estimated_delivery_in_ms,h=!isNaN(parseFloat(f))&&isFinite(f),h&&f>0?setTimeout((()=>r.verifyPokeDelivery(i,f,t)),f):$w("Invalid timeout: ".concat(f)),t.filter((e=>e.pendingCorrelationId===i)).forEach((e=>e.setSubscriptionState("response_in_flight")))),r.backoff.reset(),n.next=26;break;case 21:n.prev=21,n.t0=n.catch(10),v=ax(t);try{for(v.s();!(m=v.n()).done;)g=m.value,r.recordActionFailureOn(g,e)}catch(e){v.e(e)}finally{v.f()}n.t0 instanceof Nf.TransportUnavailableError?(Kw("Twilsock connection (required for subscription) not ready (c:".concat(i,"); waiting…")),r.backoff.reset()):(Kw("Failed an attempt to ".concat(e," subscriptions (c:").concat(i,"); retrying"),n.t0),r.persist());case 26:case"end":return n.stop()}}),n,null,[[10,21]])})))()}verifyPokeDelivery(e,t,r){var n=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),i=n?(new Date).getTime()-n:t;i>=t?(r.filter((t=>t.pendingCorrelationId===e)).forEach((e=>{e.updatePending(null,null),e.retryCount++,this.persisted.delete(e.sid)})),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout((()=>this.verifyPokeDelivery(e,t,r)),t-i)}processLocalActions(e,t){return"cancel"===e?t.filter((e=>!e.rejectedWithError)):t}recordActionAttemptOn(e,t,r){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,r);else{var n=this.persisted.get(e.sid);n&&n.updatePending(t,r)}}recordActionFailureOn(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}request(e,t,r,n){var i=n.map((t=>({object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0}))),s=n.filter((e=>e.retryCount>0)).length;Kw("Attempting '".concat(e,"' request (c:").concat(t,"):"),i);var o={event_protocol_version:3,action:e,correlation_id:t,retried_requests:s,ttl_in_s:-1,requests:i};return"ttl"===r&&(o.reason=r),this.services.network.post(this.services.config.subscriptionsUri,o)}add(e,t){Kw("Establishing intent to subscribe to ".concat(e));var r=this.subscriptions.get(e);r&&t&&r.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new ux(t)),this.persist())}remove(e){Kw("Establishing intent to unsubscribe from ".concat(e)),this.subscriptions.delete(e)&&this.persist()}acceptMessage(e,t){var r;switch(zw("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(r=e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:var n;switch(r[0]){case"map_":n=e.event.map_sid;break;case"list_":n=e.event.list_sid;break;case"document_":n=e.event.document_sid;break;case"stream_":n=e.event.stream_sid;break;case"live_query_":n=e.event.query_id,t=!1,!0===e.strictly_ordered&&(t=!0);break;default:n=void 0}this.applyEventToSubscribedEntity(n,e,t);break;default:Kw("Dropping unknown message type ".concat(e.event_type))}}applySubscriptionEstablishedMessage(e,t){var r=e.object_sid,n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?"interrupted"===e.replay_status?(Kw("Event Replay for subscription to ".concat(r," (c:").concat(t,") interrupted; continuing eagerly.")),n.updatePending(null,null),this.persisted.delete(n.sid),this.backoff.reset()):"completed"===e.replay_status&&(Kw("Event Replay for subscription to ".concat(r," (c:").concat(t,") completed. Subscription is ready.")),n.complete(e.last_event_id),this.persisted.set(e.object_sid,n),n.setSubscriptionState("established"),this.backoff.reset()):Kw("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}applySubscriptionCancelledMessage(e,t){var r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?(r.updatePending(null,null),r.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):Kw("Late message for ".concat(e.object_sid," (c:").concat(t,") dropped.")),this.persist()}applySubscriptionFailedMessage(e,t){var r=e.object_sid,n=this.subscriptions.get(r),i=this.persisted.get(r);n&&i?i.pendingCorrelationId===t&&($w("Failed to subscribe on ".concat(i.sid),e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!n&&i&&(this.persisted.delete(r),i.setSubscriptionState("none")),this.persist()}applyEventToSubscribedEntity(e,t,r){if(e){r=r||(()=>{var t=this.persisted.get(e);return t&&t.isEstablished})();var n=this.subscriptions.get(e);n?(t.event.type=t.event_type,n.update(t.event,r)):Kw("Message dropped for SID '".concat(e,"', for which there is no subscription."))}}onConnectionStateChanged(e){this.isConnected=e,e&&this.poke("reconnect")}onSubscriptionTtlElapsed(){this.isConnected&&this.poke("ttl")}poke(e){Kw("Triggering event replay for all subscriptions, reason=".concat(e)),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);var t,r=[],n=ax(this.persisted.values());try{for(n.s();!(t=n.n()).done;){var i=t.value;i.reset(),i.rejectedWithError&&r.push(i)}}catch(e){n.e(e)}finally{n.f()}this.persisted.clear();for(var s=0,o=r;s<o.length;s++){var a=o[s];this.persisted.set(a.sid,a)}this.persist()}shutdown(){this.backoff.reset(),this.subscriptions.clear()}}function dx(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function px(e){return e.body?e.body.code:0}function fx(e){return 409===e.status?new Nw(dx(e),e.status,px(e),e.body):e.status?new Pw(dx(e),e.status,px(e)):e instanceof Nf.TransportUnavailableError?e:new Pw(e.message,0,0)}class hx{constructor(e,t,r){this.clientInfo=e,this.config=t,this.transport=r}createHeaders(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+rv.v4().replace(/-/g,"")}}backoffConfig(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}executeWithRetry(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Promise(((r,n)=>{var i=[502,503,504];t&&i.push(429);var s=new hw(this.backoffConfig());s.on("attempt",(()=>{e().then((e=>s.succeeded(e))).catch((e=>{if(i.includes(e.status)){var t=parseInt(e.headers?e.headers["Retry-After"]:null);s.failed(fx(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?s.failed(fx(e)):(s.removeAllListeners(),s.cancel(),n(fx(e)))}))})),s.on("succeeded",(e=>{r(e)})),s.on("cancelled",(e=>n(fx(e)))),s.on("failed",(e=>n(fx(e)))),s.start()}))}get(e){var t=this.createHeaders();return Kw("GET",e,"ID:",t["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.get(e,t,this.config.productId)),!0)}post(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=this.createHeaders();return null!=r&&(i["If-Match"]=r),Kw("POST",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.post(e,i,t,this.config.productId)),n)}put(e,t,r){var n=this.createHeaders();return null!=r&&(n["If-Match"]=r),Kw("PUT",e,"ID:",n["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.put(e,n,t,this.config.productId)),!1)}delete(e){var t=this.createHeaders();return Kw("DELETE",e,"ID:",t["Twilio-Request-Id"]),this.executeWithRetry((()=>this.transport.delete(e,t,this.config.productId)),!1)}}class vx{constructor(e,t){this.config=e,this.storageId=null;try{this.storage=t||sessionStorage}catch(e){}}storageKey(e,t){return"".concat(this.storageId,"::").concat(e,"::").concat(t)}get isReady(){return this.config.sessionStorageEnabled&&!!this.storageId}updateStorageId(e){this.storageId=e}store(e,t,r){return this.isReady?this._store(this.storageKey(e,t),r):null}read(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}remove(e,t,r){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),r&&this.storage.removeItem(this.storageKey(e,r))}catch(e){}}update(e,t,r,n){if(!this.isReady)return null;this._apply(this.storageKey(e,t),n),r&&this._apply(this.storageKey(e,r),n)}_store(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(e){}}_read(e){try{var t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(e){}return null}_apply(e,t){var r=this._read(e);if(!r)return!1;this._store(e,Object.assign(r,t))}}function mx(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return gx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return gx(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function gx(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class yx{constructor(e,t){this.services=e,this.removalHandler=t,this.subscriptionState="none",this._attachedListeners=new Map}_advanceLastEventId(e,t){}reportFailure(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}_subscribe(){this.services.router._subscribe(this.sid,this)}_unsubscribe(){this.services.router._unsubscribe(this.sid)}_setSubscriptionState(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}close(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}attach(e){var t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}detach(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}broadcastEventToListeners(e,t){var r,n=mx(this._attachedListeners.values());try{for(n.s();!(r=n.n()).done;){r.value.emit(e,t)}}catch(e){n.e(e)}finally{n.f()}}}class bx{constructor(e){st(this,"queuedRequests",[]),st(this,"isRequestInFlight",!1),this.inputMergingFunction=e}add(e,t){var r=new Promise(((r,n)=>this.queuedRequests.push({input:e,requestFunction:t,resolve:r,reject:n})));return this.wakeupQueue(),r}squashAndAdd(e,t){var r,n=this.queuedRequests;this.queuedRequests=[],n.length>0?(r=n.map((e=>e.input)).reduce(this.inputMergingFunction),r=this.inputMergingFunction(r,e)):r=e;var i=this.add(r,t);return n.forEach((e=>i.then(e.resolve,e.reject))),i}isEmpty(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}wakeupQueue(){if(0!==this.queuedRequests.length&&!this.isRequestInFlight){var e=this.queuedRequests.shift();this.isRequestInFlight=!0,e.requestFunction(e.input).then(e.resolve,e.reject).then((e=>{this.isRequestInFlight=!1,this.wakeupQueue()}))}}}class wx{constructor(e){st(this,"queueByNamespaceKey",new Map),this.inputReducer=e}add(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",n.invokeQueueMethod(e,(e=>e.add(t,r))));case 1:case"end":return i.stop()}}),i)})))()}squashAndAdd(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",n.invokeQueueMethod(e,(e=>e.squashAndAdd(t,r))));case 1:case"end":return i.stop()}}),i)})))()}invokeQueueMethod(e,t){var r=this;return it(Mo.mark((function n(){var i,s;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.queueByNamespaceKey.has(e)||r.queueByNamespaceKey.set(e,new bx(r.inputReducer)),i=r.queueByNamespaceKey.get(e),s=t(i),r.queueByNamespaceKey.get(e).isEmpty()&&r.queueByNamespaceKey.delete(e),n.abrupt("return",s);case 5:case"end":return n.stop()}}),n)})))()}}class xx extends Uo{constructor(){super(),this.closed=!1,this.uuid=rv.v4()}get listenerUuid(){return this.uuid}close(){this.removeAllListeners(),this.closed=!0}ensureNotClosed(){if(this.closed)throw new Error("Invalid operation on closed object")}}class _x extends yx{constructor(e,t,r){super(e,r),st(this,"isDeleted",!1);this.updateMergingQueue=new bx(((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e)),this.descriptor=t,this.descriptor.data=this.descriptor.data||{},this.descriptor.date_updated=new Date(this.descriptor.date_updated)}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}static get type(){return"document"}get type(){return"document"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get data(){return this.descriptor.data}get dateUpdated(){return this.descriptor.date_updated}get uniqueName(){return this.descriptor.unique_name||null}_update(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":if(e.id<=this.lastEventId){zw("Document update skipped, current:",this.lastEventId,", remote:",e.id);break}var t=void 0!==this.descriptor.data?Fw(this.descriptor.data):null;this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{data:e.document_data,isLocal:!1,previousData:t}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data});break;case"document_removed":this.onRemoved(!1)}}set(e,t){var r=this;return it(Mo.mark((function n(){var i;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=t||{},n.abrupt("return",r.updateMergingQueue.squashAndAdd(i,(t=>r._setUnconditionally(e,t.ttl))));case 2:case"end":return n.stop()}}),n)})))()}mutate(e,t){var r=this;return it(Mo.mark((function n(){var i;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=t||{},n.abrupt("return",r.updateMergingQueue.add(i,(t=>r._setWithIfMatch(e,t.ttl))));case 2:case"end":return n.stop()}}),n)})))()}update(e,t){var r=this;return it(Mo.mark((function n(){return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",r.mutate((t=>Object.assign(t,e)),t));case 1:case"end":return n.stop()}}),n)})))()}setTtl(e){var t=this;return it(Mo.mark((function r(){var n;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t._postUpdateToServer({ttl:e});case 2:n=r.sent,t.descriptor.date_expires=n.date_expires;case 4:case"end":return r.stop()}}),r)})))()}_setUnconditionally(e,t){var r=this;return it(Mo.mark((function n(){var i;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r._postUpdateToServer({data:e,revision:void 0,ttl:t});case 2:return i=n.sent,r._handleSuccessfulUpdateResult(i),n.abrupt("return",r.descriptor.data);case 5:case"end":return n.stop()}}),n)})))()}_setWithIfMatch(e,t){var r=this;return it(Mo.mark((function n(){var i,s,o;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!(i=e(Fw(r.descriptor.data)))){n.next=22;break}return s=r.revision,n.prev=3,n.next=6,r._postUpdateToServer({data:i,revision:s,ttl:t});case 6:return o=n.sent,r._handleSuccessfulUpdateResult(o),n.abrupt("return",r.descriptor.data);case 11:if(n.prev=11,n.t0=n.catch(3),412!==n.t0.status){n.next=19;break}return n.next=16,r._softSync();case 16:return n.abrupt("return",r._setWithIfMatch(e));case 19:throw n.t0;case 20:n.next=23;break;case 22:return n.abrupt("return",r.descriptor.data);case 23:case"end":return n.stop()}}),n,null,[[3,11]])})))()}_handleSuccessfulUpdateResult(e){if(!(e.last_event_id<=this.descriptor.last_event_id)){var t=void 0!==this.descriptor.data?Fw(this.descriptor.data):null;this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{data:this.descriptor.data,isLocal:!0,previousData:t})}}_postUpdateToServer(e){var t=this;return it(Mo.mark((function r(){var n,i,s;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.isDeleted){r.next=17;break}return n={data:e.data},void 0!==e.ttl&&(n.ttl=e.ttl),i=e.revision,r.prev=4,r.next=7,t.services.network.post(t.uri,n,i);case 7:return s=r.sent,r.abrupt("return",{revision:s.body.revision,data:e.data,last_event_id:s.body.last_event_id,date_updated:s.body.date_updated,date_expires:s.body.date_expires});case 11:throw r.prev=11,r.t0=r.catch(4),404===r.t0.status&&t.onRemoved(!1),r.t0;case 15:r.next=18;break;case 17:return r.abrupt("return",Promise.reject(new Pw("The Document has been removed",404,54100)));case 18:case"end":return r.stop()}}),r,null,[[4,11]])})))()}_softSync(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.services.network.get(e.uri).then((t=>{var r={type:"document_updated",id:t.body.last_event_id,document_revision:t.body.revision,document_data:t.body.data,date_created:t.body.date_updated};return e._update(r),e})).catch((t=>{404===t.status?e.onRemoved(!1):$w("Can't get updates for ".concat(e.sid,":"),t)})));case 1:case"end":return t.stop()}}),t)})))()}onRemoved(e){if(!this.isDeleted){var t=void 0!==this.descriptor.data?Fw(this.descriptor.data):null;this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e,previousData:t})}}removeDocument(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.isDeleted){t.next=6;break}return t.next=3,e.services.network.delete(e.uri);case 3:e.onRemoved(!0),t.next=7;break;case 6:return t.abrupt("return",Promise.reject(new Pw("The Document has been removed",404,54100)));case 7:case"end":return t.stop()}}),t)})))()}}class kx extends xx{get uri(){return this.syncDocumentImpl.uri}get revision(){return this.syncDocumentImpl.revision}get lastEventId(){return this.syncDocumentImpl.lastEventId}get dateExpires(){return this.syncDocumentImpl.dateExpires}static get type(){return _x.type}get type(){return _x.type}get sid(){return this.syncDocumentImpl.sid}get data(){return this.syncDocumentImpl.data}get dateUpdated(){return this.syncDocumentImpl.dateUpdated}get uniqueName(){return this.syncDocumentImpl.uniqueName}constructor(e){super(),this.syncDocumentImpl=e,this.syncDocumentImpl.attach(this)}set(e,t){var r=this;return it(Mo.mark((function n(){return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.ensureNotClosed(),n.abrupt("return",r.syncDocumentImpl.set(e,t));case 2:case"end":return n.stop()}}),n)})))()}mutate(e,t){var r=this;return it(Mo.mark((function n(){return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.ensureNotClosed(),n.abrupt("return",r.syncDocumentImpl.mutate(e,t));case 2:case"end":return n.stop()}}),n)})))()}update(e,t){var r=this;return it(Mo.mark((function n(){return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.ensureNotClosed(),n.abrupt("return",r.syncDocumentImpl.update(e,t));case 2:case"end":return n.stop()}}),n)})))()}setTtl(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncDocumentImpl.setTtl(e));case 2:case"end":return r.stop()}}),r)})))()}removeDocument(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.ensureNotClosed(),t.abrupt("return",e.syncDocumentImpl.removeDocument());case 2:case"end":return t.stop()}}),t)})))()}close(){super.close(),this.syncDocumentImpl.detach(this.listenerUuid)}}st(kx,"removed","removed"),st(kx,"updated","updated"),No([Pf(jf,["undefined",Lf("document metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object,Object]),Fo("design:returntype",Promise)],kx.prototype,"set",null),No([Pf("function",["undefined",Lf("document metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Function,Object]),Fo("design:returntype",Promise)],kx.prototype,"mutate",null),No([Pf(jf,["undefined",Lf("document metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object,Object]),Fo("design:returntype",Promise)],kx.prototype,"update",null),No([Pf(Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number]),Fo("design:returntype",Promise)],kx.prototype,"setTtl",null);class Sx{constructor(e){this.descriptor=e}get uri(){return this.descriptor.uri}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.lastEventId}get dateUpdated(){return this.descriptor.dateUpdated}get dateExpires(){return this.descriptor.dateExpires}get index(){return this.descriptor.index}get data(){return this.descriptor.data}update(e,t,r,n){return this.descriptor.lastEventId=e,this.descriptor.revision=t,this.descriptor.data=r,this.descriptor.dateUpdated=n,this}updateDateExpires(e){this.descriptor.dateExpires=e}}class Ex{constructor(e,t,r,n){this.prevToken=r,this.nextToken=n,this.items=e,this.source=t}get hasNextPage(){return!!this.nextToken}get hasPrevPage(){return!!this.prevToken}nextPage(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.hasNextPage){t.next=2;break}throw new Error("No next page");case 2:return t.abrupt("return",e.source(e.nextToken));case 3:case"end":return t.stop()}}),t)})))()}prevPage(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.hasPrevPage){t.next=2;break}throw new Error("No previous page");case 2:return t.abrupt("return",e.source(e.prevToken));case 3:case"end":return t.stop()}}),t)})))()}}function Ix(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Tx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Tx(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function Tx(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class Ox{constructor(e,t){this.balanceFactor=0,this.key=e,this.value=t,this.parent=null,this.left=null,this.right=null}get isRoot(){return null===this.parent}get isLeaf(){return null===this.left&&null===this.right}get isLeftChild(){return this.parent.left===this}update(e){this.value=e}replace(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}class Cx{constructor(e,t){this.isLessThan=e||((e,t)=>e<t),this.isEqual=t||((e,t)=>e===t),this.root=null,this.count=null}get size(){return this.count}clear(){this.root=null,this.count=0}set(e,t){var r=this.getNode(e);r?r.update(t):this.insert(e,t)}insert(e,t){var r=new Ox(e,t);if(this.count++,this.root){for(var n=this.root;;)if(this.isLessThan(e,n.key)){if(!n.left){n.left=r;break}n=n.left}else{if(!n.right){n.right=r;break}n=n.right}for(r.parent=n,n=r;n.parent;){var i=n.parent,s=i.balanceFactor;if(n.isLeftChild?i.balanceFactor++:i.balanceFactor--,Math.abs(i.balanceFactor)<Math.abs(s))break;if(i.balanceFactor<-1||i.balanceFactor>1){this.rebalance(i);break}n=i}}else this.root=r}get(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}delete(e){var t=this.getNode(e);if(!t||t.key!==e)return null;var r=t.parent,n=t.left,i=t.right;if(!!n!=!!i){var s=n||i;r||s?r&&!s?this.root=s:(r.replace(t,null),this.rebalance(r)):this.root=null}else{for(var o=t.left;o.right;)o=o.right;if(t.left===o)t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.balanceFactor=t.balanceFactor,t={parent:o,isLeftChild:!0};else{var a=o.parent,c=o.left;a.right=c,c&&(c.parent=a),t.isRoot?(this.root=o,o.parent=null):(t.isLeftChild?t.parent.left=o:t.parent.right=o,o.parent=t.parent),o.right=t.right,o.right.parent=o,o.left=t.left,o.left.parent=o,o.balanceFactor=t.balanceFactor,t={parent:a,isLeftChild:!1}}}for(this.count--;t.parent;){var u=t.parent,l=u.balanceFactor;if(t.isLeftChild?u.balanceFactor-=1:u.balanceFactor+=1,Math.abs(u.balanceFactor)>Math.abs(l)){if(!(u.balanceFactor<-1||u.balanceFactor>1))break;if(this.rebalance(u),0!==u.parent.balanceFactor)break;t=u.parent}else t=u}return null}getNode(e){for(var t=this.root;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}rebalance(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}rotateLeft(e){var t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}rotateRight(e){var t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}[Symbol.iterator](){var e=this;return Mo.mark((function t(){var r,n,i;return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=Ix(e.getIterator()),t.prev=1,r.s();case 3:if((n=r.n()).done){t.next=9;break}return i=n.value,t.next=7,i;case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),r.e(t.t0);case 14:return t.prev=14,r.f(),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])}))()}getIterator(){var e=arguments,t=this;return Mo.mark((function r(){var n,i,s;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.length>0&&void 0!==e[0]?e[0]:null,i=t.root;case 2:if(!i){r.next=8;break}if(!t.isEqual(n,i.key)&&(null!==n||i.left)){r.next=5;break}return r.abrupt("break",8);case 5:i=t.isLessThan(n,i.key)||null===n?i.left:i.right,r.next=2;break;case 8:if(i){r.next=10;break}return r.abrupt("return",null);case 10:s=!0;case 11:if(!s){r.next=29;break}return r.next=14,[i.key,i.value];case 14:if(s=!1,!i.right){r.next=21;break}for(i=i.right;i.left;)i=i.left;s=!0,r.next=27;break;case 21:if(!i.parent){r.next=26;break}s=i.parent.left===i,i=i.parent,r.next=27;break;case 26:return r.abrupt("break",37);case 27:r.next=35;break;case 29:if(!i.parent){r.next=34;break}s=i.parent.left===i,i=i.parent,r.next=35;break;case 34:return r.abrupt("break",37);case 35:r.next=11;break;case 37:return r.abrupt("return",null);case 38:case"end":return r.stop()}}),r)}))()}getReverseIterator(){var e=arguments,t=this;return Mo.mark((function r(){var n,i,s;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=e.length>0&&void 0!==e[0]?e[0]:null,i=t.root;case 2:if(!i){r.next=8;break}if(!t.isEqual(n,i.key)&&(null!==n||i.right)){r.next=5;break}return r.abrupt("break",8);case 5:i=t.isLessThan(n,i.key)&&null!==n?i.left:i.right,r.next=2;break;case 8:if(i){r.next=10;break}return r.abrupt("return",null);case 10:s=!0;case 11:if(!s){r.next=29;break}return r.next=14,[i.key,i.value];case 14:if(s=!1,!i.left){r.next=21;break}for(i=i.left;i.right;)i=i.right;s=!0,r.next=27;break;case 21:if(!i.parent){r.next=26;break}s=i.parent.right===i,i=i.parent,r.next=27;break;case 26:return r.abrupt("break",37);case 27:r.next=35;break;case 29:if(!i.parent){r.next=34;break}s=i.parent.right===i,i=i.parent,r.next=35;break;case 34:return r.abrupt("break",37);case 35:r.next=11;break;case 37:return r.abrupt("return",null);case 38:case"end":return r.stop()}}),r)}))()}}function Ax(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(!e)return;if("string"==typeof e)return Rx(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);"Object"===r&&e.constructor&&(r=e.constructor.name);if("Map"===r||"Set"===r)return Array.from(e);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Rx(e,t)}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,a=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return o=e.done,e},e:function(e){a=!0,s=e},f:function(){try{o||null==r.return||r.return()}finally{if(a)throw s}}}}function Rx(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}class Lx{constructor(e,t){this.value=e,this.revision=t||0}get isValid(){return!0}}class jx{constructor(e){this.revision=e}get isValid(){return!1}}class Mx{constructor(){this.items=new Cx}store(e,t,r){var n=this.items.get(e);return n&&n.revision>r?n.isValid?n.value:null:(this.items.set(e,new Lx(t,r)),t)}delete(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=this.items.get(e);(!n||n.revision<t||n&&!0===r)&&this.items.set(e,new jx(t))}isKnown(e,t){var r=this.items.get(e);return r&&r.revision>=t}get(e){var t=this.items.get(e);return t&&t.isValid?t.value:null}has(e){var t=this.items.get(e);return t&&t.isValid}forEach(e){if(this.items){var t,r=Ax(this.items);try{for(r.s();!(t=r.n()).done;){var n=Jw(t.value,2),i=n[0],s=n[1];s.isValid&&e(i,s.value)}}catch(e){r.e(e)}finally{r.f()}}}}class Px extends yx{constructor(e,t,r){super(e,r);this.updateMergingQueue=new wx(((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e)),this.cache=new Mx,this.descriptor=t,this.descriptor.date_updated=new Date(this.descriptor.date_updated)}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get links(){return this.descriptor.links}get dateExpires(){return this.descriptor.date_expires}static get type(){return"list"}get type(){return"list"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}get dateUpdated(){return this.descriptor.date_updated}_addOrUpdateItemOnServer(e,t,r,n){var i=this;return it(Mo.mark((function s(){var o,a;return Mo.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o={data:t},void 0!==n&&(o.ttl=n),s.next=4,i.services.network.post(e,o,r);case 4:return(a=s.sent).body.data=t,a.body.date_updated=new Date(a.body.date_updated),s.abrupt("return",a.body);case 8:case"end":return s.stop()}}),s)})))()}push(e,t){var r=this;return it(Mo.mark((function n(){var i,s,o;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=(t||{}).ttl,n.next=3,r._addOrUpdateItemOnServer(r.links.items,e,void 0,i);case 3:return s=n.sent,o=Number(s.index),r._handleItemMutated(o,s.url,s.last_event_id,s.revision,e,s.date_updated,s.date_expires,!0,!1),n.abrupt("return",r.cache.get(o));case 7:case"end":return n.stop()}}),n)})))()}set(e,t,r){var n=this;return it(Mo.mark((function i(){var s;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=r||{},i.abrupt("return",n.updateMergingQueue.squashAndAdd(e,s,(r=>n._updateItemUnconditionally(e,t,r.ttl))));case 2:case"end":return i.stop()}}),i)})))()}_updateItemUnconditionally(e,t,r){var n=this;return it(Mo.mark((function i(){var s,o;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.get(e);case 2:return s=i.sent,i.next=5,n._addOrUpdateItemOnServer(s.uri,t,void 0,r);case 5:return o=i.sent,n._handleItemMutated(e,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,!1,!1),i.abrupt("return",n.cache.get(e));case 8:case"end":return i.stop()}}),i)})))()}_updateItemWithIfMatch(e,t,r){var n=this;return it(Mo.mark((function i(){var s,o,a,c;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.get(e);case 2:if(s=i.sent,!(o=t(Fw(s.data)))){i.next=25;break}return a=s.revision,i.prev=6,i.next=9,n._addOrUpdateItemOnServer(s.uri,o,a,r);case 9:return c=i.sent,n._handleItemMutated(e,c.url,c.last_event_id,c.revision,c.data,c.date_updated,c.date_expires,!1,!1),i.abrupt("return",n.cache.get(e));case 14:if(i.prev=14,i.t0=i.catch(6),412!==i.t0.status){i.next=22;break}return i.next=19,n._getItemFromServer(e);case 19:return i.abrupt("return",n._updateItemWithIfMatch(e,t,r));case 22:throw i.t0;case 23:i.next=26;break;case 25:return i.abrupt("return",s);case 26:case"end":return i.stop()}}),i,null,[[6,14]])})))()}mutate(e,t,r){var n=this;return it(Mo.mark((function i(){var s;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=r||{},i.abrupt("return",n.updateMergingQueue.add(e,s,(r=>n._updateItemWithIfMatch(e,t,r.ttl))));case 2:case"end":return i.stop()}}),i)})))()}update(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",n.mutate(e,(e=>Object.assign(e,t)),r));case 1:case"end":return i.stop()}}),i)})))()}remove(e){var t=this;return it(Mo.mark((function r(){var n,i,s;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.get(e);case 2:return n=r.sent,i=Fw(n.data),r.next=6,t.services.network.delete(n.uri);case 6:s=r.sent,t._handleItemRemoved(e,s.body.last_event_id,i,new Date(s.body.date_updated),!1);case 8:case"end":return r.stop()}}),r)})))()}get(e){var t=this;return it(Mo.mark((function r(){var n;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n=t.cache.get(e))){r.next=5;break}return r.abrupt("return",n);case 5:return r.abrupt("return",t._getItemFromServer(e));case 6:case"end":return r.stop()}}),r)})))()}_getItemFromServer(e){var t=this;return it(Mo.mark((function r(){var n;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.queryItems({index:e});case 2:if(!((n=r.sent).items.length<1)){r.next=7;break}throw new Pw("No item with index ".concat(e," found"),404,54151);case 7:return r.abrupt("return",n.items[0]);case 8:case"end":return r.stop()}}),r)})))()}queryItems(e){var t=this;return it(Mo.mark((function r(){var n,i,s,o;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=e||{},n=new Mw(t.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Index",e.index).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build(),r.next=4,t.services.network.get(n);case 4:return i=r.sent,s=i.body.items.map((e=>(e.date_updated=new Date(e.date_updated),t.cache.get(e.index)?t._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):t.cache.store(Number(e.index),new Sx({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,data:e.data}),e.last_event_id),t.cache.get(e.index)))),o=i.body.meta,r.abrupt("return",new Ex(s,(e=>t.queryItems({pageToken:e})),o.previous_token,o.next_token));case 8:case"end":return r.stop()}}),r)})))()}getItems(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Dw((e=e||{}).pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",r.abrupt("return",t.queryItems(e));case 5:case"end":return r.stop()}}),r)})))()}getContext(){var e=this;return it(Mo.mark((function t(){var r;return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.context){t.next=5;break}return t.next=3,e.services.network.get(e.links.context);case 3:r=t.sent,e._updateContextIfRequired(r.body.data,r.body.last_event_id);case 5:return t.abrupt("return",e.context);case 6:case"end":return t.stop()}}),t)})))()}setTtl(e){var t=this;return it(Mo.mark((function r(){var n,i;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n={ttl:e},r.next=4,t.services.network.post(t.uri,n);case 4:i=r.sent,t.descriptor.date_expires=i.body.date_expires,r.next=12;break;case 8:throw r.prev=8,r.t0=r.catch(0),404===r.t0.status&&t.onRemoved(!1),r.t0;case 12:case"end":return r.stop()}}),r,null,[[0,8]])})))()}setItemTtl(e,t){var r=this;return it(Mo.mark((function n(){var i,s,o;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.get(e);case 2:return i=n.sent,s={ttl:t},n.next=6,r.services.network.post(i.uri,s);case 6:o=n.sent,i.updateDateExpires(o.body.date_expires);case 8:case"end":return n.stop()}}),n)})))()}removeList(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.services.network.delete(e.uri);case 2:e.onRemoved(!0);case 3:case"end":return t.stop()}}),t)})))()}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}shouldIgnoreEvent(e,t){return this.cache.isKnown(e,t)}_update(e,t){var r=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(r,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(r,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}_updateRootDateUpdated(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}_handleItemMutated(e,t,r,n,i,s,o,a,c){if(this.shouldIgnoreEvent(e,r))zw("Item ".concat(e," update skipped, current: ").concat(this.lastEventId,", remote: ").concat(r));else{this._updateRootDateUpdated(s);var u=this.cache.get(e);if(!u){var l=new Sx({index:e,uri:t,lastEventId:r,revision:n,data:i,dateUpdated:s,dateExpires:o});return this.cache.store(e,l,r),void this.emitItemMutationEvent(l,c,a)}var d=Fw(u.data);u.update(r,n,i,s),this.cache.store(e,u,r),void 0!==o&&u.updateDateExpires(o),this.emitItemMutationEvent(u,c,!1,d)}}emitItemMutationEvent(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=r?"itemAdded":"itemUpdated",s={item:e,isLocal:!t};r||(s.previousItemData=n),this.broadcastEventToListeners(i,s)}_handleItemRemoved(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,previousItemData:r})}_handleContextUpdate(e,t,r){this._updateRootDateUpdated(r),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}_updateContextIfRequired(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(zw("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}class Nx extends xx{get uri(){return this.syncListImpl.uri}get revision(){return this.syncListImpl.revision}get lastEventId(){return this.syncListImpl.lastEventId}get links(){return this.syncListImpl.links}get dateExpires(){return this.syncListImpl.dateExpires}static get type(){return Px.type}get type(){return Px.type}get sid(){return this.syncListImpl.sid}get uniqueName(){return this.syncListImpl.uniqueName}get dateUpdated(){return this.syncListImpl.dateUpdated}constructor(e){super(),this.syncListImpl=e,this.syncListImpl.attach(this)}push(e,t){var r=this;return it(Mo.mark((function n(){return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.ensureNotClosed(),n.abrupt("return",r.syncListImpl.push(e,t));case 2:case"end":return n.stop()}}),n)})))()}set(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.ensureNotClosed(),i.abrupt("return",n.syncListImpl.set(e,t,r));case 2:case"end":return i.stop()}}),i)})))()}mutate(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.ensureNotClosed(),i.abrupt("return",n.syncListImpl.mutate(e,t,r));case 2:case"end":return i.stop()}}),i)})))()}update(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.ensureNotClosed(),i.abrupt("return",n.syncListImpl.update(e,t,r));case 2:case"end":return i.stop()}}),i)})))()}remove(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncListImpl.remove(e));case 2:case"end":return r.stop()}}),r)})))()}get(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncListImpl.get(e));case 2:case"end":return r.stop()}}),r)})))()}getContext(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.ensureNotClosed(),t.abrupt("return",e.syncListImpl.getContext());case 2:case"end":return t.stop()}}),t)})))()}getItems(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncListImpl.getItems(e));case 2:case"end":return r.stop()}}),r)})))()}setTtl(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncListImpl.setTtl(e));case 2:case"end":return r.stop()}}),r)})))()}setItemTtl(e,t){var r=this;return it(Mo.mark((function n(){return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.ensureNotClosed(),n.abrupt("return",r.syncListImpl.setItemTtl(e,t));case 2:case"end":return n.stop()}}),n)})))()}removeList(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.ensureNotClosed(),t.abrupt("return",e.syncListImpl.removeList());case 2:case"end":return t.stop()}}),t)})))()}close(){super.close(),this.syncListImpl.detach(this.listenerUuid)}}st(Nx,"itemAdded","itemAdded"),st(Nx,"itemUpdated","itemUpdated"),st(Nx,"itemRemoved","itemRemoved"),st(Nx,"removed","removed"),No([Pf(jf,["undefined",Lf("item metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object,Object]),Fo("design:returntype",Promise)],Nx.prototype,"push",null),No([Pf(Rf,jf,["undefined",Lf("item metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Number,Object,Object]),Fo("design:returntype",Promise)],Nx.prototype,"set",null),No([Pf(Rf,"function",["undefined",Lf("item metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Number,Function,Object]),Fo("design:returntype",Promise)],Nx.prototype,"mutate",null),No([Pf(Rf,jf,["undefined",Lf("item metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Number,Object,Object]),Fo("design:returntype",Promise)],Nx.prototype,"update",null),No([Pf(Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number]),Fo("design:returntype",Promise)],Nx.prototype,"remove",null),No([Pf(Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number]),Fo("design:returntype",Promise)],Nx.prototype,"get",null),No([Pf(["undefined",Lf("query options",{from:[Rf,"undefined"],pageSize:[Of((e=>[Uw(e),"a positive integer"])),"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],Nx.prototype,"getItems",null),No([Pf(Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number]),Fo("design:returntype",Promise)],Nx.prototype,"setTtl",null),No([Pf(Rf,Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number,Number]),Fo("design:returntype",Promise)],Nx.prototype,"setItemTtl",null);class Fx{constructor(e){this.descriptor=e}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}get key(){return this.descriptor.key}get data(){return this.descriptor.data}get dateUpdated(){return this.descriptor.date_updated}update(e,t,r,n){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=r,this.descriptor.date_updated=n,this}updateDateExpires(e){this.descriptor.date_expires=e}}class Dx extends yx{constructor(e,t,r){super(e,r);this.updateMergingQueue=new wx(((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e)),this.cache=new Mx,this.descriptor=t,this.descriptor.date_updated=new Date(this.descriptor.date_updated),t.items&&t.items.forEach((e=>{e.date_updated=new Date(e.date_updated),this.cache.store(e.key,new Fx(e),e.last_event_id)}))}get uri(){return this.descriptor.url}get links(){return this.descriptor.links}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}static get type(){return"map"}get type(){return"map"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}get dateUpdated(){return this.descriptor.date_updated}set(e,t,r){var n=this;return it(Mo.mark((function i(){var s;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=r||{},i.abrupt("return",n.updateMergingQueue.squashAndAdd(e,s,(r=>n._putItemUnconditionally(e,t,r.ttl))));case 2:case"end":return i.stop()}}),i)})))()}get(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(null!=e){r.next=2;break}throw new Pw("SyncMapItem key may not be empty",400,54209);case 2:if(!t.cache.has(e)){r.next=6;break}return r.abrupt("return",t.cache.get(e));case 6:return r.abrupt("return",t._getItemFromServer(e));case 7:case"end":return r.stop()}}),r)})))()}_getItemFromServer(e){var t=this;return it(Mo.mark((function r(){var n;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.queryItems({key:e});case 2:if(!((n=r.sent).items.length<1)){r.next=7;break}throw new Pw("The specified Map Item does not exist",404,54201);case 7:return r.abrupt("return",n.items[0]);case 8:case"end":return r.stop()}}),r)})))()}mutate(e,t,r){var n=this;return it(Mo.mark((function i(){var s;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=r||{},i.abrupt("return",n.updateMergingQueue.add(e,s,(r=>n._putItemWithIfMatch(e,t,r.ttl))));case 2:case"end":return i.stop()}}),i)})))()}update(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",n.mutate(e,(e=>Object.assign(e,t)),r));case 1:case"end":return i.stop()}}),i)})))()}_putItemUnconditionally(e,t,r){var n=this;return it(Mo.mark((function i(){var s,o;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n._putItemToServer(e,t,void 0,r);case 2:return s=i.sent,o=s.item,n._handleItemMutated(o.key,o.url,o.last_event_id,o.revision,o.data,o.date_updated,o.date_expires,s.added,!1),i.abrupt("return",n.cache.get(o.key));case 6:case"end":return i.stop()}}),i)})))()}_putItemWithIfMatch(e,t,r){var n=this;return it(Mo.mark((function i(){var s,o,a,c,u;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,n.get(e).catch((t=>{if(404===t.status)return new Fx({key:e,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw t}));case 2:if(s=i.sent,!(o=t(Fw(s.data)))){i.next=26;break}return a=s.revision,i.prev=6,i.next=9,n._putItemToServer(e,o,a,r);case 9:return c=i.sent,u=c.item,n._handleItemMutated(u.key,u.url,u.last_event_id,u.revision,u.data,u.date_updated,u.date_expires,c.added,!1),i.abrupt("return",n.cache.get(u.key));case 15:if(i.prev=15,i.t0=i.catch(6),412!==i.t0.status){i.next=23;break}return i.next=20,n._getItemFromServer(e);case 20:return i.abrupt("return",n._putItemWithIfMatch(e,t,r));case 23:throw i.t0;case 24:i.next=27;break;case 26:return i.abrupt("return",s);case 27:case"end":return i.stop()}}),i,null,[[6,15]])})))()}_putItemToServer(e,t,r,n){var i=this;return it(Mo.mark((function s(){var o,a,c,u,l;return Mo.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return o=new Mw(i.links.items).pathSegment(e).build(),a={data:t},void 0!==n&&(a.ttl=n),s.prev=3,s.next=6,i.services.network.put(o,a,r);case 6:return c=s.sent,(u=c.body).data=t,u.date_updated=new Date(u.date_updated),l=201===c.status.code,s.abrupt("return",{added:l,item:u});case 14:throw s.prev=14,s.t0=s.catch(3),404===s.t0.status&&i.onRemoved(!1),s.t0;case 18:case"end":return s.stop()}}),s,null,[[3,14]])})))()}remove(e){var t=this;return it(Mo.mark((function r(){var n,i,s;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.get(e);case 2:return n=r.sent,i=Fw(n.data),r.next=6,t.services.network.delete(n.uri);case 6:s=r.sent,t._handleItemRemoved(e,s.body.last_event_id,i,new Date(s.body.date_updated),!1);case 8:case"end":return r.stop()}}),r)})))()}queryItems(e){var t=this;return it(Mo.mark((function r(){var n,i,s,o;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return e=e||{},n=new Mw(t.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Key",e.key).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build(),r.next=4,t.services.network.get(n);case 4:return i=r.sent,s=i.body.items.map((e=>(e.date_updated=new Date(e.date_updated),t.cache.get(e.key)?t._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):t.cache.store(e.key,new Fx(e),e.last_event_id),t.cache.get(e.key)))),o=i.body.meta,r.abrupt("return",new Ex(s,(e=>t.queryItems({pageToken:e})),o.previous_token,o.next_token));case 8:case"end":return r.stop()}}),r)})))()}getItems(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return Dw((e=e||{}).pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",r.abrupt("return",t.queryItems(e));case 5:case"end":return r.stop()}}),r)})))()}shouldIgnoreEvent(e,t){return this.cache.isKnown(e,t)}_update(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}_updateRootDateUpdated(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}_handleItemMutated(e,t,r,n,i,s,o,a,c){if(this.shouldIgnoreEvent(e,r))zw("SyncMapItem ",e," update skipped, current:",this.lastEventId,", remote:",r);else{this._updateRootDateUpdated(s);var u=this.cache.get(e);if(!u){var l=new Fx({key:e,url:t,last_event_id:r,revision:n,data:i,date_updated:s,date_expires:o});return this.cache.store(e,l,r),void this.emitItemMutationEvent(l,c,a)}var d=Fw(u.data);u.update(r,n,i,s),this.cache.store(e,u,r),void 0!==o&&u.updateDateExpires(o),this.emitItemMutationEvent(u,c,!1,d)}}emitItemMutationEvent(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,i=r?"itemAdded":"itemUpdated",s={item:e,isLocal:!t};r||(s.previousItemData=n),this.broadcastEventToListeners(i,s)}_handleItemRemoved(e,t,r,n,i){this._updateRootDateUpdated(n),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,previousItemData:r})}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}setTtl(e){var t=this;return it(Mo.mark((function r(){var n,i;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n={ttl:e},r.next=4,t.services.network.post(t.uri,n);case 4:i=r.sent,t.descriptor.date_expires=i.body.date_expires,r.next=12;break;case 8:throw r.prev=8,r.t0=r.catch(0),404===r.t0.status&&t.onRemoved(!1),r.t0;case 12:case"end":return r.stop()}}),r,null,[[0,8]])})))()}setItemTtl(e,t){var r=this;return it(Mo.mark((function n(){var i,s,o;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.get(e);case 2:return i=n.sent,s={ttl:t},n.next=6,r.services.network.post(i.uri,s);case 6:o=n.sent,i.updateDateExpires(o.body.date_expires);case 8:case"end":return n.stop()}}),n)})))()}removeMap(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.services.network.delete(e.uri);case 2:e.onRemoved(!0);case 3:case"end":return t.stop()}}),t)})))()}}class Ux extends xx{get uri(){return this.syncMapImpl.uri}get links(){return this.syncMapImpl.links}get revision(){return this.syncMapImpl.revision}get lastEventId(){return this.syncMapImpl.lastEventId}get dateExpires(){return this.syncMapImpl.dateExpires}static get type(){return Dx.type}get type(){return Dx.type}get sid(){return this.syncMapImpl.sid}get uniqueName(){return this.syncMapImpl.uniqueName}get dateUpdated(){return this.syncMapImpl.dateUpdated}constructor(e){super(),this.syncMapImpl=e,this.syncMapImpl.attach(this)}set(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.ensureNotClosed(),i.abrupt("return",n.syncMapImpl.set(e,t,r));case 2:case"end":return i.stop()}}),i)})))()}get(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncMapImpl.get(e));case 2:case"end":return r.stop()}}),r)})))()}mutate(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.ensureNotClosed(),i.abrupt("return",n.syncMapImpl.mutate(e,t,r));case 2:case"end":return i.stop()}}),i)})))()}update(e,t,r){var n=this;return it(Mo.mark((function i(){return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return n.ensureNotClosed(),i.abrupt("return",n.syncMapImpl.update(e,t,r));case 2:case"end":return i.stop()}}),i)})))()}remove(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncMapImpl.remove(e));case 2:case"end":return r.stop()}}),r)})))()}getItems(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncMapImpl.getItems(e));case 2:case"end":return r.stop()}}),r)})))()}setTtl(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncMapImpl.setTtl(e));case 2:case"end":return r.stop()}}),r)})))()}setItemTtl(e,t){var r=this;return it(Mo.mark((function n(){return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r.ensureNotClosed(),n.abrupt("return",r.syncMapImpl.setItemTtl(e,t));case 2:case"end":return n.stop()}}),n)})))()}removeMap(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.ensureNotClosed(),t.next=3,e.syncMapImpl.removeMap();case 3:case"end":return t.stop()}}),t)})))()}close(){super.close(),this.syncMapImpl.detach(this.listenerUuid)}}st(Ux,"itemAdded","itemAdded"),st(Ux,"itemUpdated","itemUpdated"),st(Ux,"itemRemoved","itemRemoved"),st(Ux,"removed","removed"),No([Pf("string",jf,["undefined",Lf("item metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[String,Object,Object]),Fo("design:returntype",Promise)],Ux.prototype,"set",null),No([Pf("string"),Fo("design:type",Function),Fo("design:paramtypes",[String]),Fo("design:returntype",Promise)],Ux.prototype,"get",null),No([Pf("string","function",["undefined",Lf("item metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[String,Function,Object]),Fo("design:returntype",Promise)],Ux.prototype,"mutate",null),No([Pf("string",jf,["undefined",Lf("item metadata",{ttl:[Rf,"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[String,Object,Object]),Fo("design:returntype",Promise)],Ux.prototype,"update",null),No([Pf("string"),Fo("design:type",Function),Fo("design:paramtypes",[String]),Fo("design:returntype",Promise)],Ux.prototype,"remove",null),No([Pf(["undefined",Lf("query options",{from:["string","undefined"],pageSize:[Of((e=>[Uw(e),"a positive integer"])),"undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],Ux.prototype,"getItems",null),No([Pf(Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number]),Fo("design:returntype",Promise)],Ux.prototype,"setTtl",null),No([Pf("string",Rf),Fo("design:type",Function),Fo("design:paramtypes",[String,Number]),Fo("design:returntype",Promise)],Ux.prototype,"setItemTtl",null);class qx extends yx{constructor(e,t,r){super(e,r),this.descriptor=t}get uri(){return this.descriptor.url}get links(){return this.descriptor.links}static get type(){return"stream"}get dateExpires(){return this.descriptor.date_expires}get type(){return"stream"}get lastEventId(){return null}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}publishMessage(e){var t=this;return it(Mo.mark((function r(){var n,i,s,o;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return n={data:e},r.next=3,t.services.network.post(t.links.messages,n);case 3:return i=r.sent,s=i.body,o=t._handleMessagePublished(s.sid,e,!1),r.abrupt("return",o);case 7:case"end":return r.stop()}}),r)})))()}setTtl(e){var t=this;return it(Mo.mark((function r(){var n,i;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,n={ttl:e},r.next=4,t.services.network.post(t.uri,n);case 4:i=r.sent,t.descriptor.date_expires=i.body.date_expires,r.next=12;break;case 8:throw r.prev=8,r.t0=r.catch(0),404===r.t0.status&&t.onRemoved(!1),r.t0;case 12:case"end":return r.stop()}}),r,null,[[0,8]])})))()}removeStream(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.services.network.delete(e.uri);case 2:e.onRemoved(!0);case 3:case"end":return t.stop()}}),t)})))()}_update(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}_handleMessagePublished(e,t,r){var n={sid:e,data:t};return this.broadcastEventToListeners("messagePublished",{message:n,isLocal:!r}),n}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}No([Pf(jf),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],qx.prototype,"publishMessage",null),No([Pf(Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number]),Fo("design:returntype",Promise)],qx.prototype,"setTtl",null);class Bx extends xx{get uri(){return this.syncStreamImpl.uri}get links(){return this.syncStreamImpl.links}static get type(){return qx.type}get dateExpires(){return this.syncStreamImpl.dateExpires}get type(){return qx.type}get lastEventId(){return null}get sid(){return this.syncStreamImpl.sid}get uniqueName(){return this.syncStreamImpl.uniqueName}constructor(e){super(),this.syncStreamImpl=e,this.syncStreamImpl.attach(this)}publishMessage(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncStreamImpl.publishMessage(e));case 2:case"end":return r.stop()}}),r)})))()}setTtl(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.ensureNotClosed(),r.abrupt("return",t.syncStreamImpl.setTtl(e));case 2:case"end":return r.stop()}}),r)})))()}removeStream(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.ensureNotClosed(),t.abrupt("return",e.syncStreamImpl.removeStream());case 2:case"end":return t.stop()}}),t)})))()}close(){super.close(),this.syncStreamImpl.detach(this.listenerUuid)}}st(Bx,"messagePublished","messagePublished"),st(Bx,"removed","removed"),No([Pf(jf),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],Bx.prototype,"publishMessage",null),No([Pf(Rf),Fo("design:type",Function),Fo("design:paramtypes",[Number]),Fo("design:returntype",Promise)],Bx.prototype,"setTtl",null);class Wx{constructor(e){this.sdk="js",this.sdkVer=e,this.os=vw.exports.os.family,this.osVer=vw.exports.os.version,this.pl=vw.exports.name,this.plVer=vw.exports.version}}class zx{constructor(){this.names=new Map,this.entities=new Map}store(e){var t=this.entities.get(e.sid);return t||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}getResolved(e,t){var r=this.names.get(t+"::"+e);return r?this.entities.get(r):null}get(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}remove(e){var t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}class Kx extends yx{constructor(e,t,r,n){super(t,r),this.descriptor=e,this.cache=new Mx,n&&n.forEach((e=>{this.cache.store(e.key,{key:e.key,value:e.data},e.revision)}))}get sid(){return this.descriptor.sid}get uniqueName(){return null}get type(){return Kx.type}static get type(){return"live_query"}get lastEventId(){return this.descriptor.last_event_id}get indexName(){return this.descriptor.indexName}get queryString(){return this.descriptor.queryExpression}get queryUri(){return this.descriptor.queryUri}get liveQueryDescriptor(){return this.descriptor}onRemoved(){}getItems(){var e={};return this.cache.forEach(((t,r)=>{e[t]=r.value})),e}_update(e,t){switch(e.type){case"live_query_item_updated":this.handleItemMutated(e.item_key,e.item_data,e.item_revision);break;case"live_query_item_removed":this.handleItemRemoved(e.item_key,e.item_revision);break;case"live_query_updated":this.handleBatchUpdate(e.items)}t&&this._advanceLastEventId(e.last_event_id)}handleItemMutated(e,t,r){if(this.shouldIgnoreEvent(e,r))zw("Item ".concat(e," update skipped, revision: ").concat(r));else{var n={key:e,value:t};this.cache.store(e,n,r),this.broadcastEventToListeners("itemUpdated",n)}}handleItemRemoved(e,t){var r=null===t;this.shouldIgnoreEvent(e,t)?zw("Item ".concat(e," delete skipped, revision: ").concat(t)):(this.cache.delete(e,t,r),this.broadcastEventToListeners("itemRemoved",{key:e}))}handleBatchUpdate(e){var t={};for(var r in null!=e&&e.forEach((e=>{t[e.key]={data:e.data,revision:e.revision}})),this.cache.forEach(((e,r)=>{var n=t[e];null!=n?this.handleItemMutated(e,n.data,n.revision):this.handleItemRemoved(e,null),delete t[e]})),t)this.handleItemMutated(r,t[r].data,t[r].revision)}shouldIgnoreEvent(e,t){return null!=e&&null!=t&&this.cache.isKnown(e,t)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e)}}function Gx(e){return $x.apply(this,arguments)}function $x(){return($x=it(Mo.mark((function e(t){var r,n,i,s,o,a;return Mo.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.network,n=t.queryString,i=t.uri,s=t.type,null!=n){e.next=3;break}throw new Pw("Invalid query",400,54507);case 3:return o={query_string:n},s===Vx.type&&(o.type=s),e.next=7,r.post(i,o,void 0,!0);case 7:return a=e.sent,e.abrupt("return",a.body);case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}class Vx extends xx{static get type(){return Kx.type}get type(){return Kx.type}get lastEventId(){return this.liveQueryImpl.lastEventId}get sid(){return this.liveQueryImpl.sid}constructor(e){super(),this.liveQueryImpl=e,this.liveQueryImpl.attach(this)}close(){super.close(),this.liveQueryImpl.detach(this.listenerUuid)}getItems(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}st(Vx,"itemUpdated","itemUpdated"),st(Vx,"itemRemoved","itemRemoved");class Qx extends Uo{static get type(){return"instant_query"}get type(){return Qx.type}constructor(e){super(),st(this,"queryExpression",null),st(this,"items",{}),Object.assign(this,e),this.updateIndexName(e.indexName)}search(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return t.items={},r.abrupt("return",Gx({network:t.network,uri:t.queryUri,queryString:e}).then((r=>{t.queryExpression=e,r.items&&r.items.forEach((e=>{t.items[e.key]=e.data})),t.emit("searchResult",t.getItems())})).catch((r=>{throw $w("Error '".concat(r.message,"' while executing query '").concat(e,"'")),t.queryExpression=null,r})));case 2:case"end":return r.stop()}}),r)})))()}subscribe(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null!=e.queryExpression){t.next=2;break}return t.abrupt("return",Promise.reject(new Pw("Invalid query",400,54507)));case 2:return t.abrupt("return",e.liveQueryCreator(e.indexName,e.queryExpression));case 3:case"end":return t.stop()}}),t)})))()}getItems(){return this.items}updateIndexName(e){this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}generateQueryUri(e){return new Mw(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}st(Qx,"searchResult","searchResult"),No([Pf("string"),Fo("design:type",Function),Fo("design:paramtypes",[String]),Fo("design:returntype",Promise)],Qx.prototype,"search",null),No([Mf(Af),Fo("design:type",Function),Fo("design:paramtypes",[String]),Fo("design:returntype",void 0)],Qx.prototype,"updateIndexName",null);function Hx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Jx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Hx(Object(r),!0).forEach((function(t){st(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hx(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Xx="3.0.1";function Yx(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};var t=e.mode||(e.id?"open_or_create":"create_new");return Jx(Jx({},e),{},{mode:t})}return{mode:"create_new"}}var Zx="com.twilio.rtd.cds.document",e_="com.twilio.rtd.cds.list",t_="com.twilio.rtd.cds.map",r_="twilio.sync.event";class Client extends Uo{constructor(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(super(),!e)throw new Error("Sync library needs a valid Twilio token to be passed");t.hasOwnProperty("logLevel")?Ww(t.logLevel):Ww("silent");var r=t.productId=t.productId||"data_sync";t.clientMetadata=t.clientMetadata||{},t.clientMetadata.hasOwnProperty("type")||(t.clientMetadata.type="sync"),t.clientMetadata.hasOwnProperty("sdk")||(t.clientMetadata.sdk="JS",t.clientMetadata.sdkv=Xx);var n=!t.twilsockClient;if(!t.initRegistrations){var i=new Nf.InitRegistration(r);Client.populateInitRegistrations(i),t.initRegistrations=[i]}var s=t.twilsockClient=t.twilsockClient||new Nf.Twilsock(e,r,t);s.on("tokenAboutToExpire",(e=>this.emit("tokenAboutToExpire",e))),s.on("tokenExpired",(()=>this.emit("tokenExpired"))),s.on("connectionError",(e=>this.emit("connectionError",e))),s.on("stateChanged",(e=>{this.emit("connectionStateChanged",e),this.services.subscriptions.onConnectionStateChanged("connected"===e)})),s.on("message",((e,t)=>this._routeMessage(e,t)));var o=new Qw(t),a=new hx(new Wx(Xx),o,s),c=new vx(o);this.services={config:o,twilsock:s,network:a,storage:c,router:this,subscriptions:null},this.services.subscriptions=new lx(this.services),this.entities=new zx,n&&s.connect()}static populateInitRegistrations(e){e.populateInitRegistrations([r_,Zx,e_,t_])}_routeMessage(e,t){switch(zw("Notification type:",e,"content:",t),e){case Zx:case e_:case t_:this.services.subscriptions.acceptMessage(t,!1);break;case r_:this.services.subscriptions.acceptMessage(t,!0)}}_subscribe(e,t){this.services.subscriptions.add(e,t)}_unsubscribe(e){this.services.subscriptions.remove(e)}static get version(){return Xx}get connectionState(){return this.services.twilsock.state}ensureReady(){var e=this;return it(Mo.mark((function t(){var r;return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.services.config.sessionStorageEnabled){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e.services.twilsock.storageId();case 5:r=t.sent,e.services.storage.updateStorageId(r.id),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(2),Gw("Failed to initialize storage",t.t0);case 12:case"end":return t.stop()}}),t,null,[[2,9]])})))()}storeRootInSessionCache(e,t,r){if(this.services.config.sessionStorageEnabled&&t){var n=Fw(r);e!==Nx.type&&e!==Ux.type||(n.last_event_id=null,delete n.items),this.services.storage.store(e,t,n)}}readRootFromSessionCache(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}_get(e,t){var r=arguments,n=this;return it(Mo.mark((function i(){var s,o,a;return Mo.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s=r.length>2&&void 0!==r[2]&&r[2],t){i.next=3;break}throw new Pw("Cannot get entity without id",404);case 3:return o=new Mw(e).pathSegment(t).queryParam("Include",s?"items":void 0).build(),i.next=6,n.services.network.get(o);case 6:return a=i.sent,i.abrupt("return",a.body);case 8:case"end":return i.stop()}}),i)})))()}_createDocument(e,t,r){var n={unique_name:e,data:t||{}};return void 0!==r&&(n.ttl=r),this.services.network.post(this.services.config.documentsUri,n).then((e=>(e.body.data=n.data,e.body)))}_getDocument(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.readRootFromSessionCache(kx.type,e)||t._get(t.services.config.documentsUri,e));case 1:case"end":return r.stop()}}),r)})))()}_createList(e,t,r,n){var i={unique_name:e,purpose:t,context:r};return void 0!==n&&(i.ttl=n),this.services.network.post(this.services.config.listsUri,i).then((e=>e.body))}_getList(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.readRootFromSessionCache(Nx.type,e)||t._get(t.services.config.listsUri,e));case 1:case"end":return r.stop()}}),r)})))()}_createMap(e,t){var r={unique_name:e};return void 0!==t&&(r.ttl=t),this.services.network.post(this.services.config.mapsUri,r).then((e=>e.body))}_getMap(e){var t=arguments,r=this;return it(Mo.mark((function n(){var i;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=t.length>1&&void 0!==t[1]&&t[1],n.abrupt("return",r.readRootFromSessionCache(Ux.type,e)||r._get(r.services.config.mapsUri,e,i));case 2:case"end":return n.stop()}}),n)})))()}_getStream(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.readRootFromSessionCache(Bx.type,e)||t._get(t.services.config.streamsUri,e,!1));case 1:case"end":return r.stop()}}),r)})))()}_createStream(e,t){var r=this;return it(Mo.mark((function n(){var i,s;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i={unique_name:e},void 0!==t&&(i.ttl=t),n.next=4,r.services.network.post(r.services.config.streamsUri,i);case 4:return s=n.sent,n.abrupt("return",s.body);case 6:case"end":return n.stop()}}),n)})))()}_getLiveQuery(e){return this.readRootFromSessionCache(Vx.type,e)}getCached(e,t){return e&&this.entities.get(e,t)||null}removeFromCacheAndSession(e,t,r){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,r)}document(e){var t=this;return it(Mo.mark((function r(){var n,i,s,o;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.ensureReady();case 2:if("create_new"!==(n=Yx(e)).mode){r.next=9;break}return r.next=6,t._createDocument(n.id,n.data,n.ttl);case 6:i=r.sent,r.next=39;break;case 9:if(!(s=t.getCached(n.id,kx.type))){r.next=14;break}return r.abrupt("return",new kx(s));case 14:return r.prev=14,r.next=17,t._getDocument(n.id);case 17:i=r.sent,r.next=39;break;case 20:if(r.prev=20,r.t0=r.catch(14),404===r.t0.status&&"open_existing"!==n.mode){r.next=26;break}throw r.t0;case 26:return r.prev=26,r.next=29,t._createDocument(n.id,n.data,n.ttl);case 29:i=r.sent,r.next=39;break;case 32:if(r.prev=32,r.t1=r.catch(26),409!==r.t1.status){r.next=38;break}return r.abrupt("return",t.document(e));case 38:throw r.t1;case 39:return t.storeRootInSessionCache(kx.type,n.id,i),o=new _x(t.services,i,((e,r,n)=>t.removeFromCacheAndSession(e,r,n))),o=t.entities.store(o),r.abrupt("return",new kx(o));case 43:case"end":return r.stop()}}),r,null,[[14,20],[26,32]])})))()}map(e){var t=this;return it(Mo.mark((function r(){var n,i,s,o;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.ensureReady();case 2:if("create_new"!==(n=Yx(e)).mode){r.next=9;break}return r.next=6,t._createMap(n.id,n.ttl);case 6:i=r.sent,r.next=39;break;case 9:if(!(s=t.getCached(n.id,Ux.type))){r.next=14;break}return r.abrupt("return",new Ux(s));case 14:return r.prev=14,r.next=17,t._getMap(n.id,n.includeItems);case 17:i=r.sent,r.next=39;break;case 20:if(r.prev=20,r.t0=r.catch(14),404===r.t0.status&&"open_existing"!==n.mode){r.next=26;break}throw r.t0;case 26:return r.prev=26,r.next=29,t._createMap(n.id,n.ttl);case 29:i=r.sent,r.next=39;break;case 32:if(r.prev=32,r.t1=r.catch(26),409!==r.t1.status){r.next=38;break}return r.abrupt("return",t.map(e));case 38:throw r.t1;case 39:return t.storeRootInSessionCache(Ux.type,n.id,i),o=new Dx(t.services,i,((e,r,n)=>t.removeFromCacheAndSession(e,r,n))),o=t.entities.store(o),r.abrupt("return",new Ux(o));case 43:case"end":return r.stop()}}),r,null,[[14,20],[26,32]])})))()}list(e){var t=this;return it(Mo.mark((function r(){var n,i,s,o;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.ensureReady();case 2:if("create_new"!==(n=Yx(e)).mode){r.next=9;break}return r.next=6,t._createList(n.id,n.purpose,n.context,n.ttl);case 6:i=r.sent,r.next=39;break;case 9:if(!(s=t.getCached(n.id,Nx.type))){r.next=14;break}return r.abrupt("return",new Nx(s));case 14:return r.prev=14,r.next=17,t._getList(n.id);case 17:i=r.sent,r.next=39;break;case 20:if(r.prev=20,r.t0=r.catch(14),404===r.t0.status&&"open_existing"!==n.mode){r.next=26;break}throw r.t0;case 26:return r.prev=26,r.next=29,t._createList(n.id,n.purpose,n.context,n.ttl);case 29:i=r.sent,r.next=39;break;case 32:if(r.prev=32,r.t1=r.catch(26),409!==r.t1.status){r.next=38;break}return r.abrupt("return",t.list(e));case 38:throw r.t1;case 39:return t.storeRootInSessionCache(Nx.type,n.id,i),o=new Px(t.services,i,((e,r,n)=>t.removeFromCacheAndSession(e,r,n))),o=t.entities.store(o),r.abrupt("return",new Nx(o));case 43:case"end":return r.stop()}}),r,null,[[14,20],[26,32]])})))()}stream(e){var t=this;return it(Mo.mark((function r(){var n,i,s,o,a;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.ensureReady();case 2:if("create_new"!==(n=Yx(e)).mode){r.next=9;break}return r.next=6,t._createStream(n.id,n.ttl);case 6:i=r.sent,r.next=39;break;case 9:if(!(s=t.getCached(n.id,Bx.type))){r.next=14;break}return r.abrupt("return",new Bx(s));case 14:return r.prev=14,r.next=17,t._getStream(n.id);case 17:i=r.sent,r.next=39;break;case 20:if(r.prev=20,r.t0=r.catch(14),404===r.t0.status&&"open_existing"!==n.mode){r.next=26;break}throw r.t0;case 26:return r.prev=26,r.next=29,t._createStream(n.id,n.ttl);case 29:i=r.sent,r.next=39;break;case 32:if(r.prev=32,r.t1=r.catch(26),409!==r.t1.status){r.next=38;break}return r.abrupt("return",t.stream(e));case 38:throw r.t1;case 39:return t.storeRootInSessionCache(Bx.type,n.id,i),o=(e,r,n)=>t.removeFromCacheAndSession(e,r,n),a=new qx(t.services,i,o),a=t.entities.store(a),r.abrupt("return",new Bx(a));case 44:case"end":return r.stop()}}),r,null,[[14,20],[26,32]])})))()}shutdown(){var e=this;return it(Mo.mark((function t(){return Mo.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.services.subscriptions.shutdown();case 2:return t.next=4,e.services.twilsock.disconnect();case 4:case"end":return t.stop()}}),t)})))()}updateToken(e){var t=this;return it(Mo.mark((function r(){return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.abrupt("return",t.services.twilsock.updateToken(e).catch((e=>{var t,r=null==e||null===(t=e.reply)||void 0===t?void 0:t.status;if(401===(null==r?void 0:r.code)&&"UNAUTHORIZED"===(null==r?void 0:r.status))throw new Pw("Updated token was rejected by server",400,51130);throw e})));case 1:case"end":return r.stop()}}),r)})))()}liveQuery(e,t){var r=this;return it(Mo.mark((function n(){var i,s,o,a,c;return Mo.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,r.ensureReady();case 2:return i=new Mw(r.services.config.insightsUri).pathSegment(e).pathSegment("Items").build(),n.next=5,Gx({network:r.services.network,uri:i,queryString:t,type:Vx.type});case 5:return s=n.sent,(o=r.getCached(s.query_id,Vx.type))||((a=r._getLiveQuery(s.query_id))||(a={indexName:e,queryExpression:t,sid:s.query_id,queryUri:i,last_event_id:s.last_event_id}),c=(e,t,n)=>r.removeFromCacheAndSession(e,t,n),o=new Kx(a,r.services,c,s.items)),r.storeRootInSessionCache(Vx.type,s.query_id,o.liveQueryDescriptor),o=r.entities.store(o),n.abrupt("return",new Vx(o));case 11:case"end":return n.stop()}}),n)})))()}instantQuery(e){var t=this;return it(Mo.mark((function r(){var n;return Mo.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.ensureReady();case 2:return n=(e,r)=>t.liveQuery(e,r),r.abrupt("return",new Qx({indexName:e,network:t.services.network,insightsUri:t.services.config.insightsUri,liveQueryCreator:n}));case 4:case"end":return r.stop()}}),r)})))()}}return st(Client,"connectionStateChanged","connectionStateChanged"),st(Client,"connectionError","connectionError"),st(Client,"tokenAboutToExpire","tokenAboutToExpire"),st(Client,"tokenExpired","tokenExpired"),No([Pf(["undefined","string",Lf("open document options",{id:["string","undefined"],mode:[Cf("open_or_create","open_existing","create_new"),"undefined"],ttl:[Rf,"undefined"],data:[jf,"undefined",Cf(null)]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],Client.prototype,"document",null),No([Pf(["undefined","string",Lf("open map options",{id:["string","undefined"],mode:[Cf("open_or_create","open_existing","create_new"),"undefined"],ttl:[Rf,"undefined"],data:[jf,"undefined",Cf(null)],includeItems:["boolean","undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],Client.prototype,"map",null),No([Pf(["undefined","string",Lf("open list options",{id:["string","undefined"],mode:[Cf("open_or_create","open_existing","create_new"),"undefined"],ttl:[Rf,"undefined"],data:[jf,"undefined",Cf(null)],purpose:["string","undefined"],context:[jf,"undefined"],includeItems:["boolean","undefined"]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],Client.prototype,"list",null),No([Pf(["undefined","string",Lf("open stream options",{id:["string","undefined"],mode:[Cf("open_or_create","open_existing","create_new"),"undefined"],ttl:[Rf,"undefined"],data:[jf,"undefined",Cf(null)]})]),Fo("design:type",Function),Fo("design:paramtypes",[Object]),Fo("design:returntype",Promise)],Client.prototype,"stream",null),No([Pf(Af),Fo("design:type",Function),Fo("design:paramtypes",[String]),Fo("design:returntype",Promise)],Client.prototype,"updateToken",null),No([Pf(Af,"string"),Fo("design:type",Function),Fo("design:paramtypes",[String,String]),Fo("design:returntype",Promise)],Client.prototype,"liveQuery",null),No([Pf(Af),Fo("design:type",Function),Fo("design:paramtypes",[String]),Fo("design:returntype",Promise)],Client.prototype,"instantQuery",null),e.Client=Client,e.SyncClient=Client,e.SyncDocument=kx,e.SyncList=Nx,e.SyncListItem=Sx,e.SyncMap=Ux,e.SyncMapItem=Fx,e.default=Client,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
